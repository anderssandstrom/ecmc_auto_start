@@@ Restarting child "mcu1025"
@@@    (as /epics/base-7.0.5/require/3.4.1/bin/iocsh.bash)
@@@ The PID of new child "mcu1025" is: 29271
@@@ @@@ @@@ @@@ @@@
Loading environment variables from /home/anderssandstrom/sources/test_service/env.sh

Set the ESS EPICS Environment as follows:
THIS Source NAME    : setE3Env.bash
THIS Source PATH    : /epics/base-7.0.5/require/3.4.1/bin
EPICS_BASE          : /epics/base-7.0.5
EPICS_HOST_ARCH     : linux-x86_64
E3_REQUIRE_LOCATION : /epics/base-7.0.5/require/3.4.1
PATH                : /epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
LD_LIBRARY_PATH     : /epics/base-7.0.5/lib/linux-x86_64:/epics/base-7.0.5/require/3.4.1/lib/linux-x86_64

Enjoy E3!
registerChannelProviderLocal firstTime true
#
# Start at "2022-W06-Feb09-1643-44-CET"
#
# Version information:
# European Spallation Source ERIC : iocsh.bash (-PID-29271)
#
# --->--> snip -->--> 
# Please Use Version and other environment variables
# in order to report or debug this shell
#
# HOSTDISPLAY=""
# WINDOWID=""
# PWD="/home/anderssandstrom/sources/test_service"
# USER=""
# LOGNAME=""
# EPICS_HOST_ARCH="linux-x86_64"
# EPICS_BASE="/epics/base-7.0.5"
# E3_REQUIRE_NAME="require"
# E3_REQUIRE_VERSION="3.4.1"
# E3_REQUIRE_LOCATION="/epics/base-7.0.5/require/3.4.1"
# E3_REQUIRE_BIN="/epics/base-7.0.5/require/3.4.1/bin"
# E3_REQUIRE_DB="/epics/base-7.0.5/require/3.4.1/db"
# E3_REQUIRE_DBD="/epics/base-7.0.5/require/3.4.1/dbd"
# E3_REQUIRE_INC="/epics/base-7.0.5/require/3.4.1/include"
# E3_REQUIRE_LIB="/epics/base-7.0.5/require/3.4.1/lib"
# EPICS_DRIVER_PATH="/epics/base-7.0.5/require/3.4.1/siteMods:/epics/base-7.0.5/require/3.4.1/siteApps"
# EPICS_CA_AUTO_ADDR_LIST=""
# EPICS_CA_ADDR_LIST=""
# PATH="/epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
# --->--> snip -->--> 
#
# Set REQUIRE_IOC for its internal PVs
epicsEnvSet REQUIRE_IOC "REQMOD:mcag-dev-asm-02-29271"
#
# Enable an exit subroutine for sotfioc
dbLoadRecords "/epics/base-7.0.5/db/softIocExit.db" "IOC=REQMOD:mcag-dev-asm-02-29271"
#
# Set E3_IOCSH_TOP for the absolute path where iocsh.bash is executed.
epicsEnvSet E3_IOCSH_TOP "/home/anderssandstrom/sources/test_service"
#
# 
# Load require module, which has the version 3.4.1
# 
dlload /epics/base-7.0.5/require/3.4.1/lib/linux-x86_64/librequire.so
dbLoadDatabase /epics/base-7.0.5/require/3.4.1/dbd/require.dbd
require_registerRecordDeviceDriver
Loading module info records for require
# 
# Set E3_CMD_TOP for the absolute path where mcu1025.script exists
epicsEnvSet E3_CMD_TOP "/home/anderssandstrom/sources/test_service"
#
iocshLoad '/home/anderssandstrom/sources/test_service/mcu1025.script',''
##############################################################################
## Example config ESS crate of type MCU1025
##############################################################################
## Initiation:
epicsEnvSet("IOC" ,"IOC_TEST")
epicsEnvSet("ECMCCFG_INIT" ,"")  #Only run startup once (auto at PSI, need call at ESS), variable set to "#" in startup.cmd
epicsEnvSet("SCRIPTEXEC" ,"iocshLoad")
require ecmccfg 7.0.1
Module ecmccfg version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/lib/linux-x86_64/libecmccfg.so
Loaded ecmccfg version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/dbd/ecmccfg.dbd
Calling function ecmccfg_registerRecordDeviceDriver
Loading module info records for ecmccfg
# Epics Motor record driver that will be used:
epicsEnvShow(ECMC_MR_MODULE)
ECMC_MR_MODULE is not an environment variable.
# run module startup.cmd (only needed at ESS  PSI auto call at require)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/startup.cmd, "IOC=IOC_TEST,ECMC_VER=7.0.1"
#==============================================================================
# startup.cmd
on error halt
require ecmc        "7.0.1"
Module ecmc version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/
Module ecmc depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/lib/linux-x86_64/libasyn.so
Loaded asyn version 4.41.0+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/dbd/asyn.dbd
Calling function asyn_registerRecordDeviceDriver
Loading module info records for asyn
Module ecmc depends on exprtk 1.2.1+0
Module exprtk version 1.2.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/lib/linux-x86_64/libexprtk.so
Loaded exprtk version 1.2.1+0
exprtk has no dbd file
Loading module info records for exprtk
Module ecmc depends on motor 7.0.6+0
Module motor version 7.0.6+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/
Module motor depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 already loaded
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/lib/linux-x86_64/libmotor.so
Loaded motor version 7.0.6+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/dbd/motor.dbd
Calling function motor_registerRecordDeviceDriver
Loading module info records for motor
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/lib/linux-x86_64/libecmc.so
Loaded ecmc version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/dbd/ecmc.dbd
Calling function ecmc_registerRecordDeviceDriver
Loading module info records for ecmc
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'ecmcMotorRecord'='EthercatMC'", "require  EthercatMC 3.0.2 # Using EthercatMC motor record support.","# Using ecmcMotorRecord motor record support.")
# Using ecmcMotorRecord motor record support.
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_CONFIG_ROOT",     "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/")
epicsEnvSet("ECMC_CONFIG_DB",       "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/db")
epicsEnvSet("SCRIPTEXEC",           "iocshLoad")
epicsEnvSet("SM_PREFIX",            "IOC_TEST:")    # colon added since IOC is _not_ PREFIX
epicsEnvSet("ECMC_PROC_HOOK",       "")
epicsEnvSet(ECMC_MODE, FULL)
ecmcEpicsEnvSetCalcTernary(ECMC_SUPPORT_MOTION, "'FULL'=='FULL'","","# MODE == DAQ, DISABLING MOTION.")
epicsEnvShow(ECMC_SUPPORT_MOTION)
ECMC_SUPPORT_MOTION=
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd"
#==============================================================================
# initAll.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd
#==============================================================================
# init.cmd
epicsEnvSet("ECMC_ASYN_TIMEOUT",      1)                   # Asyn timeout
epicsEnvSet("ECMC_ASYN_ADDR",         0)                   # Asyn Address
epicsEnvSet("ECMC_MOTOR_PORT",        "NOT SET")
epicsEnvSet("ECMC_ASYN_PORT",         "NOT SET")
epicsEnvSet("ECMC_PREFIX",            "NOT SET")
epicsEnvSet("ECMC_GEN_EC_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_GEN_AX_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_EC_AXIS_HEALTH",    "NOT SET")
epicsEnvSet("ECMC_PLC_SAMPLE_RATE_MS", "NOT SET")
epicsEnvSet("ECMC_TSE",               -2)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd"
#==============================================================================
# initAxis.cmd
epicsEnvSet("ECMC_MOTOR_NAME",            "NOT SET")
epicsEnvSet("ECMC_R",                     "NOT SET")
epicsEnvSet("ECMC_AXIS_NO",               "NOT SET")
epicsEnvSet("ECMC_DESC",                  "NOT SET")
epicsEnvSet("ECMC_EGU",                   "NOT SET")       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "NOT SET")       # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "NOT SET")       # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "NOT SET")       # Entry for axis health output (example: ec0.s1.BO_1.0)
epicsEnvSet("ECMC_ENC_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_ENC_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_ENC_BITS",              "NOT SET")
epicsEnvSet("ECMC_ENC_TYPE",              "NOT SET")       # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "NOT SET")       # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_ENC_ABS_BITS",          "NOT SET")       # Absolute bit count (for absolute encoders) always least significant part
epicsEnvSet("ECMC_ENC_ABS_OFFSET",        "NOT SET")       # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_LATCHPOS",       "")              # Ethercat entry for latch position (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_CONTROL",  "")              # Ethercat entry for latch control (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_STATUS",   "")              # Ethercat entry for latch status (only valid for home seq 11,12)
epicsEnvSet("ECMC_DRV_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_DRV_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "NOT SET")       # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "NOT SET")       # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "NOT SET")       # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "NOT SET")       # Ethercat entry for brake output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "NOT SET")       # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_VELO",                  "NOT SET")
epicsEnvSet("ECMC_JOG_VEL",               "NOT SET")
epicsEnvSet("ECMC_JAR",                   "NOT SET")       # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "NOT SET")
epicsEnvSet("ECMC_EMERG_DECEL",           "NOT SET")       # Emergency deceleration
epicsEnvSet("ECMC_HOME_PROC",              "NOT SET")
epicsEnvSet("ECMC_HOME_POS",               "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_TO",            "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_FRM",           "NOT SET")
epicsEnvSet("ECMC_HOME_ACC",               "NOT SET")
epicsEnvSet("ECMC_HOME_DEC",               "NOT SET")
epicsEnvSet("ECMC_HOME_LATCH_COUNT_OFFSET","0")
epicsEnvSet("ECMC_CNTRL_KP",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KI",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KD",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KFF",             "NOT SET")
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "NOT SET")       #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "NOT SET")       #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "NOT SET")       #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "NOT SET")       #  Ethercat entry for external interlock input
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "NOT SET")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "NOT SET")
epicsEnvSet("ECMC_DXLM_ENABLE",           "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX",          "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "NOT SET")
epicsEnvSet("ECMC_EGU",               "mm")
epicsEnvSet("ECMC_PREC",              3)
epicsEnvSet("ECMC_AXISFIELDINIT",     "")                  # Extra field init to motor record
epicsEnvSet("ECMC_AXISCONFIG",        "")                  # Extra parameters to driver
############################################################
############# ASYN Configuration:
epicsEnvSet("ECMC_MOTOR_PORT"     "MCU1")
epicsEnvSet("ECMC_ASYN_PORT"      "MC_CPU1")
epicsEnvSet("ECMC_PREFIX"         "IOC_TEST:")
ecmcAsynPortDriverConfigure(MC_CPU1,1000,0,0,100)
ecmcAsynPortDriverConfigure: portName = MC_CPU1, paramTableSize = 1000, disableAutoConnect = 0, priority = 0, defaultSampleRateMS = 100.000000
asynOctetSetOutputEos(MC_CPU1, -1, ";\n")
asynOctetSetInputEos(MC_CPU1, -1, ";\n")
asynSetTraceMask(MC_CPU1, -1, 0x41)
asynSetTraceIOMask(MC_CPU1, -1, 6)
asynSetTraceInfoMask(MC_CPU1, -1, 1)
ecmcMotorRecordCreateController(MCU1, MC_CPU1, "64", 200, 1000, "")
############################################################
############# Misc settings:
# Disable function call trace printouts
ecmcConfigOrDie "Cfg.SetEnableFuncCallDiag(0)"
2022/02/09 16:43:44.222 
ECMC Initializes.............
2022/02/09 16:43:44.222 ESS Open Source EtherCAT Motion Control Epics Module2022/02/09 16:43:44.222 
Mode: Configuration
2022/02/09 16:43:44.222 OK
# Disable on change printouts from objects (enable for easy logging)
ecmcConfigOrDie "Cfg.SetTraceMaskBit(15,0)"
2022/02/09 16:43:44.223 OK
# Choose to generate EPICS-records for EtherCAT-entries
# (For records use ECMC_GEN_EC_RECORDS="-records" otherwise ECMC_GEN_EC_RECORDS="")
epicsEnvSet("ECMC_GEN_EC_RECORDS",          "-records")
# Choose to generate EPICS-records for ax-entries (PosAct, SetPos,..)
# (For records use ECMC_GEN_AX_RECORDS="-records" otherwise ECMC_GEN_AX_RECORDS="")
epicsEnvSet("ECMC_GEN_AX_RECORDS",          "-records")
# suffix for pva enabled scripts, templates and substitutions
ecmcEpicsEnvSetCalcTernary(ECMC_PVA, "0", "Pva","")
# Set EtherCAT frequency (defaults to 1000)
ecmcConfigOrDie "Cfg.SetSampleRate(1000)"
2022/02/09 16:43:44.224 OK
epicsEnvSet("ECMC_EC_SAMPLE_RATE" ,   1000)
ecmcEpicsEnvSetCalc("ECMC_EC_SAMPLE_RATE_MS" ,1000/1000)
# Update records in 10ms (100Hz) for FULL MODE and in EC_RATE for DAQ mode
ecmcEpicsEnvSetCalcTernary(ECMC_SAMPLE_RATE_MS, "'FULL'=='DAQ'","1","10")
epicsEnvSet("ECMC_P_SCRIPT",        "mXsXXX")
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd",1)
 iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd", "MASTER_ID=0"
#===============================================================================
# addMaster.cfg
epicsEnvSet("ECMC_EC_MASTER_ID"          "0")
# Claim master
ecmcConfigOrDie "Cfg.EcSetMaster(0)"
2022/02/09 16:43:44.227 OK
epicsEnvSet("ECMC_EC_MASTER_ID" ,0)
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd
#==============================================================================
# setDiagnostics.cmd
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:43:44.236 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:43:44.236 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:43:44.236 OK
epicsEnvSet("ECMCCFG_INIT" ,"#")
##############################################################################
## Configure hardware:
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd
############################################################
############# MCU1025:
#Configure EK1100 coupler terminal
epicsEnvSet(ECMC_EC_SLAVE_NUM,0)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=0, HW_DESC=EK1100"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "0")
epicsEnvSet("HW_DESC",            "EK1100")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EK1100")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x044c2c52")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,0,0x2,0x044c2c52)"
2022/02/09 16:43:44.246 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddSlave(0,0,0x2,0x044c2c52)"
2022/02/09 16:43:44.247 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "0","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s000")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s000-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEK1100.substitutions,ECMC_P=IOC_TEST:m0s000-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEK1100.substitutions,1,1)
dbLoadTemplate(ecmcEK1100.substitutions,"ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "0+1","%d")
#Configure EL1018 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "0+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=1, HW_DESC=EL1018"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "1")
epicsEnvSet("HW_DESC",            "EL1018")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1018")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x03fa3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,1,0x2,0x03fa3052)"
2022/02/09 16:43:44.291 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:43:44.293 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:43:44.293 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a02,0x6020,0x1,B1,binaryInput03)"
2022/02/09 16:43:44.293 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a03,0x6030,0x1,B1,binaryInput04)"
2022/02/09 16:43:44.293 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a04,0x6040,0x1,B1,binaryInput05)"
2022/02/09 16:43:44.293 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a05,0x6050,0x1,B1,binaryInput06)"
2022/02/09 16:43:44.294 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a06,0x6060,0x1,B1,binaryInput07)"
2022/02/09 16:43:44.294 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a07,0x6070,0x1,B1,binaryInput08)"
2022/02/09 16:43:44.294 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "1","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s001")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s001-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1018.substitutions,ECMC_P=IOC_TEST:m0s001-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1018.substitutions,1,1)
dbLoadTemplate(ecmcEL1018.substitutions,"ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "1+1","%d")
#Configure EL2808 digital output terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "1+1")
epicsEnvShow("ECMC_EC_SLAVE_NUM")
ECMC_EC_SLAVE_NUM=2
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=2, HW_DESC=EL2808"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "2")
epicsEnvSet("HW_DESC",            "EL2808")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL2808")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x0af83052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,2,0x2,0x0af83052)"
2022/02/09 16:43:44.305 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX2008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1600,0x7000,0x1,B1,binaryOutput01)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1601,0x7010,0x1,B1,binaryOutput02)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1602,0x7020,0x1,B1,binaryOutput03)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1603,0x7030,0x1,B1,binaryOutput04)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1604,0x7040,0x1,B1,binaryOutput05)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1605,0x7050,0x1,B1,binaryOutput06)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1606,0x7060,0x1,B1,binaryOutput07)"
2022/02/09 16:43:44.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1607,0x7070,0x1,B1,binaryOutput08)"
2022/02/09 16:43:44.308 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "2","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s002")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s002-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL2808.substitutions,ECMC_P=IOC_TEST:m0s002-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL2808.substitutions,1,1)
dbLoadTemplate(ecmcEL2808.substitutions,"ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "2+1","%d")
# Save the slave number for later
epicsEnvSet("ECMC_EC_SLAVE_NUM_DIG_OUT", "2")
#Configure EL5002 2-channel SSI encoder terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "2+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=3, HW_DESC=EL5002"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "3")
epicsEnvSet("HW_DESC",            "EL5002")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL5002")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x138a3052")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,3,0x2,0x138a3052)"
2022/02/09 16:43:44.322 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(3,0x1011,0x1,1684107116,4)"
2022/02/09 16:43:44.348 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(3,0x100a,0x0,2)"
2022/02/09 16:43:44.356 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x1,16,encoderStatus01)"
2022/02/09 16:43:44.356 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x11,32,positionActual01)"
2022/02/09 16:43:44.356 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x1,16,encoderStatus02)"
2022/02/09 16:43:44.356 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x11,32,positionActual02)"
2022/02/09 16:43:44.356 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "3","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s003")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s003-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL5002.substitutions,ECMC_P=IOC_TEST:m0s003-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL5002.substitutions,1,1)
dbLoadTemplate(ecmcEL5002.substitutions,"ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "3+1","%d")
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch1-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8000")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x1,0,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x2,0,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x3,0,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x4,0,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x6,1,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x9,3,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0xF,2,1)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x11,27,2)"
2022/02/09 16:43:44.371 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x12,25,2)"
2022/02/09 16:43:44.371 OK
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 2)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch2-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8010")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x1,0,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x2,0,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x3,0,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x4,0,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x6,1,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x9,3,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0xF,2,1)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x11,27,2)"
2022/02/09 16:43:44.375 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x12,25,2)"
2022/02/09 16:43:44.375 OK
# Configure EL9505 Power supply terminal 5V
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "3+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=4, HW_DESC=EL9505"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "4")
epicsEnvSet("HW_DESC",            "EL9505")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9505")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x25213052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,4,0x2,0x25213052)"
2022/02/09 16:43:44.379 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x1,1,powerOk01)"
2022/02/09 16:43:44.379 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x2,1,overload01)"
2022/02/09 16:43:44.379 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "4","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s004")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s004-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9505.substitutions,ECMC_P=IOC_TEST:m0s004-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9505.substitutions,1,1)
dbLoadTemplate(ecmcEL9505.substitutions,"ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "4+1","%d")
# Configure EL1252 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "4+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=5, HW_DESC=EL1252"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "5")
epicsEnvSet("HW_DESC",            "EL1252")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1252")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x04e43052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,5,0x2,0x04e43052)"
2022/02/09 16:43:44.389 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1002.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:43:44.391 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:43:44.391 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xae,U8,status01)"
2022/02/09 16:43:44.392 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xaf,U8,status02)"
2022/02/09 16:43:44.392 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb0,U64,timestampLatchPositive01)"
2022/02/09 16:43:44.392 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb8,U64,timestampLatchNegative01)"
2022/02/09 16:43:44.392 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc0,U64,timestampLatchPositive02)"
2022/02/09 16:43:44.392 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc8,U64,timestampLatchNegative02)"
2022/02/09 16:43:44.392 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "5","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s005")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s005-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1252.substitutions,ECMC_P=IOC_TEST:m0s005-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1252.substitutions,1,1)
dbLoadTemplate(ecmcEL1252.substitutions,"ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "5+1","%d")
# Configure EL9410 Power supply with refresh of E-Bus.
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "5+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=6, HW_DESC=EL9410"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "6")
epicsEnvSet("HW_DESC",            "EL9410")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9410")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x24c23052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,6,0x2,0x24c23052)"
2022/02/09 16:43:44.408 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a00,0x6000,0x1,1,underVoltageEbus01)"
2022/02/09 16:43:44.408 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a01,0x6000,0x1,1,underVoltagePower01)"
2022/02/09 16:43:44.408 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "6","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s006")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s006-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9410.substitutions,ECMC_P=IOC_TEST:m0s006-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9410.substitutions,1,1)
dbLoadTemplate(ecmcEL9410.substitutions,"ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "6+1","%d")
#Configure EL7037 stepper drive terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "6+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=7, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B, CFG_MACROS='I_RUN_MA=900,I_STDBY_MA=200'"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=7, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,7,0x2,0x1b7d3052)"
2022/02/09 16:43:44.420 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(7,0x1011,0x1,1684107116,4)"
2022/02/09 16:43:44.480 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(7,0x100a,0x0,2)"
2022/02/09 16:43:44.488 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:43:44.490 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x5,1,1)"
2022/02/09 16:43:44.491 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0xA,1,1)"
2022/02/09 16:43:44.491 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x8,1,1)"
2022/02/09 16:43:44.491 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x9,0,1)"
2022/02/09 16:43:44.491 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "7","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s007")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s007-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s007-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "7+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd "I_RUN_MA=900,I_STDBY_MA=200"
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,900)
epicsEnvSet(I_STDBY_MA_LOCAL,200)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=900,I_STDBY_MA=200,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "900>1500 or 900<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (900)...")
# Result: 
# Run current setting OK (900)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>1500 or 200<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (200)...")
# Result: 
# Standby current setting OK (200)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>900", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (200<900)...")
# Result: 
# Standby current and run current setting OK (200<900)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x1,900,2)"
2022/02/09 16:43:44.507 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x2,200,2)"
2022/02/09 16:43:44.508 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x3,2400,2)"
2022/02/09 16:43:44.508 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x4,175,2)"
2022/02/09 16:43:44.508 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x6,200,2)"
2022/02/09 16:43:44.508 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0xA,330,2)"
2022/02/09 16:43:44.508 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Configure EL7037 stepper drive terminal, motor 2
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "7+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=8, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=8, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,8,0x2,0x1b7d3052)"
2022/02/09 16:43:44.510 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(8,0x1011,0x1,1684107116,4)"
2022/02/09 16:43:44.566 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(8,0x100a,0x0,2)"
2022/02/09 16:43:44.574 13360
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "13360", "0x%04x")
# Firmware version: 0x3430
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:43:44.574 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:43:44.574 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:43:44.574 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x5,1,1)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0xA,1,1)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x8,1,1)"
2022/02/09 16:43:44.575 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x9,0,1)"
2022/02/09 16:43:44.575 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "8","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s008")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s008-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s008-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "8+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd ""
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,1000)
epicsEnvSet(I_STDBY_MA_LOCAL,500)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=1000,I_STDBY_MA=500,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "1000>1500 or 1000<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (1000)...")
# Result: 
# Run current setting OK (1000)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1500 or 500<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (500)...")
# Result: 
# Standby current setting OK (500)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1000", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (500<1000)...")
# Result: 
# Standby current and run current setting OK (500<1000)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x1,1000,2)"
2022/02/09 16:43:44.578 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x2,500,2)"
2022/02/09 16:43:44.579 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x3,2400,2)"
2022/02/09 16:43:44.579 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x4,175,2)"
2022/02/09 16:43:44.579 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x6,200,2)"
2022/02/09 16:43:44.579 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0xA,330,2)"
2022/02/09 16:43:44.579 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Apply hardware configuration
ecmcConfigOrDie "Cfg.EcApplyConfig(1)"
2022/02/09 16:43:44.580 OK
# ADDITIONAL SETUP
# Set all outputs to feed switches
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput01,1)"
2022/02/09 16:43:44.580 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput02,1)"
2022/02/09 16:43:44.580 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput03,1)"
2022/02/09 16:43:44.580 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput04,1)"
2022/02/09 16:43:44.580 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput05,1)"
2022/02/09 16:43:44.580 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput06,1)"
2022/02/09 16:43:44.581 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput07,1)"
2022/02/09 16:43:44.581 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput08,1)"
2022/02/09 16:43:44.581 OK
# END of ADDITIONAL SETUP
##############################################################################
## AXIS 1
#
epicsEnvSet("DEV",      "IOC_TEST")
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureAxis.cmd, CONFIG=./cfg/linear_1.ax)
#==============================================================================
# configureAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
ecmcFileExist("./cfg/linear_1.ax",1)
iocshLoad ./cfg/linear_1.ax ""
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis1")
epicsEnvSet("ECMC_R",                     "Axis1-")
epicsEnvSet("ECMC_AXIS_NO",               "1")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Lower Axis (1)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "-60")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "4096")
epicsEnvSet("ECMC_ENC_BITS"               "25")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "25")                       # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "25")                       # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "-100")                     # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s3.positionActual01")         # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "ec0.s3.encoderStatus01.0")      # Error 0: SSI input error
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "ec0.s3.encoderStatus01.1")      # Error 1: SSI frame error
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "ec0.s3.encoderStatus01.2")      # Error 2: Encoder power fail
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Drive
epicsEnvSet("ECMC_DRV_TYPE"               "0")                        # Stepper: 0. DS402: 1 (DS402 = servos and advanced stepper drives)
epicsEnvSet("ECMC_DRV_SCALE_NUM"          "600.0")                    # Fastest speed in engineering units
epicsEnvSet("ECMC_DRV_SCALE_DENOM"        "32768.0")                  # I/O range for ECMC_EC_ALIAS_DRV_VELO_SET
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "ec0.s7.driveControl01.0")     # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "ec0.s7.driveStatus01.1")      # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "ec0.s7.velocitySetpoint01") # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "ec0.s7.driveControl01.2")     # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "")                         # Ethercat entry for brake output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_EC_DRV_RESET",          "ec0.s7.driveControl01.1")     # Reset
epicsEnvSet("ECMC_EC_DRV_ALARM_0",        "ec0.s7.driveStatus01.3")      # Error
epicsEnvSet("ECMC_EC_DRV_ALARM_1",        "ec0.s7.driveStatus01.7")      # Stall
epicsEnvSet("ECMC_EC_DRV_ALARM_2",        "ec0.s7.driveStatus01.14")     # Sync error
epicsEnvSet("ECMC_EC_DRV_WARNING",        "ec0.s7.driveStatus01.2")      # Warning
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Controller
epicsEnvSet("ECMC_CNTRL_KP",              "15.0")
epicsEnvSet("ECMC_CNTRL_KI",              "0.02")
epicsEnvSet("ECMC_CNTRL_KD",              "0.0")
epicsEnvSet("ECMC_CNTRL_KFF",             "1.0")
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s1.binaryInput02.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s1.binaryInput01.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s1.binaryInput03.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s1.ONE.0")              #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "-50")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "80")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "1")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.1")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",     "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "100.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd
#==============================================================================
# addAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd
#==============================================================================
# ecmc_axis-records.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd
#==============================================================================
# ecmc_axis.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(-60)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == -60...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(-60)<>0","# ECMC_ENC_SCALE_NUM value OK == -60...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == -60...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(4096)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 4096...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(4096)<>0","# ECMC_ENC_SCALE_DENOM value OK == 4096...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 4096...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(600.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_NUM value OK == 600.0...',ERROR_STR='ECMC_DRV_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(600.0)<>0","# ECMC_DRV_SCALE_NUM value OK == 600.0...", "ecmcExit Error: ECMC_DRV_SCALE_NUM == 0...")
# ECMC_DRV_SCALE_NUM value OK == 600.0...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(32768.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_DENOM value OK == 32768.0...',ERROR_STR='ECMC_DRV_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(32768.0)<>0","# ECMC_DRV_SCALE_DENOM value OK == 32768.0...", "ecmcExit Error: ECMC_DRV_SCALE_DENOM == 0...")
# ECMC_DRV_SCALE_DENOM value OK == 32768.0...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(1,1,0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.health")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisModRange(1, 0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisModType(1, 0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(1,0.1)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(1,5.0,0.1)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelTwordsCam(1,5)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(1,4)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKp(1,15.0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKi(1,0.02)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKd(1,0.0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKff(1,1.0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.positionActual01,"ax1.enc.actpos")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(1,4096)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(1,-60)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncType(1,1)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncBits(1,25)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(1,25)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncOffset(1,-100)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(1,100)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(1,1)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(1,0)"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.reset")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.0,"ax1.enc.alarm0")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.1,"ax1.enc.alarm1")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.2,"ax1.enc.alarm2")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.warning")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchpos")"
2022/02/09 16:43:44.597 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchcontrol")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchstatus")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.0,"ax1.drv.control")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.1,"ax1.drv.status")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.velocitySetpoint01,"ax1.drv.velocity")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.position")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.brake")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.2,"ax1.drv.reducetorque")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.1,"ax1.drv.reset")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.3,"ax1.drv.alarm0")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.7,"ax1.drv.alarm1")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.14,"ax1.drv.alarm2")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.2,"ax1.drv.warning")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleDenom(1,32768.0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleNum(1,600.0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeOpenDelayTime(1,0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeCloseAheadTime(1,0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(1,-50)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(1,1)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(1,80)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(1,1)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput02.0,"ax1.mon.lowlim")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput01.0,"ax1.mon.highlim")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput03.0,"ax1.mon.homesensor")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.ONE.0,"ax1.mon.extinterlock")"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(1,0.1)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(1,100)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(1,1)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(1,0.5)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(1,100)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(1,1)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(1,100.0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(1,1)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(1,200)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(1,100)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(1,0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(1,0)"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Main.M1.fHomePosition=0.0"
2022/02/09 16:43:44.598 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(1, 0)"
2022/02/09 16:43:44.599 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(1, 0)"
2022/02/09 16:43:44.599 OK
ecmcMotorRecordCreateAxis(MCU1, "1", "6", )
2022/02/09 16:43:44.599 ecmcMotorRecord:: setIntegerParam(1 motorPowerAutoOnOff_)=2
2022/02/09 16:43:44.599 ecmcMotorRecord:: setDoubleParam(1 motorPowerOnDelay_)=6
2022/02/09 16:43:44.599 ecmcMotorRecord:: setDoubleParam(1 motorPowerOffDelay_=-1
2022/02/09 16:43:44.599 ecmcMotorRecord:: udateMotorLimitsRO(1) enabledHighAndLow=1 valid=1 fValueHigh=80 fValueLow=-50
2022/02/09 16:43:44.599 ecmcMotorRecord:: connected(1)
2022/02/09 16:43:44.599 ecmcMotorRecord:: initialPoll(1) status=0
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(4096)>0){RESULT:=abs(4096);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(-60)>0){RESULT:=abs(-60);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1, DESC=MCU1025 Lower Axis (1), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.1, DLLM=-50, DHLM=80, HOMEPROC=3,SREV=4096,UREV=60.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_NO=1,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_TYPE=1")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd
#==============================================================================
# ecmc_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_CNTRL_KP)
epicsEnvUnset(ECMC_CNTRL_KI)
epicsEnvUnset(ECMC_CNTRL_KD)
epicsEnvUnset(ECMC_CNTRL_KFF)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCHPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCH_CONTROL)
epicsEnvUnset(ECMC_EC_ENC_LATCH_STATUS)
epicsEnvUnset(ECMC_HOME_LATCH_COUNT_OFFSET)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_DRV_CONTROL)
epicsEnvUnset(ECMC_EC_DRV_STATUS)
epicsEnvUnset(ECMC_EC_DRV_VELOCITY)
epicsEnvUnset(ECMC_EC_DRV_BRAKE)
epicsEnvUnset(ECMC_EC_DRV_REDUCE_TORQUE)
epicsEnvUnset(ECMC_EC_DRV_RESET)
epicsEnvUnset(ECMC_EC_DRV_ALARM_0)
epicsEnvUnset(ECMC_EC_DRV_ALARM_1)
epicsEnvUnset(ECMC_EC_DRV_ALARM_2)
epicsEnvUnset(ECMC_EC_DRV_WARNING)
epicsEnvUnset(ECMC_DRV_SCALE_DENOM)
epicsEnvUnset(ECMC_DRV_SCALE_NUM)
epicsEnvUnset(ECMC_DRV_BRAKE_OPEN_DLY_TIME)
epicsEnvUnset(ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
##############################################################################
## AXIS 2
#
#epicsEnvSet("DEV",      "$(IOC)")
#$(SCRIPTEXEC) ($(ecmccfg_DIR)configureAxis.cmd, CONFIG=./cfg/linear_2.ax)
##############################################################################
############# Configure diagnostics:
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:43:44.622 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:43:44.622 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:43:44.622 OK
ecmcConfigOrDie "Cfg.SetDiagAxisIndex(1)"
2022/02/09 16:43:44.622 OK
ecmcConfigOrDie "Cfg.SetDiagAxisFreq(2)"
2022/02/09 16:43:44.622 OK
ecmcConfigOrDie "Cfg.SetDiagAxisEnable(0)"
2022/02/09 16:43:44.622 OK
# go active
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setAppMode.cmd)
2022/02/09 16:43:44.622 ecmcMotorRecord:: poll(1) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000012
2022/02/09 16:43:44.622 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:43:44.622 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
#==============================================================================
# setAppMode.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd
#==============================================================================
# general.cmd
ecmcFileExist("ecmcGeneral.db",1,1)
dbLoadRecords("ecmcGeneral.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2,ECMC_PROC_HOOK=")
# Examples of commands for info:
# ecmcReport <level> or asynReport <level>
# ecmcReport 3
# ecmcGrepParam <pattern>
# List all ecmc params for ethercat slave 2:
# ecmcGrepParam *s2*
#
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("ecmcEc.db",1,1)
 dbLoadRecords("ecmcEc.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,T_SMP_MS=10,TSE=-2")
ecmcConfigOrDie "Cfg.SetAppMode(1)"
2022/02/09 16:43:44.632 INFO: Locking memory
2022/02/09 16:43:44.669 Starting up EtherCAT bus: 0 second(s). Max wait time 30 second(s).
2022/02/09 16:43:44.733 ../devEcmcSup/motion/ecmcMonitor.cpp/checkLimits:501: ERROR_MON_BOTH_LIMIT_INTERLOCK (0x14c10).
2022/02/09 16:43:44.733 ../devEcmcSup/motion/ecmcAxisReal.cpp/execute:198: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 0: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 1: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 2: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 3: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 4: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 5: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 6: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 7: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 8: Not operational (0x24011).
2022/02/09 16:43:44.733 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:43:44.823 ecmcMotorRecord:: poll(1) homed=1
2022/02/09 16:43:44.823 ecmcMotorRecord:: poll(1) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=-100 time=0.000017
2022/02/09 16:43:44.823 ecmcMotorRecord:: poll(1) bError=1 drvlocal.statusBinData.onChangeData.error=0x14315
2022/02/09 16:43:44.823 ecmcMotorRecord:: sErrorMessage(1)="ERROR_AXIS_HARDWARE_STATUS_NOT_OK"
2022/02/09 16:43:44.823 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=1 old=4 ErrID=0x14315 old=0x0 Warn=0 nCmd=0 old=0 txt=E: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315)
2022/02/09 16:43:45.322 ../devEcmcSup/motion/ecmcDriveBase.cpp/readEntries:369: WARNING (axis 1): Drive hardware in warning state.
2022/02/09 16:43:45.669 Starting up EtherCAT bus: 1 second(s). Max wait time 30 second(s).
2022/02/09 16:43:45.736 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:43:45.736 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:43:45.736 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:43:45.823 ecmcMotorRecord:: poll(1) LLS=0
2022/02/09 16:43:45.823 ecmcMotorRecord:: poll(1) HLS=0
2022/02/09 16:43:45.823 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:43:45.823 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=0 old=1 ErrID=0x0 old=0x14315 Warn=0 nCmd=0 old=0 txt=NULL
2022/02/09 16:43:47.669 EtherCAT bus started!
2022/02/09 16:43:47.669 OK
# Set the IOC Prompt String One 
epicsEnvSet IOCSH_PS1 "mcag-dev-asm-02-29271 > "
#
# 
iocInit
2022/02/09 16:43:47.670 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocBuild (0). Allow callbacks: true.
Starting iocInit
2022/02/09 16:43:47.670 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtBeginning (1). Allow callbacks: true.
############################################################################
## EPICS R7.0.5-E3-7.0.5-patch
## Rev. 2021-03-19T22:08+0100
############################################################################
2022/02/09 16:43:47.672 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCallbackInit (2). Allow callbacks: true.
2022/02/09 16:43:47.674 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaLinkInit (3). Allow callbacks: true.
2022/02/09 16:43:47.674 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDrvSup (4). Allow callbacks: true.
2022/02/09 16:43:47.674 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitRecSup (5). Allow callbacks: true.
2022/02/09 16:43:47.674 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDevSup (6). Allow callbacks: true.
2022/02/09 16:43:47.675 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput01 linked to record (asyn reason 1).
2022/02/09 16:43:47.675 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput02 linked to record (asyn reason 2).
2022/02/09 16:43:47.676 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput03 linked to record (asyn reason 3).
2022/02/09 16:43:47.676 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput04 linked to record (asyn reason 4).
2022/02/09 16:43:47.676 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput05 linked to record (asyn reason 5).
2022/02/09 16:43:47.676 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput06 linked to record (asyn reason 6).
2022/02/09 16:43:47.677 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput07 linked to record (asyn reason 7).
2022/02/09 16:43:47.677 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput08 linked to record (asyn reason 8).
2022/02/09 16:43:47.677 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.reset linked to record (asyn reason 9).
2022/02/09 16:43:47.677 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveControl01 linked to record (asyn reason 10).
2022/02/09 16:43:47.677 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.velocitySetpoint01 linked to record (asyn reason 11).
2022/02/09 16:43:47.677 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderControl01 linked to record (asyn reason 12).
2022/02/09 16:43:47.678 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderValue01 linked to record (asyn reason 13).
2022/02/09 16:43:47.678 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveControl01 linked to record (asyn reason 14).
2022/02/09 16:43:47.678 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.velocitySetpoint01 linked to record (asyn reason 15).
2022/02/09 16:43:47.678 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderControl01 linked to record (asyn reason 16).
2022/02/09 16:43:47.679 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderValue01 linked to record (asyn reason 17).
2022/02/09 16:43:47.679 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus01 linked to record (asyn reason 18).
2022/02/09 16:43:47.679 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus02 linked to record (asyn reason 19).
2022/02/09 16:43:47.679 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status01 linked to record (asyn reason 20).
2022/02/09 16:43:47.680 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status02 linked to record (asyn reason 21).
2022/02/09 16:43:47.680 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveStatus01 linked to record (asyn reason 22).
2022/02/09 16:43:47.680 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderStatus01 linked to record (asyn reason 23).
2022/02/09 16:43:47.680 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveStatus01 linked to record (asyn reason 24).
2022/02/09 16:43:47.680 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderStatus01 linked to record (asyn reason 25).
2022/02/09 16:43:47.680 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.diagnostic linked to record (asyn reason 26).
2022/02/09 16:43:47.681 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.plc.expression linked to record (asyn reason 27).
2022/02/09 16:43:47.681 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.msg linked to record (asyn reason 28).
2022/02/09 16:43:47.681 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.updated linked to record (asyn reason 29).
2022/02/09 16:43:47.681 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.slavestatus linked to record (asyn reason 30).
2022/02/09 16:43:47.681 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.slavestatus linked to record (asyn reason 31).
2022/02/09 16:43:47.682 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.slavestatus linked to record (asyn reason 32).
2022/02/09 16:43:47.682 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.slavestatus linked to record (asyn reason 33).
2022/02/09 16:43:47.682 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.slavestatus linked to record (asyn reason 34).
2022/02/09 16:43:47.682 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.slavestatus linked to record (asyn reason 35).
2022/02/09 16:43:47.683 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.slavestatus linked to record (asyn reason 36).
2022/02/09 16:43:47.683 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.slavestatus linked to record (asyn reason 37).
2022/02/09 16:43:47.683 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.slavestatus linked to record (asyn reason 38).
2022/02/09 16:43:47.683 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.status linked to record (asyn reason 39).
2022/02/09 16:43:47.684 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.masterstatus linked to record (asyn reason 40).
2022/02/09 16:43:47.684 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.slavecounter linked to record (asyn reason 41).
2022/02/09 16:43:47.684 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.memmapcounter linked to record (asyn reason 42).
2022/02/09 16:43:47.684 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainfailcountertotal linked to record (asyn reason 43).
2022/02/09 16:43:47.685 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.entrycounter linked to record (asyn reason 44).
2022/02/09 16:43:47.685 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainstatus linked to record (asyn reason 45).
2022/02/09 16:43:47.685 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput01 linked to record (asyn reason 46).
2022/02/09 16:43:47.686 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput02 linked to record (asyn reason 47).
2022/02/09 16:43:47.686 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput03 linked to record (asyn reason 48).
2022/02/09 16:43:47.687 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput04 linked to record (asyn reason 49).
2022/02/09 16:43:47.687 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput05 linked to record (asyn reason 50).
2022/02/09 16:43:47.688 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput06 linked to record (asyn reason 51).
2022/02/09 16:43:47.688 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput07 linked to record (asyn reason 52).
2022/02/09 16:43:47.689 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput08 linked to record (asyn reason 53).
2022/02/09 16:43:47.690 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.powerOk01 linked to record (asyn reason 54).
2022/02/09 16:43:47.690 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.overload01 linked to record (asyn reason 55).
2022/02/09 16:43:47.692 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput01 linked to record (asyn reason 56).
2022/02/09 16:43:47.692 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput02 linked to record (asyn reason 57).
2022/02/09 16:43:47.693 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltageEbus01 linked to record (asyn reason 58).
2022/02/09 16:43:47.694 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltagePower01 linked to record (asyn reason 59).
2022/02/09 16:43:47.695 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.enable linked to record (asyn reason 60).
2022/02/09 16:43:47.695 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.firstscan linked to record (asyn reason 61).
2022/02/09 16:43:47.696 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.ok linked to record (asyn reason 62).
2022/02/09 16:43:47.697 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.control linked to record (asyn reason 63).
2022/02/09 16:43:47.697 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ONE linked to record (asyn reason 64).
2022/02/09 16:43:47.699 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ZERO linked to record (asyn reason 65).
2022/02/09 16:43:47.699 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ONE linked to record (asyn reason 66).
2022/02/09 16:43:47.700 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ZERO linked to record (asyn reason 67).
2022/02/09 16:43:47.701 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ONE linked to record (asyn reason 68).
2022/02/09 16:43:47.702 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ZERO linked to record (asyn reason 69).
2022/02/09 16:43:47.702 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ONE linked to record (asyn reason 70).
2022/02/09 16:43:47.703 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ZERO linked to record (asyn reason 71).
2022/02/09 16:43:47.704 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ONE linked to record (asyn reason 72).
2022/02/09 16:43:47.705 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ZERO linked to record (asyn reason 73).
2022/02/09 16:43:47.705 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ONE linked to record (asyn reason 74).
2022/02/09 16:43:47.706 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ZERO linked to record (asyn reason 75).
2022/02/09 16:43:47.707 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ONE linked to record (asyn reason 76).
2022/02/09 16:43:47.708 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ZERO linked to record (asyn reason 77).
2022/02/09 16:43:47.709 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ONE linked to record (asyn reason 78).
2022/02/09 16:43:47.709 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ZERO linked to record (asyn reason 79).
2022/02/09 16:43:47.710 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ONE linked to record (asyn reason 80).
2022/02/09 16:43:47.711 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ZERO linked to record (asyn reason 81).
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeFallTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeFallTS
2022/02/09 16:43:47.712 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual01 linked to record (asyn reason 82).
2022/02/09 16:43:47.713 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual02 linked to record (asyn reason 83).
2022/02/09 16:43:47.714 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive01 linked to record (asyn reason 84).
2022/02/09 16:43:47.714 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative01 linked to record (asyn reason 85).
2022/02/09 16:43:47.715 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive02 linked to record (asyn reason 86).
2022/02/09 16:43:47.716 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative02 linked to record (asyn reason 87).
2022/02/09 16:43:47.718 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.positionActual01 linked to record (asyn reason 88).
2022/02/09 16:43:47.719 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderLatchPostion01 linked to record (asyn reason 89).
2022/02/09 16:43:47.722 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.positionActual01 linked to record (asyn reason 90).
2022/02/09 16:43:47.723 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderLatchPostion01 linked to record (asyn reason 91).
2022/02/09 16:43:47.725 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.actpos linked to record (asyn reason 92).
2022/02/09 16:43:47.725 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.setpos linked to record (asyn reason 93).
2022/02/09 16:43:47.726 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.poserr linked to record (asyn reason 94).
2022/02/09 16:43:47.727 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.error linked to record (asyn reason 95).
2022/02/09 16:43:47.728 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.appmode linked to record (asyn reason 96).
2022/02/09 16:43:47.729 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.id linked to record (asyn reason 97).
2022/02/09 16:43:47.730 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.min linked to record (asyn reason 98).
2022/02/09 16:43:47.731 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.max linked to record (asyn reason 99).
2022/02/09 16:43:47.732 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.min linked to record (asyn reason 100).
2022/02/09 16:43:47.733 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.max linked to record (asyn reason 101).
2022/02/09 16:43:47.734 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.min linked to record (asyn reason 102).
2022/02/09 16:43:47.735 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.max linked to record (asyn reason 103).
2022/02/09 16:43:47.735 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.min linked to record (asyn reason 104).
2022/02/09 16:43:47.736 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.max linked to record (asyn reason 105).
2022/02/09 16:43:47.737 [devMotorAsyn.c:439  IOC_TEST:Axis1] init_record IOC_TEST:Axis1 position=-34.506836 encoderPos=-34.506836 velocity=0.000000 MSTAstatus=0x490a flagsValue=0x1f flagsWritten=0x1f pmr->mflg=0x0
2022/02/09 16:43:47.737 [devMotorAsyn.c:185  IOC_TEST:Axis1] init_controller IOC_TEST:Axis1 set encoder ratio=1.000000 status=0
2022/02/09 16:43:47.737 [devMotorAsyn.c:266  IOC_TEST:Axis1] update_soft_limits IOC_TEST:Axis1 RawHLM_RO=80.000000 RawLLM_RO=-50.000000 valid=1 DHLM_RO=80.000000 DLLM_RO=-50.000000
2022/02/09 16:43:47.737 [motorDevSup.c:327  IOC_TEST:Axis1] PositionRestoreNeeded IOC_TEST:Axis1 rstm=2 dval=0.000000 drbv=-34.506836 pmr->rdbd=0.100000 rdbd=0.100000 pmr->mres=0.014648 pmr->mflg=0x1f dval_non_zero_pos_near_zero=0 ret=0
2022/02/09 16:43:47.737 [motorRecord.cc:781  IOC_TEST:Axis1] init_re_init start neverPolled=0 stat=17 nsta=0
2022/02/09 16:43:47.737 [motorRecord.cc:719  IOC_TEST:Axis1] enforceMinRetryDeadband spdb=0.100000 rdbd=0.100000 mres=0.014648
2022/02/09 16:43:47.737 [motorRecord.cc:4373 IOC_TEST:Axis1] pmr->dhlm=80 softLimitRO=80
2022/02/09 16:43:47.737 [motorRecord.cc:4434 IOC_TEST:Axis1] pmr->dllm=-50 softLimitRO=-50
2022/02/09 16:43:47.737 [motorRecord.cc:832  IOC_TEST:Axis1] init_re_init  end dval=-34.506836 drbv=-34.506836 rdbd=0.100000 spdb=0.100000
2022/02/09 16:43:47.737 ecmcMotorRecord:: setIntegerParam(1 motorUpdateStatus_)=0
2022/02/09 16:43:47.737 [motorRecord.cc:967  IOC_TEST:Axis1] init_record process_reason="callbackdata + soft limits" dval=-34.506836 drbv=-34.506836 rdbd=0.100000 spdb=0.100000 stat=0 msta=0x490a neverPolled=0
2022/02/09 16:43:47.745 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDatabase (7). Allow callbacks: true.
2022/02/09 16:43:47.745 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterFinishDevSup (8). Allow callbacks: true.
2022/02/09 16:43:48.251 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterScanInit (9). Allow callbacks: true.
2022/02/09 16:43:48.251 ecmcMotorRecord:: setDoubleParam(1 HomPos_)=0.000000
2022/02/09 16:43:48.251 ecmcMotorRecord:: setIntegerParam(1 HomProc_)=3 motorNotHomedProblem=0
2022/02/09 16:43:48.252 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitialProcess (10). Allow callbacks: true.
2022/02/09 16:43:48.256 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (11). Allow callbacks: true.
2022/02/09 16:43:48.256 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocBuilt (12). Allow callbacks: true.
2022/02/09 16:43:48.261 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocRun (13). Allow callbacks: true.
2022/02/09 16:43:48.261 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterDatabaseRunning (14). Allow callbacks: true.
2022/02/09 16:43:48.261 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInterruptAccept (28). Allow callbacks: true.
2022/02/09 16:43:48.261 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaServerRunning (15). Allow callbacks: true.
2022/02/09 16:43:48.261 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (29). Allow callbacks: true.
iocRun: All initialization complete
2022/02/09 16:43:48.268 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocRunning (16). Allow callbacks: true.
mcag-dev-asm-02-29271 > @@@ Current time: Wed Feb  9 16:45:13 2022
@@@ Child process is shutting down, a new one will be restarted shortly
@@@ ^R or ^X restarts the child, ^Q quits the server
@@@ Restarting child "mcu1025"
@@@    (as /epics/base-7.0.5/require/3.4.1/bin/iocsh.bash)
@@@ The PID of new child "mcu1025" is: 29699
@@@ @@@ @@@ @@@ @@@
Loading environment variables from /home/anderssandstrom/sources/test_service/env.sh

Set the ESS EPICS Environment as follows:
THIS Source NAME    : setE3Env.bash
THIS Source PATH    : /epics/base-7.0.5/require/3.4.1/bin
EPICS_BASE          : /epics/base-7.0.5
EPICS_HOST_ARCH     : linux-x86_64
E3_REQUIRE_LOCATION : /epics/base-7.0.5/require/3.4.1
PATH                : /epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
LD_LIBRARY_PATH     : /epics/base-7.0.5/lib/linux-x86_64:/epics/base-7.0.5/require/3.4.1/lib/linux-x86_64

Enjoy E3!
registerChannelProviderLocal firstTime true
#
# Start at "2022-W06-Feb09-1648-14-CET"
#
# Version information:
# European Spallation Source ERIC : iocsh.bash (-PID-29699)
#
# --->--> snip -->--> 
# Please Use Version and other environment variables
# in order to report or debug this shell
#
# HOSTDISPLAY=""
# WINDOWID=""
# PWD="/home/anderssandstrom/sources/test_service"
# USER=""
# LOGNAME=""
# EPICS_HOST_ARCH="linux-x86_64"
# EPICS_BASE="/epics/base-7.0.5"
# E3_REQUIRE_NAME="require"
# E3_REQUIRE_VERSION="3.4.1"
# E3_REQUIRE_LOCATION="/epics/base-7.0.5/require/3.4.1"
# E3_REQUIRE_BIN="/epics/base-7.0.5/require/3.4.1/bin"
# E3_REQUIRE_DB="/epics/base-7.0.5/require/3.4.1/db"
# E3_REQUIRE_DBD="/epics/base-7.0.5/require/3.4.1/dbd"
# E3_REQUIRE_INC="/epics/base-7.0.5/require/3.4.1/include"
# E3_REQUIRE_LIB="/epics/base-7.0.5/require/3.4.1/lib"
# EPICS_DRIVER_PATH="/epics/base-7.0.5/require/3.4.1/siteMods:/epics/base-7.0.5/require/3.4.1/siteApps"
# EPICS_CA_AUTO_ADDR_LIST=""
# EPICS_CA_ADDR_LIST=""
# PATH="/epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
# --->--> snip -->--> 
#
# Set REQUIRE_IOC for its internal PVs
epicsEnvSet REQUIRE_IOC "REQMOD:mcag-dev-asm-02-29699"
#
# Enable an exit subroutine for sotfioc
dbLoadRecords "/epics/base-7.0.5/db/softIocExit.db" "IOC=REQMOD:mcag-dev-asm-02-29699"
#
# Set E3_IOCSH_TOP for the absolute path where iocsh.bash is executed.
epicsEnvSet E3_IOCSH_TOP "/home/anderssandstrom/sources/test_service"
#
# 
# Load require module, which has the version 3.4.1
# 
dlload /epics/base-7.0.5/require/3.4.1/lib/linux-x86_64/librequire.so
dbLoadDatabase /epics/base-7.0.5/require/3.4.1/dbd/require.dbd
require_registerRecordDeviceDriver
Loading module info records for require
# 
# Set E3_CMD_TOP for the absolute path where mcu1025.script exists
epicsEnvSet E3_CMD_TOP "/home/anderssandstrom/sources/test_service"
#
iocshLoad '/home/anderssandstrom/sources/test_service/mcu1025.script',''
##############################################################################
## Example config ESS crate of type MCU1025
##############################################################################
## Initiation:
epicsEnvSet("IOC" ,"IOC_TEST")
epicsEnvSet("ECMCCFG_INIT" ,"")  #Only run startup once (auto at PSI, need call at ESS), variable set to "#" in startup.cmd
epicsEnvSet("SCRIPTEXEC" ,"iocshLoad")
require ecmccfg 7.0.1
Module ecmccfg version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/lib/linux-x86_64/libecmccfg.so
Loaded ecmccfg version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/dbd/ecmccfg.dbd
Calling function ecmccfg_registerRecordDeviceDriver
Loading module info records for ecmccfg
# Epics Motor record driver that will be used:
epicsEnvShow(ECMC_MR_MODULE)
ECMC_MR_MODULE is not an environment variable.
# run module startup.cmd (only needed at ESS  PSI auto call at require)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/startup.cmd, "IOC=IOC_TEST,ECMC_VER=7.0.1"
#==============================================================================
# startup.cmd
on error halt
require ecmc        "7.0.1"
Module ecmc version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/
Module ecmc depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/lib/linux-x86_64/libasyn.so
Loaded asyn version 4.41.0+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/dbd/asyn.dbd
Calling function asyn_registerRecordDeviceDriver
Loading module info records for asyn
Module ecmc depends on exprtk 1.2.1+0
Module exprtk version 1.2.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/lib/linux-x86_64/libexprtk.so
Loaded exprtk version 1.2.1+0
exprtk has no dbd file
Loading module info records for exprtk
Module ecmc depends on motor 7.0.6+0
Module motor version 7.0.6+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/
Module motor depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 already loaded
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/lib/linux-x86_64/libmotor.so
Loaded motor version 7.0.6+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/dbd/motor.dbd
Calling function motor_registerRecordDeviceDriver
Loading module info records for motor
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/lib/linux-x86_64/libecmc.so
Loaded ecmc version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/dbd/ecmc.dbd
Calling function ecmc_registerRecordDeviceDriver
Loading module info records for ecmc
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'ecmcMotorRecord'='EthercatMC'", "require  EthercatMC 3.0.2 # Using EthercatMC motor record support.","# Using ecmcMotorRecord motor record support.")
# Using ecmcMotorRecord motor record support.
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_CONFIG_ROOT",     "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/")
epicsEnvSet("ECMC_CONFIG_DB",       "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/db")
epicsEnvSet("SCRIPTEXEC",           "iocshLoad")
epicsEnvSet("SM_PREFIX",            "IOC_TEST:")    # colon added since IOC is _not_ PREFIX
epicsEnvSet("ECMC_PROC_HOOK",       "")
epicsEnvSet(ECMC_MODE, FULL)
ecmcEpicsEnvSetCalcTernary(ECMC_SUPPORT_MOTION, "'FULL'=='FULL'","","# MODE == DAQ, DISABLING MOTION.")
epicsEnvShow(ECMC_SUPPORT_MOTION)
ECMC_SUPPORT_MOTION=
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd"
#==============================================================================
# initAll.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd
#==============================================================================
# init.cmd
epicsEnvSet("ECMC_ASYN_TIMEOUT",      1)                   # Asyn timeout
epicsEnvSet("ECMC_ASYN_ADDR",         0)                   # Asyn Address
epicsEnvSet("ECMC_MOTOR_PORT",        "NOT SET")
epicsEnvSet("ECMC_ASYN_PORT",         "NOT SET")
epicsEnvSet("ECMC_PREFIX",            "NOT SET")
epicsEnvSet("ECMC_GEN_EC_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_GEN_AX_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_EC_AXIS_HEALTH",    "NOT SET")
epicsEnvSet("ECMC_PLC_SAMPLE_RATE_MS", "NOT SET")
epicsEnvSet("ECMC_TSE",               -2)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd"
#==============================================================================
# initAxis.cmd
epicsEnvSet("ECMC_MOTOR_NAME",            "NOT SET")
epicsEnvSet("ECMC_R",                     "NOT SET")
epicsEnvSet("ECMC_AXIS_NO",               "NOT SET")
epicsEnvSet("ECMC_DESC",                  "NOT SET")
epicsEnvSet("ECMC_EGU",                   "NOT SET")       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "NOT SET")       # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "NOT SET")       # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "NOT SET")       # Entry for axis health output (example: ec0.s1.BO_1.0)
epicsEnvSet("ECMC_ENC_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_ENC_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_ENC_BITS",              "NOT SET")
epicsEnvSet("ECMC_ENC_TYPE",              "NOT SET")       # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "NOT SET")       # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_ENC_ABS_BITS",          "NOT SET")       # Absolute bit count (for absolute encoders) always least significant part
epicsEnvSet("ECMC_ENC_ABS_OFFSET",        "NOT SET")       # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_LATCHPOS",       "")              # Ethercat entry for latch position (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_CONTROL",  "")              # Ethercat entry for latch control (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_STATUS",   "")              # Ethercat entry for latch status (only valid for home seq 11,12)
epicsEnvSet("ECMC_DRV_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_DRV_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "NOT SET")       # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "NOT SET")       # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "NOT SET")       # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "NOT SET")       # Ethercat entry for brake output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "NOT SET")       # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_VELO",                  "NOT SET")
epicsEnvSet("ECMC_JOG_VEL",               "NOT SET")
epicsEnvSet("ECMC_JAR",                   "NOT SET")       # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "NOT SET")
epicsEnvSet("ECMC_EMERG_DECEL",           "NOT SET")       # Emergency deceleration
epicsEnvSet("ECMC_HOME_PROC",              "NOT SET")
epicsEnvSet("ECMC_HOME_POS",               "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_TO",            "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_FRM",           "NOT SET")
epicsEnvSet("ECMC_HOME_ACC",               "NOT SET")
epicsEnvSet("ECMC_HOME_DEC",               "NOT SET")
epicsEnvSet("ECMC_HOME_LATCH_COUNT_OFFSET","0")
epicsEnvSet("ECMC_CNTRL_KP",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KI",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KD",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KFF",             "NOT SET")
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "NOT SET")       #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "NOT SET")       #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "NOT SET")       #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "NOT SET")       #  Ethercat entry for external interlock input
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "NOT SET")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "NOT SET")
epicsEnvSet("ECMC_DXLM_ENABLE",           "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX",          "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "NOT SET")
epicsEnvSet("ECMC_EGU",               "mm")
epicsEnvSet("ECMC_PREC",              3)
epicsEnvSet("ECMC_AXISFIELDINIT",     "")                  # Extra field init to motor record
epicsEnvSet("ECMC_AXISCONFIG",        "")                  # Extra parameters to driver
############################################################
############# ASYN Configuration:
epicsEnvSet("ECMC_MOTOR_PORT"     "MCU1")
epicsEnvSet("ECMC_ASYN_PORT"      "MC_CPU1")
epicsEnvSet("ECMC_PREFIX"         "IOC_TEST:")
ecmcAsynPortDriverConfigure(MC_CPU1,1000,0,0,100)
ecmcAsynPortDriverConfigure: portName = MC_CPU1, paramTableSize = 1000, disableAutoConnect = 0, priority = 0, defaultSampleRateMS = 100.000000
asynOctetSetOutputEos(MC_CPU1, -1, ";\n")
asynOctetSetInputEos(MC_CPU1, -1, ";\n")
asynSetTraceMask(MC_CPU1, -1, 0x41)
asynSetTraceIOMask(MC_CPU1, -1, 6)
asynSetTraceInfoMask(MC_CPU1, -1, 1)
ecmcMotorRecordCreateController(MCU1, MC_CPU1, "64", 200, 1000, "")
############################################################
############# Misc settings:
# Disable function call trace printouts
ecmcConfigOrDie "Cfg.SetEnableFuncCallDiag(0)"
2022/02/09 16:48:14.451 
ECMC Initializes.............
2022/02/09 16:48:14.452 ESS Open Source EtherCAT Motion Control Epics Module2022/02/09 16:48:14.452 
Mode: Configuration
2022/02/09 16:48:14.452 OK
# Disable on change printouts from objects (enable for easy logging)
ecmcConfigOrDie "Cfg.SetTraceMaskBit(15,0)"
2022/02/09 16:48:14.452 OK
# Choose to generate EPICS-records for EtherCAT-entries
# (For records use ECMC_GEN_EC_RECORDS="-records" otherwise ECMC_GEN_EC_RECORDS="")
epicsEnvSet("ECMC_GEN_EC_RECORDS",          "-records")
# Choose to generate EPICS-records for ax-entries (PosAct, SetPos,..)
# (For records use ECMC_GEN_AX_RECORDS="-records" otherwise ECMC_GEN_AX_RECORDS="")
epicsEnvSet("ECMC_GEN_AX_RECORDS",          "-records")
# suffix for pva enabled scripts, templates and substitutions
ecmcEpicsEnvSetCalcTernary(ECMC_PVA, "0", "Pva","")
# Set EtherCAT frequency (defaults to 1000)
ecmcConfigOrDie "Cfg.SetSampleRate(1000)"
2022/02/09 16:48:14.454 OK
epicsEnvSet("ECMC_EC_SAMPLE_RATE" ,   1000)
ecmcEpicsEnvSetCalc("ECMC_EC_SAMPLE_RATE_MS" ,1000/1000)
# Update records in 10ms (100Hz) for FULL MODE and in EC_RATE for DAQ mode
ecmcEpicsEnvSetCalcTernary(ECMC_SAMPLE_RATE_MS, "'FULL'=='DAQ'","1","10")
epicsEnvSet("ECMC_P_SCRIPT",        "mXsXXX")
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd",1)
 iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd", "MASTER_ID=0"
#===============================================================================
# addMaster.cfg
epicsEnvSet("ECMC_EC_MASTER_ID"          "0")
# Claim master
ecmcConfigOrDie "Cfg.EcSetMaster(0)"
2022/02/09 16:48:14.457 OK
epicsEnvSet("ECMC_EC_MASTER_ID" ,0)
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd
#==============================================================================
# setDiagnostics.cmd
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:48:14.473 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:48:14.473 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:48:14.473 OK
epicsEnvSet("ECMCCFG_INIT" ,"#")
##############################################################################
## Configure hardware:
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd
############################################################
############# MCU1025:
#Configure EK1100 coupler terminal
epicsEnvSet(ECMC_EC_SLAVE_NUM,0)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=0, HW_DESC=EK1100"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "0")
epicsEnvSet("HW_DESC",            "EK1100")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EK1100")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x044c2c52")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,0,0x2,0x044c2c52)"
2022/02/09 16:48:14.482 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddSlave(0,0,0x2,0x044c2c52)"
2022/02/09 16:48:14.483 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "0","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s000")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s000-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEK1100.substitutions,ECMC_P=IOC_TEST:m0s000-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEK1100.substitutions,1,1)
dbLoadTemplate(ecmcEK1100.substitutions,"ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "0+1","%d")
#Configure EL1018 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "0+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=1, HW_DESC=EL1018"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "1")
epicsEnvSet("HW_DESC",            "EL1018")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1018")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x03fa3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,1,0x2,0x03fa3052)"
2022/02/09 16:48:14.504 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a02,0x6020,0x1,B1,binaryInput03)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a03,0x6030,0x1,B1,binaryInput04)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a04,0x6040,0x1,B1,binaryInput05)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a05,0x6050,0x1,B1,binaryInput06)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a06,0x6060,0x1,B1,binaryInput07)"
2022/02/09 16:48:14.506 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a07,0x6070,0x1,B1,binaryInput08)"
2022/02/09 16:48:14.506 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "1","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s001")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s001-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1018.substitutions,ECMC_P=IOC_TEST:m0s001-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1018.substitutions,1,1)
dbLoadTemplate(ecmcEL1018.substitutions,"ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "1+1","%d")
#Configure EL2808 digital output terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "1+1")
epicsEnvShow("ECMC_EC_SLAVE_NUM")
ECMC_EC_SLAVE_NUM=2
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=2, HW_DESC=EL2808"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "2")
epicsEnvSet("HW_DESC",            "EL2808")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL2808")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x0af83052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,2,0x2,0x0af83052)"
2022/02/09 16:48:14.517 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX2008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1600,0x7000,0x1,B1,binaryOutput01)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1601,0x7010,0x1,B1,binaryOutput02)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1602,0x7020,0x1,B1,binaryOutput03)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1603,0x7030,0x1,B1,binaryOutput04)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1604,0x7040,0x1,B1,binaryOutput05)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1605,0x7050,0x1,B1,binaryOutput06)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1606,0x7060,0x1,B1,binaryOutput07)"
2022/02/09 16:48:14.520 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1607,0x7070,0x1,B1,binaryOutput08)"
2022/02/09 16:48:14.520 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "2","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s002")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s002-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL2808.substitutions,ECMC_P=IOC_TEST:m0s002-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL2808.substitutions,1,1)
dbLoadTemplate(ecmcEL2808.substitutions,"ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "2+1","%d")
# Save the slave number for later
epicsEnvSet("ECMC_EC_SLAVE_NUM_DIG_OUT", "2")
#Configure EL5002 2-channel SSI encoder terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "2+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=3, HW_DESC=EL5002"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "3")
epicsEnvSet("HW_DESC",            "EL5002")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL5002")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x138a3052")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,3,0x2,0x138a3052)"
2022/02/09 16:48:14.533 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(3,0x1011,0x1,1684107116,4)"
2022/02/09 16:48:14.559 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(3,0x100a,0x0,2)"
2022/02/09 16:48:14.567 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x1,16,encoderStatus01)"
2022/02/09 16:48:14.567 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x11,32,positionActual01)"
2022/02/09 16:48:14.567 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x1,16,encoderStatus02)"
2022/02/09 16:48:14.567 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x11,32,positionActual02)"
2022/02/09 16:48:14.567 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "3","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s003")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s003-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL5002.substitutions,ECMC_P=IOC_TEST:m0s003-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL5002.substitutions,1,1)
dbLoadTemplate(ecmcEL5002.substitutions,"ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "3+1","%d")
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch1-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8000")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x1,0,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x2,0,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x3,0,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x4,0,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x6,1,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x9,3,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0xF,2,1)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x11,27,2)"
2022/02/09 16:48:14.582 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x12,25,2)"
2022/02/09 16:48:14.582 OK
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 2)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch2-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8010")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x1,0,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x2,0,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x3,0,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x4,0,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x6,1,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x9,3,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0xF,2,1)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x11,27,2)"
2022/02/09 16:48:14.586 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x12,25,2)"
2022/02/09 16:48:14.586 OK
# Configure EL9505 Power supply terminal 5V
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "3+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=4, HW_DESC=EL9505"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "4")
epicsEnvSet("HW_DESC",            "EL9505")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9505")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x25213052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,4,0x2,0x25213052)"
2022/02/09 16:48:14.590 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x1,1,powerOk01)"
2022/02/09 16:48:14.590 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x2,1,overload01)"
2022/02/09 16:48:14.590 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "4","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s004")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s004-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9505.substitutions,ECMC_P=IOC_TEST:m0s004-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9505.substitutions,1,1)
dbLoadTemplate(ecmcEL9505.substitutions,"ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "4+1","%d")
# Configure EL1252 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "4+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=5, HW_DESC=EL1252"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "5")
epicsEnvSet("HW_DESC",            "EL1252")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1252")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x04e43052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,5,0x2,0x04e43052)"
2022/02/09 16:48:14.600 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1002.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:48:14.604 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:48:14.605 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xae,U8,status01)"
2022/02/09 16:48:14.606 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xaf,U8,status02)"
2022/02/09 16:48:14.606 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb0,U64,timestampLatchPositive01)"
2022/02/09 16:48:14.606 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb8,U64,timestampLatchNegative01)"
2022/02/09 16:48:14.606 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc0,U64,timestampLatchPositive02)"
2022/02/09 16:48:14.606 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc8,U64,timestampLatchNegative02)"
2022/02/09 16:48:14.606 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "5","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s005")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s005-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1252.substitutions,ECMC_P=IOC_TEST:m0s005-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1252.substitutions,1,1)
dbLoadTemplate(ecmcEL1252.substitutions,"ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "5+1","%d")
# Configure EL9410 Power supply with refresh of E-Bus.
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "5+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=6, HW_DESC=EL9410"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "6")
epicsEnvSet("HW_DESC",            "EL9410")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9410")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x24c23052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,6,0x2,0x24c23052)"
2022/02/09 16:48:14.619 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a00,0x6000,0x1,1,underVoltageEbus01)"
2022/02/09 16:48:14.620 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a01,0x6000,0x1,1,underVoltagePower01)"
2022/02/09 16:48:14.620 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "6","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s006")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s006-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9410.substitutions,ECMC_P=IOC_TEST:m0s006-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9410.substitutions,1,1)
dbLoadTemplate(ecmcEL9410.substitutions,"ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "6+1","%d")
#Configure EL7037 stepper drive terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "6+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=7, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B, CFG_MACROS='I_RUN_MA=900,I_STDBY_MA=200'"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=7, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,7,0x2,0x1b7d3052)"
2022/02/09 16:48:14.632 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(7,0x1011,0x1,1684107116,4)"
2022/02/09 16:48:14.691 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(7,0x100a,0x0,2)"
2022/02/09 16:48:14.699 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:48:14.701 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:48:14.701 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:48:14.702 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:48:14.702 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:48:14.702 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:48:14.702 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:48:14.702 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:48:14.702 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x5,1,1)"
2022/02/09 16:48:14.703 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0xA,1,1)"
2022/02/09 16:48:14.703 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x8,1,1)"
2022/02/09 16:48:14.703 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x9,0,1)"
2022/02/09 16:48:14.703 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "7","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s007")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s007-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s007-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "7+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd "I_RUN_MA=900,I_STDBY_MA=200"
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,900)
epicsEnvSet(I_STDBY_MA_LOCAL,200)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=900,I_STDBY_MA=200,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "900>1500 or 900<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (900)...")
# Result: 
# Run current setting OK (900)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>1500 or 200<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (200)...")
# Result: 
# Standby current setting OK (200)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>900", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (200<900)...")
# Result: 
# Standby current and run current setting OK (200<900)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x1,900,2)"
2022/02/09 16:48:14.736 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x2,200,2)"
2022/02/09 16:48:14.736 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x3,2400,2)"
2022/02/09 16:48:14.737 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x4,175,2)"
2022/02/09 16:48:14.738 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x6,200,2)"
2022/02/09 16:48:14.738 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0xA,330,2)"
2022/02/09 16:48:14.738 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Configure EL7037 stepper drive terminal, motor 2
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "7+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=8, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=8, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,8,0x2,0x1b7d3052)"
2022/02/09 16:48:14.742 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(8,0x1011,0x1,1684107116,4)"
2022/02/09 16:48:14.799 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(8,0x100a,0x0,2)"
2022/02/09 16:48:14.807 13360
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "13360", "0x%04x")
# Firmware version: 0x3430
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:48:14.810 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:48:14.810 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:48:14.810 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:48:14.810 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:48:14.811 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:48:14.811 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:48:14.811 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:48:14.811 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x5,1,1)"
2022/02/09 16:48:14.812 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0xA,1,1)"
2022/02/09 16:48:14.812 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x8,1,1)"
2022/02/09 16:48:14.812 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x9,0,1)"
2022/02/09 16:48:14.812 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "8","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s008")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s008-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s008-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "8+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd ""
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,1000)
epicsEnvSet(I_STDBY_MA_LOCAL,500)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=1000,I_STDBY_MA=500,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "1000>1500 or 1000<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (1000)...")
# Result: 
# Run current setting OK (1000)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1500 or 500<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (500)...")
# Result: 
# Standby current setting OK (500)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1000", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (500<1000)...")
# Result: 
# Standby current and run current setting OK (500<1000)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x1,1000,2)"
2022/02/09 16:48:14.828 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x2,500,2)"
2022/02/09 16:48:14.828 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x3,2400,2)"
2022/02/09 16:48:14.828 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x4,175,2)"
2022/02/09 16:48:14.828 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x6,200,2)"
2022/02/09 16:48:14.828 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0xA,330,2)"
2022/02/09 16:48:14.829 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Apply hardware configuration
ecmcConfigOrDie "Cfg.EcApplyConfig(1)"
2022/02/09 16:48:14.830 OK
# ADDITIONAL SETUP
# Set all outputs to feed switches
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput01,1)"
2022/02/09 16:48:14.830 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput02,1)"
2022/02/09 16:48:14.831 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput03,1)"
2022/02/09 16:48:14.831 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput04,1)"
2022/02/09 16:48:14.831 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput05,1)"
2022/02/09 16:48:14.831 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput06,1)"
2022/02/09 16:48:14.831 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput07,1)"
2022/02/09 16:48:14.831 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput08,1)"
2022/02/09 16:48:14.831 OK
# END of ADDITIONAL SETUP
##############################################################################
## AXIS 1
#
epicsEnvSet("DEV",      "IOC_TEST")
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureAxis.cmd, CONFIG=./cfg/linear_1.ax)
#==============================================================================
# configureAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
ecmcFileExist("./cfg/linear_1.ax",1)
iocshLoad ./cfg/linear_1.ax ""
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis1")
epicsEnvSet("ECMC_R",                     "Axis1-")
epicsEnvSet("ECMC_AXIS_NO",               "1")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Lower Axis (1)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "-60")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "4096")
epicsEnvSet("ECMC_ENC_BITS"               "25")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "25")                       # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "25")                       # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "-100")                     # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s3.positionActual01")         # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "ec0.s3.encoderStatus01.0")      # Error 0: SSI input error
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "ec0.s3.encoderStatus01.1")      # Error 1: SSI frame error
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "ec0.s3.encoderStatus01.2")      # Error 2: Encoder power fail
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Drive
epicsEnvSet("ECMC_DRV_TYPE"               "0")                        # Stepper: 0. DS402: 1 (DS402 = servos and advanced stepper drives)
epicsEnvSet("ECMC_DRV_SCALE_NUM"          "600.0")                    # Fastest speed in engineering units
epicsEnvSet("ECMC_DRV_SCALE_DENOM"        "32768.0")                  # I/O range for ECMC_EC_ALIAS_DRV_VELO_SET
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "ec0.s7.driveControl01.0")     # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "ec0.s7.driveStatus01.1")      # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "ec0.s7.velocitySetpoint01") # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "ec0.s7.driveControl01.2")     # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "")                         # Ethercat entry for brake output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_EC_DRV_RESET",          "ec0.s7.driveControl01.1")     # Reset
epicsEnvSet("ECMC_EC_DRV_ALARM_0",        "ec0.s7.driveStatus01.3")      # Error
epicsEnvSet("ECMC_EC_DRV_ALARM_1",        "ec0.s7.driveStatus01.7")      # Stall
epicsEnvSet("ECMC_EC_DRV_ALARM_2",        "ec0.s7.driveStatus01.14")     # Sync error
epicsEnvSet("ECMC_EC_DRV_WARNING",        "ec0.s7.driveStatus01.2")      # Warning
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Controller
epicsEnvSet("ECMC_CNTRL_KP",              "15.0")
epicsEnvSet("ECMC_CNTRL_KI",              "0.02")
epicsEnvSet("ECMC_CNTRL_KD",              "0.0")
epicsEnvSet("ECMC_CNTRL_KFF",             "1.0")
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s1.binaryInput02.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s1.binaryInput01.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s1.binaryInput03.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s1.ONE.0")              #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "-50")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "80")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "1")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.1")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",     "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "100.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd
#==============================================================================
# addAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd
#==============================================================================
# ecmc_axis-records.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd
#==============================================================================
# ecmc_axis.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(-60)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == -60...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(-60)<>0","# ECMC_ENC_SCALE_NUM value OK == -60...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == -60...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(4096)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 4096...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(4096)<>0","# ECMC_ENC_SCALE_DENOM value OK == 4096...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 4096...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(600.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_NUM value OK == 600.0...',ERROR_STR='ECMC_DRV_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(600.0)<>0","# ECMC_DRV_SCALE_NUM value OK == 600.0...", "ecmcExit Error: ECMC_DRV_SCALE_NUM == 0...")
# ECMC_DRV_SCALE_NUM value OK == 600.0...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(32768.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_DENOM value OK == 32768.0...',ERROR_STR='ECMC_DRV_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(32768.0)<>0","# ECMC_DRV_SCALE_DENOM value OK == 32768.0...", "ecmcExit Error: ECMC_DRV_SCALE_DENOM == 0...")
# ECMC_DRV_SCALE_DENOM value OK == 32768.0...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(1,1,0)"
2022/02/09 16:48:14.857 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.health")"
2022/02/09 16:48:14.857 OK
ecmcConfigOrDie "Cfg.SetAxisModRange(1, 0)"
2022/02/09 16:48:14.857 OK
ecmcConfigOrDie "Cfg.SetAxisModType(1, 0)"
2022/02/09 16:48:14.857 OK
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(1,0.1)"
2022/02/09 16:48:14.857 OK
ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(1,5.0,0.1)"
2022/02/09 16:48:14.857 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelTwordsCam(1,5)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(1,4)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKp(1,15.0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKi(1,0.02)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKd(1,0.0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKff(1,1.0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.positionActual01,"ax1.enc.actpos")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(1,4096)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(1,-60)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncType(1,1)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncBits(1,25)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(1,25)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncOffset(1,-100)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(1,100)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(1,1)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(1,0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.reset")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.0,"ax1.enc.alarm0")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.1,"ax1.enc.alarm1")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.2,"ax1.enc.alarm2")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.warning")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchpos")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchcontrol")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchstatus")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.0,"ax1.drv.control")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.1,"ax1.drv.status")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.velocitySetpoint01,"ax1.drv.velocity")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.position")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.brake")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.2,"ax1.drv.reducetorque")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.1,"ax1.drv.reset")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.3,"ax1.drv.alarm0")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.7,"ax1.drv.alarm1")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.14,"ax1.drv.alarm2")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.2,"ax1.drv.warning")"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleDenom(1,32768.0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleNum(1,600.0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeOpenDelayTime(1,0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeCloseAheadTime(1,0)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(1,-50)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(1,1)"
2022/02/09 16:48:14.858 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(1,80)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(1,1)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput02.0,"ax1.mon.lowlim")"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput01.0,"ax1.mon.highlim")"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput03.0,"ax1.mon.homesensor")"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.ONE.0,"ax1.mon.extinterlock")"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(1,0.1)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(1,100)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(1,1)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(1,0.5)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(1,100)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(1,1)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(1,100.0)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(1,1)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(1,200)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(1,100)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(1,0)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(1,0)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Main.M1.fHomePosition=0.0"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(1, 0)"
2022/02/09 16:48:14.859 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(1, 0)"
2022/02/09 16:48:14.859 OK
ecmcMotorRecordCreateAxis(MCU1, "1", "6", )
2022/02/09 16:48:14.859 ecmcMotorRecord:: setIntegerParam(1 motorPowerAutoOnOff_)=2
2022/02/09 16:48:14.859 ecmcMotorRecord:: setDoubleParam(1 motorPowerOnDelay_)=6
2022/02/09 16:48:14.859 ecmcMotorRecord:: setDoubleParam(1 motorPowerOffDelay_=-1
2022/02/09 16:48:14.859 ecmcMotorRecord:: udateMotorLimitsRO(1) enabledHighAndLow=1 valid=1 fValueHigh=80 fValueLow=-50
2022/02/09 16:48:14.859 ecmcMotorRecord:: connected(1)
2022/02/09 16:48:14.859 ecmcMotorRecord:: initialPoll(1) status=0
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(4096)>0){RESULT:=abs(4096);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(-60)>0){RESULT:=abs(-60);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1, DESC=MCU1025 Lower Axis (1), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.1, DLLM=-50, DHLM=80, HOMEPROC=3,SREV=4096,UREV=60.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_NO=1,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_TYPE=1")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd
#==============================================================================
# ecmc_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_CNTRL_KP)
epicsEnvUnset(ECMC_CNTRL_KI)
epicsEnvUnset(ECMC_CNTRL_KD)
epicsEnvUnset(ECMC_CNTRL_KFF)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCHPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCH_CONTROL)
epicsEnvUnset(ECMC_EC_ENC_LATCH_STATUS)
epicsEnvUnset(ECMC_HOME_LATCH_COUNT_OFFSET)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_DRV_CONTROL)
epicsEnvUnset(ECMC_EC_DRV_STATUS)
epicsEnvUnset(ECMC_EC_DRV_VELOCITY)
epicsEnvUnset(ECMC_EC_DRV_BRAKE)
epicsEnvUnset(ECMC_EC_DRV_REDUCE_TORQUE)
epicsEnvUnset(ECMC_EC_DRV_RESET)
epicsEnvUnset(ECMC_EC_DRV_ALARM_0)
epicsEnvUnset(ECMC_EC_DRV_ALARM_1)
epicsEnvUnset(ECMC_EC_DRV_ALARM_2)
epicsEnvUnset(ECMC_EC_DRV_WARNING)
epicsEnvUnset(ECMC_DRV_SCALE_DENOM)
epicsEnvUnset(ECMC_DRV_SCALE_NUM)
epicsEnvUnset(ECMC_DRV_BRAKE_OPEN_DLY_TIME)
epicsEnvUnset(ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
##############################################################################
## AXIS 2
#
#epicsEnvSet("DEV",      "$(IOC)")
#$(SCRIPTEXEC) ($(ecmccfg_DIR)configureAxis.cmd, CONFIG=./cfg/linear_2.ax)
##############################################################################
############# Configure diagnostics:
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:48:14.881 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:48:14.881 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:48:14.881 OK
ecmcConfigOrDie "Cfg.SetDiagAxisIndex(1)"
2022/02/09 16:48:14.881 OK
ecmcConfigOrDie "Cfg.SetDiagAxisFreq(2)"
2022/02/09 16:48:14.881 OK
ecmcConfigOrDie "Cfg.SetDiagAxisEnable(0)"
2022/02/09 16:48:14.881 OK
# go active
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setAppMode.cmd)
#==============================================================================
# setAppMode.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd
#==============================================================================
# general.cmd
ecmcFileExist("ecmcGeneral.db",1,1)
dbLoadRecords("ecmcGeneral.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2,ECMC_PROC_HOOK=")
# Examples of commands for info:
# ecmcReport <level> or asynReport <level>
# ecmcReport 3
# ecmcGrepParam <pattern>
# List all ecmc params for ethercat slave 2:
# ecmcGrepParam *s2*
#
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("ecmcEc.db",1,1)
 dbLoadRecords("ecmcEc.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,T_SMP_MS=10,TSE=-2")
ecmcConfigOrDie "Cfg.SetAppMode(1)"
2022/02/09 16:48:14.893 INFO: Locking memory
2022/02/09 16:48:14.904 Starting up EtherCAT bus: 0 second(s). Max wait time 30 second(s).
2022/02/09 16:48:14.992 ../devEcmcSup/motion/ecmcMonitor.cpp/checkLimits:501: ERROR_MON_BOTH_LIMIT_INTERLOCK (0x14c10).
2022/02/09 16:48:14.992 ../devEcmcSup/motion/ecmcAxisReal.cpp/execute:198: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 0: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 1: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 2: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 3: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 4: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 5: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 6: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 7: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 8: Not operational (0x24011).
2022/02/09 16:48:14.992 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:48:15.614 ../devEcmcSup/motion/ecmcDriveBase.cpp/readEntries:369: WARNING (axis 1): Drive hardware in warning state.
2022/02/09 16:48:15.852 ecmcMotorRecord:: poll(1) homed=1
2022/02/09 16:48:15.852 ecmcMotorRecord:: poll(1) LLS=0
2022/02/09 16:48:15.852 ecmcMotorRecord:: poll(1) HLS=0
2022/02/09 16:48:15.852 ecmcMotorRecord:: poll(1) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=3.355e+07 fPos=0 fActPosition=-34.4922 time=0.000033
2022/02/09 16:48:15.852 ecmcMotorRecord:: poll(1) bError=1 drvlocal.statusBinData.onChangeData.error=0x14315
2022/02/09 16:48:15.852 ecmcMotorRecord:: sErrorMessage(1)="ERROR_AXIS_HARDWARE_STATUS_NOT_OK"
2022/02/09 16:48:15.852 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=1 old=-1 ErrID=0x14315 old=0x0 Warn=0 nCmd=0 old=0 txt=E: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315)
2022/02/09 16:48:15.904 Starting up EtherCAT bus: 1 second(s). Max wait time 30 second(s).
2022/02/09 16:48:15.995 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:48:15.995 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:48:15.995 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:48:16.852 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:48:16.852 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=0 old=1 ErrID=0x0 old=0x14315 Warn=0 nCmd=0 old=0 txt=NULL
2022/02/09 16:48:17.905 EtherCAT bus started!
2022/02/09 16:48:17.905 OK
# Set the IOC Prompt String One 
epicsEnvSet IOCSH_PS1 "mcag-dev-asm-02-29699 > "
#
# 
iocInit
2022/02/09 16:48:17.906 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocBuild (0). Allow callbacks: true.
Starting iocInit
2022/02/09 16:48:17.906 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtBeginning (1). Allow callbacks: true.
############################################################################
## EPICS R7.0.5-E3-7.0.5-patch
## Rev. 2021-03-19T22:08+0100
############################################################################
2022/02/09 16:48:17.908 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCallbackInit (2). Allow callbacks: true.
2022/02/09 16:48:17.909 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaLinkInit (3). Allow callbacks: true.
2022/02/09 16:48:17.909 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDrvSup (4). Allow callbacks: true.
2022/02/09 16:48:17.909 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitRecSup (5). Allow callbacks: true.
2022/02/09 16:48:17.910 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDevSup (6). Allow callbacks: true.
2022/02/09 16:48:17.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput01 linked to record (asyn reason 1).
2022/02/09 16:48:17.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput02 linked to record (asyn reason 2).
2022/02/09 16:48:17.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput03 linked to record (asyn reason 3).
2022/02/09 16:48:17.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput04 linked to record (asyn reason 4).
2022/02/09 16:48:17.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput05 linked to record (asyn reason 5).
2022/02/09 16:48:17.913 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput06 linked to record (asyn reason 6).
2022/02/09 16:48:17.913 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput07 linked to record (asyn reason 7).
2022/02/09 16:48:17.913 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput08 linked to record (asyn reason 8).
2022/02/09 16:48:17.913 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.reset linked to record (asyn reason 9).
2022/02/09 16:48:17.913 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveControl01 linked to record (asyn reason 10).
2022/02/09 16:48:17.914 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.velocitySetpoint01 linked to record (asyn reason 11).
2022/02/09 16:48:17.915 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderControl01 linked to record (asyn reason 12).
2022/02/09 16:48:17.915 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderValue01 linked to record (asyn reason 13).
2022/02/09 16:48:17.915 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveControl01 linked to record (asyn reason 14).
2022/02/09 16:48:17.915 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.velocitySetpoint01 linked to record (asyn reason 15).
2022/02/09 16:48:17.915 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderControl01 linked to record (asyn reason 16).
2022/02/09 16:48:17.916 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderValue01 linked to record (asyn reason 17).
2022/02/09 16:48:17.916 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus01 linked to record (asyn reason 18).
2022/02/09 16:48:17.916 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus02 linked to record (asyn reason 19).
2022/02/09 16:48:17.916 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status01 linked to record (asyn reason 20).
2022/02/09 16:48:17.917 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status02 linked to record (asyn reason 21).
2022/02/09 16:48:17.917 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveStatus01 linked to record (asyn reason 22).
2022/02/09 16:48:17.917 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderStatus01 linked to record (asyn reason 23).
2022/02/09 16:48:17.917 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveStatus01 linked to record (asyn reason 24).
2022/02/09 16:48:17.918 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderStatus01 linked to record (asyn reason 25).
2022/02/09 16:48:17.918 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.diagnostic linked to record (asyn reason 26).
2022/02/09 16:48:17.918 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.plc.expression linked to record (asyn reason 27).
2022/02/09 16:48:17.918 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.msg linked to record (asyn reason 28).
2022/02/09 16:48:17.919 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.updated linked to record (asyn reason 29).
2022/02/09 16:48:17.919 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.slavestatus linked to record (asyn reason 30).
2022/02/09 16:48:17.919 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.slavestatus linked to record (asyn reason 31).
2022/02/09 16:48:17.919 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.slavestatus linked to record (asyn reason 32).
2022/02/09 16:48:17.920 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.slavestatus linked to record (asyn reason 33).
2022/02/09 16:48:17.920 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.slavestatus linked to record (asyn reason 34).
2022/02/09 16:48:17.920 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.slavestatus linked to record (asyn reason 35).
2022/02/09 16:48:17.920 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.slavestatus linked to record (asyn reason 36).
2022/02/09 16:48:17.920 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.slavestatus linked to record (asyn reason 37).
2022/02/09 16:48:17.921 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.slavestatus linked to record (asyn reason 38).
2022/02/09 16:48:17.921 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.status linked to record (asyn reason 39).
2022/02/09 16:48:17.921 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.masterstatus linked to record (asyn reason 40).
2022/02/09 16:48:17.922 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.slavecounter linked to record (asyn reason 41).
2022/02/09 16:48:17.922 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.memmapcounter linked to record (asyn reason 42).
2022/02/09 16:48:17.922 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainfailcountertotal linked to record (asyn reason 43).
2022/02/09 16:48:17.923 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.entrycounter linked to record (asyn reason 44).
2022/02/09 16:48:17.923 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainstatus linked to record (asyn reason 45).
2022/02/09 16:48:17.923 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput01 linked to record (asyn reason 46).
2022/02/09 16:48:17.924 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput02 linked to record (asyn reason 47).
2022/02/09 16:48:17.924 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput03 linked to record (asyn reason 48).
2022/02/09 16:48:17.924 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput04 linked to record (asyn reason 49).
2022/02/09 16:48:17.925 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput05 linked to record (asyn reason 50).
2022/02/09 16:48:17.925 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput06 linked to record (asyn reason 51).
2022/02/09 16:48:17.926 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput07 linked to record (asyn reason 52).
2022/02/09 16:48:17.926 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput08 linked to record (asyn reason 53).
2022/02/09 16:48:17.928 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.powerOk01 linked to record (asyn reason 54).
2022/02/09 16:48:17.928 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.overload01 linked to record (asyn reason 55).
2022/02/09 16:48:17.929 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput01 linked to record (asyn reason 56).
2022/02/09 16:48:17.930 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput02 linked to record (asyn reason 57).
2022/02/09 16:48:17.930 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltageEbus01 linked to record (asyn reason 58).
2022/02/09 16:48:17.931 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltagePower01 linked to record (asyn reason 59).
2022/02/09 16:48:17.932 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.enable linked to record (asyn reason 60).
2022/02/09 16:48:17.933 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.firstscan linked to record (asyn reason 61).
2022/02/09 16:48:17.934 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.ok linked to record (asyn reason 62).
2022/02/09 16:48:17.934 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.control linked to record (asyn reason 63).
2022/02/09 16:48:17.935 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ONE linked to record (asyn reason 64).
2022/02/09 16:48:17.936 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ZERO linked to record (asyn reason 65).
2022/02/09 16:48:17.936 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ONE linked to record (asyn reason 66).
2022/02/09 16:48:17.937 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ZERO linked to record (asyn reason 67).
2022/02/09 16:48:17.938 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ONE linked to record (asyn reason 68).
2022/02/09 16:48:17.939 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ZERO linked to record (asyn reason 69).
2022/02/09 16:48:17.940 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ONE linked to record (asyn reason 70).
2022/02/09 16:48:17.940 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ZERO linked to record (asyn reason 71).
2022/02/09 16:48:17.941 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ONE linked to record (asyn reason 72).
2022/02/09 16:48:17.942 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ZERO linked to record (asyn reason 73).
2022/02/09 16:48:17.943 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ONE linked to record (asyn reason 74).
2022/02/09 16:48:17.943 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ZERO linked to record (asyn reason 75).
2022/02/09 16:48:17.944 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ONE linked to record (asyn reason 76).
2022/02/09 16:48:17.945 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ZERO linked to record (asyn reason 77).
2022/02/09 16:48:17.946 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ONE linked to record (asyn reason 78).
2022/02/09 16:48:17.946 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ZERO linked to record (asyn reason 79).
2022/02/09 16:48:17.951 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ONE linked to record (asyn reason 80).
2022/02/09 16:48:17.952 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ZERO linked to record (asyn reason 81).
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeFallTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeFallTS
2022/02/09 16:48:17.953 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual01 linked to record (asyn reason 82).
2022/02/09 16:48:17.953 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual02 linked to record (asyn reason 83).
2022/02/09 16:48:17.954 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive01 linked to record (asyn reason 84).
2022/02/09 16:48:17.955 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative01 linked to record (asyn reason 85).
2022/02/09 16:48:17.956 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive02 linked to record (asyn reason 86).
2022/02/09 16:48:17.958 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative02 linked to record (asyn reason 87).
2022/02/09 16:48:17.962 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.positionActual01 linked to record (asyn reason 88).
2022/02/09 16:48:17.963 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderLatchPostion01 linked to record (asyn reason 89).
2022/02/09 16:48:17.971 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.positionActual01 linked to record (asyn reason 90).
2022/02/09 16:48:17.973 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderLatchPostion01 linked to record (asyn reason 91).
2022/02/09 16:48:17.976 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.actpos linked to record (asyn reason 92).
2022/02/09 16:48:17.977 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.setpos linked to record (asyn reason 93).
2022/02/09 16:48:17.978 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.poserr linked to record (asyn reason 94).
2022/02/09 16:48:17.979 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.error linked to record (asyn reason 95).
2022/02/09 16:48:17.980 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.appmode linked to record (asyn reason 96).
2022/02/09 16:48:17.980 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.id linked to record (asyn reason 97).
2022/02/09 16:48:17.981 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.min linked to record (asyn reason 98).
2022/02/09 16:48:17.982 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.max linked to record (asyn reason 99).
2022/02/09 16:48:17.983 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.min linked to record (asyn reason 100).
2022/02/09 16:48:17.984 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.max linked to record (asyn reason 101).
2022/02/09 16:48:17.985 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.min linked to record (asyn reason 102).
2022/02/09 16:48:17.986 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.max linked to record (asyn reason 103).
2022/02/09 16:48:17.987 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.min linked to record (asyn reason 104).
2022/02/09 16:48:17.988 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.max linked to record (asyn reason 105).
2022/02/09 16:48:17.988 [devMotorAsyn.c:439  IOC_TEST:Axis1] init_record IOC_TEST:Axis1 position=-34.492188 encoderPos=-34.492188 velocity=0.000000 MSTAstatus=0x490a flagsValue=0x1f flagsWritten=0x1f pmr->mflg=0x0
2022/02/09 16:48:17.988 [devMotorAsyn.c:185  IOC_TEST:Axis1] init_controller IOC_TEST:Axis1 set encoder ratio=1.000000 status=0
2022/02/09 16:48:17.988 [devMotorAsyn.c:266  IOC_TEST:Axis1] update_soft_limits IOC_TEST:Axis1 RawHLM_RO=80.000000 RawLLM_RO=-50.000000 valid=1 DHLM_RO=80.000000 DLLM_RO=-50.000000
2022/02/09 16:48:17.988 [motorDevSup.c:327  IOC_TEST:Axis1] PositionRestoreNeeded IOC_TEST:Axis1 rstm=2 dval=0.000000 drbv=-34.492188 pmr->rdbd=0.100000 rdbd=0.100000 pmr->mres=0.014648 pmr->mflg=0x1f dval_non_zero_pos_near_zero=0 ret=0
2022/02/09 16:48:17.988 [motorRecord.cc:781  IOC_TEST:Axis1] init_re_init start neverPolled=0 stat=17 nsta=0
2022/02/09 16:48:17.988 [motorRecord.cc:719  IOC_TEST:Axis1] enforceMinRetryDeadband spdb=0.100000 rdbd=0.100000 mres=0.014648
2022/02/09 16:48:17.988 [motorRecord.cc:4373 IOC_TEST:Axis1] pmr->dhlm=80 softLimitRO=80
2022/02/09 16:48:17.988 [motorRecord.cc:4434 IOC_TEST:Axis1] pmr->dllm=-50 softLimitRO=-50
2022/02/09 16:48:17.988 [motorRecord.cc:832  IOC_TEST:Axis1] init_re_init  end dval=-34.492188 drbv=-34.492188 rdbd=0.100000 spdb=0.100000
2022/02/09 16:48:17.988 ecmcMotorRecord:: setIntegerParam(1 motorUpdateStatus_)=0
2022/02/09 16:48:17.988 [motorRecord.cc:967  IOC_TEST:Axis1] init_record process_reason="callbackdata + soft limits" dval=-34.492188 drbv=-34.492188 rdbd=0.100000 spdb=0.100000 stat=0 msta=0x490a neverPolled=0
2022/02/09 16:48:18.008 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDatabase (7). Allow callbacks: true.
2022/02/09 16:48:18.008 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterFinishDevSup (8). Allow callbacks: true.
2022/02/09 16:48:18.518 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterScanInit (9). Allow callbacks: true.
2022/02/09 16:48:18.518 ecmcMotorRecord:: setDoubleParam(1 HomPos_)=0.000000
2022/02/09 16:48:18.519 ecmcMotorRecord:: setIntegerParam(1 HomProc_)=3 motorNotHomedProblem=0
2022/02/09 16:48:18.519 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitialProcess (10). Allow callbacks: true.
2022/02/09 16:48:18.523 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (11). Allow callbacks: true.
2022/02/09 16:48:18.523 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocBuilt (12). Allow callbacks: true.
2022/02/09 16:48:18.527 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocRun (13). Allow callbacks: true.
2022/02/09 16:48:18.527 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterDatabaseRunning (14). Allow callbacks: true.
2022/02/09 16:48:18.527 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInterruptAccept (28). Allow callbacks: true.
2022/02/09 16:48:18.527 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaServerRunning (15). Allow callbacks: true.
2022/02/09 16:48:18.528 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (29). Allow callbacks: true.
iocRun: All initialization complete
2022/02/09 16:48:18.545 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocRunning (16). Allow callbacks: true.
mcag-dev-asm-02-29699 > @@@ Current time: Wed Feb  9 16:49:43 2022
@@@ Child process is shutting down, a new one will be restarted shortly
@@@ ^R or ^X restarts the child, ^Q quits the server
@@@ Restarting child "mcu1025"
@@@    (as /epics/base-7.0.5/require/3.4.1/bin/iocsh.bash)
@@@ The PID of new child "mcu1025" is: 30065
@@@ @@@ @@@ @@@ @@@
Loading environment variables from /home/anderssandstrom/sources/test_service/env.sh

Set the ESS EPICS Environment as follows:
THIS Source NAME    : setE3Env.bash
THIS Source PATH    : /epics/base-7.0.5/require/3.4.1/bin
EPICS_BASE          : /epics/base-7.0.5
EPICS_HOST_ARCH     : linux-x86_64
E3_REQUIRE_LOCATION : /epics/base-7.0.5/require/3.4.1
PATH                : /epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
LD_LIBRARY_PATH     : /epics/base-7.0.5/lib/linux-x86_64:/epics/base-7.0.5/require/3.4.1/lib/linux-x86_64

Enjoy E3!
registerChannelProviderLocal firstTime true
#
# Start at "2022-W06-Feb09-1652-44-CET"
#
# Version information:
# European Spallation Source ERIC : iocsh.bash (-PID-30065)
#
# --->--> snip -->--> 
# Please Use Version and other environment variables
# in order to report or debug this shell
#
# HOSTDISPLAY=""
# WINDOWID=""
# PWD="/home/anderssandstrom/sources/test_service"
# USER=""
# LOGNAME=""
# EPICS_HOST_ARCH="linux-x86_64"
# EPICS_BASE="/epics/base-7.0.5"
# E3_REQUIRE_NAME="require"
# E3_REQUIRE_VERSION="3.4.1"
# E3_REQUIRE_LOCATION="/epics/base-7.0.5/require/3.4.1"
# E3_REQUIRE_BIN="/epics/base-7.0.5/require/3.4.1/bin"
# E3_REQUIRE_DB="/epics/base-7.0.5/require/3.4.1/db"
# E3_REQUIRE_DBD="/epics/base-7.0.5/require/3.4.1/dbd"
# E3_REQUIRE_INC="/epics/base-7.0.5/require/3.4.1/include"
# E3_REQUIRE_LIB="/epics/base-7.0.5/require/3.4.1/lib"
# EPICS_DRIVER_PATH="/epics/base-7.0.5/require/3.4.1/siteMods:/epics/base-7.0.5/require/3.4.1/siteApps"
# EPICS_CA_AUTO_ADDR_LIST=""
# EPICS_CA_ADDR_LIST=""
# PATH="/epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
# --->--> snip -->--> 
#
# Set REQUIRE_IOC for its internal PVs
epicsEnvSet REQUIRE_IOC "REQMOD:mcag-dev-asm-02-30065"
#
# Enable an exit subroutine for sotfioc
dbLoadRecords "/epics/base-7.0.5/db/softIocExit.db" "IOC=REQMOD:mcag-dev-asm-02-30065"
#
# Set E3_IOCSH_TOP for the absolute path where iocsh.bash is executed.
epicsEnvSet E3_IOCSH_TOP "/home/anderssandstrom/sources/test_service"
#
# 
# Load require module, which has the version 3.4.1
# 
dlload /epics/base-7.0.5/require/3.4.1/lib/linux-x86_64/librequire.so
dbLoadDatabase /epics/base-7.0.5/require/3.4.1/dbd/require.dbd
require_registerRecordDeviceDriver
Loading module info records for require
# 
# Set E3_CMD_TOP for the absolute path where mcu1025.script exists
epicsEnvSet E3_CMD_TOP "/home/anderssandstrom/sources/test_service"
#
iocshLoad '/home/anderssandstrom/sources/test_service/mcu1025.script',''
##############################################################################
## Example config ESS crate of type MCU1025
##############################################################################
## Initiation:
epicsEnvSet("IOC" ,"IOC_TEST")
epicsEnvSet("ECMCCFG_INIT" ,"")  #Only run startup once (auto at PSI, need call at ESS), variable set to "#" in startup.cmd
epicsEnvSet("SCRIPTEXEC" ,"iocshLoad")
require ecmccfg 7.0.1
Module ecmccfg version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/lib/linux-x86_64/libecmccfg.so
Loaded ecmccfg version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/dbd/ecmccfg.dbd
Calling function ecmccfg_registerRecordDeviceDriver
Loading module info records for ecmccfg
# Epics Motor record driver that will be used:
epicsEnvShow(ECMC_MR_MODULE)
ECMC_MR_MODULE is not an environment variable.
# run module startup.cmd (only needed at ESS  PSI auto call at require)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/startup.cmd, "IOC=IOC_TEST,ECMC_VER=7.0.1"
#==============================================================================
# startup.cmd
on error halt
require ecmc        "7.0.1"
Module ecmc version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/
Module ecmc depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/lib/linux-x86_64/libasyn.so
Loaded asyn version 4.41.0+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/dbd/asyn.dbd
Calling function asyn_registerRecordDeviceDriver
Loading module info records for asyn
Module ecmc depends on exprtk 1.2.1+0
Module exprtk version 1.2.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/lib/linux-x86_64/libexprtk.so
Loaded exprtk version 1.2.1+0
exprtk has no dbd file
Loading module info records for exprtk
Module ecmc depends on motor 7.0.6+0
Module motor version 7.0.6+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/
Module motor depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 already loaded
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/lib/linux-x86_64/libmotor.so
Loaded motor version 7.0.6+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/dbd/motor.dbd
Calling function motor_registerRecordDeviceDriver
Loading module info records for motor
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/lib/linux-x86_64/libecmc.so
Loaded ecmc version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/dbd/ecmc.dbd
Calling function ecmc_registerRecordDeviceDriver
Loading module info records for ecmc
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'ecmcMotorRecord'='EthercatMC'", "require  EthercatMC 3.0.2 # Using EthercatMC motor record support.","# Using ecmcMotorRecord motor record support.")
# Using ecmcMotorRecord motor record support.
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_CONFIG_ROOT",     "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/")
epicsEnvSet("ECMC_CONFIG_DB",       "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/db")
epicsEnvSet("SCRIPTEXEC",           "iocshLoad")
epicsEnvSet("SM_PREFIX",            "IOC_TEST:")    # colon added since IOC is _not_ PREFIX
epicsEnvSet("ECMC_PROC_HOOK",       "")
epicsEnvSet(ECMC_MODE, FULL)
ecmcEpicsEnvSetCalcTernary(ECMC_SUPPORT_MOTION, "'FULL'=='FULL'","","# MODE == DAQ, DISABLING MOTION.")
epicsEnvShow(ECMC_SUPPORT_MOTION)
ECMC_SUPPORT_MOTION=
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd"
#==============================================================================
# initAll.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd
#==============================================================================
# init.cmd
epicsEnvSet("ECMC_ASYN_TIMEOUT",      1)                   # Asyn timeout
epicsEnvSet("ECMC_ASYN_ADDR",         0)                   # Asyn Address
epicsEnvSet("ECMC_MOTOR_PORT",        "NOT SET")
epicsEnvSet("ECMC_ASYN_PORT",         "NOT SET")
epicsEnvSet("ECMC_PREFIX",            "NOT SET")
epicsEnvSet("ECMC_GEN_EC_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_GEN_AX_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_EC_AXIS_HEALTH",    "NOT SET")
epicsEnvSet("ECMC_PLC_SAMPLE_RATE_MS", "NOT SET")
epicsEnvSet("ECMC_TSE",               -2)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd"
#==============================================================================
# initAxis.cmd
epicsEnvSet("ECMC_MOTOR_NAME",            "NOT SET")
epicsEnvSet("ECMC_R",                     "NOT SET")
epicsEnvSet("ECMC_AXIS_NO",               "NOT SET")
epicsEnvSet("ECMC_DESC",                  "NOT SET")
epicsEnvSet("ECMC_EGU",                   "NOT SET")       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "NOT SET")       # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "NOT SET")       # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "NOT SET")       # Entry for axis health output (example: ec0.s1.BO_1.0)
epicsEnvSet("ECMC_ENC_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_ENC_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_ENC_BITS",              "NOT SET")
epicsEnvSet("ECMC_ENC_TYPE",              "NOT SET")       # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "NOT SET")       # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_ENC_ABS_BITS",          "NOT SET")       # Absolute bit count (for absolute encoders) always least significant part
epicsEnvSet("ECMC_ENC_ABS_OFFSET",        "NOT SET")       # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_LATCHPOS",       "")              # Ethercat entry for latch position (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_CONTROL",  "")              # Ethercat entry for latch control (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_STATUS",   "")              # Ethercat entry for latch status (only valid for home seq 11,12)
epicsEnvSet("ECMC_DRV_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_DRV_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "NOT SET")       # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "NOT SET")       # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "NOT SET")       # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "NOT SET")       # Ethercat entry for brake output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "NOT SET")       # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_VELO",                  "NOT SET")
epicsEnvSet("ECMC_JOG_VEL",               "NOT SET")
epicsEnvSet("ECMC_JAR",                   "NOT SET")       # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "NOT SET")
epicsEnvSet("ECMC_EMERG_DECEL",           "NOT SET")       # Emergency deceleration
epicsEnvSet("ECMC_HOME_PROC",              "NOT SET")
epicsEnvSet("ECMC_HOME_POS",               "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_TO",            "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_FRM",           "NOT SET")
epicsEnvSet("ECMC_HOME_ACC",               "NOT SET")
epicsEnvSet("ECMC_HOME_DEC",               "NOT SET")
epicsEnvSet("ECMC_HOME_LATCH_COUNT_OFFSET","0")
epicsEnvSet("ECMC_CNTRL_KP",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KI",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KD",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KFF",             "NOT SET")
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "NOT SET")       #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "NOT SET")       #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "NOT SET")       #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "NOT SET")       #  Ethercat entry for external interlock input
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "NOT SET")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "NOT SET")
epicsEnvSet("ECMC_DXLM_ENABLE",           "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX",          "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "NOT SET")
epicsEnvSet("ECMC_EGU",               "mm")
epicsEnvSet("ECMC_PREC",              3)
epicsEnvSet("ECMC_AXISFIELDINIT",     "")                  # Extra field init to motor record
epicsEnvSet("ECMC_AXISCONFIG",        "")                  # Extra parameters to driver
############################################################
############# ASYN Configuration:
epicsEnvSet("ECMC_MOTOR_PORT"     "MCU1")
epicsEnvSet("ECMC_ASYN_PORT"      "MC_CPU1")
epicsEnvSet("ECMC_PREFIX"         "IOC_TEST:")
ecmcAsynPortDriverConfigure(MC_CPU1,1000,0,0,100)
ecmcAsynPortDriverConfigure: portName = MC_CPU1, paramTableSize = 1000, disableAutoConnect = 0, priority = 0, defaultSampleRateMS = 100.000000
asynOctetSetOutputEos(MC_CPU1, -1, ";\n")
asynOctetSetInputEos(MC_CPU1, -1, ";\n")
asynSetTraceMask(MC_CPU1, -1, 0x41)
asynSetTraceIOMask(MC_CPU1, -1, 6)
asynSetTraceInfoMask(MC_CPU1, -1, 1)
ecmcMotorRecordCreateController(MCU1, MC_CPU1, "64", 200, 1000, "")
############################################################
############# Misc settings:
# Disable function call trace printouts
ecmcConfigOrDie "Cfg.SetEnableFuncCallDiag(0)"
2022/02/09 16:52:44.949 
ECMC Initializes.............
2022/02/09 16:52:44.949 ESS Open Source EtherCAT Motion Control Epics Module2022/02/09 16:52:44.949 
Mode: Configuration
2022/02/09 16:52:44.949 OK
# Disable on change printouts from objects (enable for easy logging)
ecmcConfigOrDie "Cfg.SetTraceMaskBit(15,0)"
2022/02/09 16:52:44.949 OK
# Choose to generate EPICS-records for EtherCAT-entries
# (For records use ECMC_GEN_EC_RECORDS="-records" otherwise ECMC_GEN_EC_RECORDS="")
epicsEnvSet("ECMC_GEN_EC_RECORDS",          "-records")
# Choose to generate EPICS-records for ax-entries (PosAct, SetPos,..)
# (For records use ECMC_GEN_AX_RECORDS="-records" otherwise ECMC_GEN_AX_RECORDS="")
epicsEnvSet("ECMC_GEN_AX_RECORDS",          "-records")
# suffix for pva enabled scripts, templates and substitutions
ecmcEpicsEnvSetCalcTernary(ECMC_PVA, "0", "Pva","")
# Set EtherCAT frequency (defaults to 1000)
ecmcConfigOrDie "Cfg.SetSampleRate(1000)"
2022/02/09 16:52:44.952 OK
epicsEnvSet("ECMC_EC_SAMPLE_RATE" ,   1000)
ecmcEpicsEnvSetCalc("ECMC_EC_SAMPLE_RATE_MS" ,1000/1000)
# Update records in 10ms (100Hz) for FULL MODE and in EC_RATE for DAQ mode
ecmcEpicsEnvSetCalcTernary(ECMC_SAMPLE_RATE_MS, "'FULL'=='DAQ'","1","10")
epicsEnvSet("ECMC_P_SCRIPT",        "mXsXXX")
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd",1)
 iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd", "MASTER_ID=0"
#===============================================================================
# addMaster.cfg
epicsEnvSet("ECMC_EC_MASTER_ID"          "0")
# Claim master
ecmcConfigOrDie "Cfg.EcSetMaster(0)"
2022/02/09 16:52:44.957 OK
epicsEnvSet("ECMC_EC_MASTER_ID" ,0)
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd
#==============================================================================
# setDiagnostics.cmd
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:52:44.971 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:52:44.971 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:52:44.971 OK
epicsEnvSet("ECMCCFG_INIT" ,"#")
##############################################################################
## Configure hardware:
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd
############################################################
############# MCU1025:
#Configure EK1100 coupler terminal
epicsEnvSet(ECMC_EC_SLAVE_NUM,0)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=0, HW_DESC=EK1100"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "0")
epicsEnvSet("HW_DESC",            "EK1100")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EK1100")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x044c2c52")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,0,0x2,0x044c2c52)"
2022/02/09 16:52:44.980 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddSlave(0,0,0x2,0x044c2c52)"
2022/02/09 16:52:44.981 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "0","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s000")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s000-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEK1100.substitutions,ECMC_P=IOC_TEST:m0s000-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEK1100.substitutions,1,1)
dbLoadTemplate(ecmcEK1100.substitutions,"ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "0+1","%d")
#Configure EL1018 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "0+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=1, HW_DESC=EL1018"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "1")
epicsEnvSet("HW_DESC",            "EL1018")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1018")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x03fa3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,1,0x2,0x03fa3052)"
2022/02/09 16:52:45.002 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:52:45.004 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:52:45.004 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a02,0x6020,0x1,B1,binaryInput03)"
2022/02/09 16:52:45.004 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a03,0x6030,0x1,B1,binaryInput04)"
2022/02/09 16:52:45.004 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a04,0x6040,0x1,B1,binaryInput05)"
2022/02/09 16:52:45.004 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a05,0x6050,0x1,B1,binaryInput06)"
2022/02/09 16:52:45.005 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a06,0x6060,0x1,B1,binaryInput07)"
2022/02/09 16:52:45.005 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a07,0x6070,0x1,B1,binaryInput08)"
2022/02/09 16:52:45.005 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "1","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s001")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s001-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1018.substitutions,ECMC_P=IOC_TEST:m0s001-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1018.substitutions,1,1)
dbLoadTemplate(ecmcEL1018.substitutions,"ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "1+1","%d")
#Configure EL2808 digital output terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "1+1")
epicsEnvShow("ECMC_EC_SLAVE_NUM")
ECMC_EC_SLAVE_NUM=2
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=2, HW_DESC=EL2808"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "2")
epicsEnvSet("HW_DESC",            "EL2808")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL2808")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x0af83052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,2,0x2,0x0af83052)"
2022/02/09 16:52:45.016 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX2008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1600,0x7000,0x1,B1,binaryOutput01)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1601,0x7010,0x1,B1,binaryOutput02)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1602,0x7020,0x1,B1,binaryOutput03)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1603,0x7030,0x1,B1,binaryOutput04)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1604,0x7040,0x1,B1,binaryOutput05)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1605,0x7050,0x1,B1,binaryOutput06)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1606,0x7060,0x1,B1,binaryOutput07)"
2022/02/09 16:52:45.018 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1607,0x7070,0x1,B1,binaryOutput08)"
2022/02/09 16:52:45.018 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "2","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s002")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s002-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL2808.substitutions,ECMC_P=IOC_TEST:m0s002-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL2808.substitutions,1,1)
dbLoadTemplate(ecmcEL2808.substitutions,"ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "2+1","%d")
# Save the slave number for later
epicsEnvSet("ECMC_EC_SLAVE_NUM_DIG_OUT", "2")
#Configure EL5002 2-channel SSI encoder terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "2+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=3, HW_DESC=EL5002"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "3")
epicsEnvSet("HW_DESC",            "EL5002")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL5002")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x138a3052")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,3,0x2,0x138a3052)"
2022/02/09 16:52:45.030 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(3,0x1011,0x1,1684107116,4)"
2022/02/09 16:52:45.056 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(3,0x100a,0x0,2)"
2022/02/09 16:52:45.064 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x1,16,encoderStatus01)"
2022/02/09 16:52:45.064 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x11,32,positionActual01)"
2022/02/09 16:52:45.064 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x1,16,encoderStatus02)"
2022/02/09 16:52:45.064 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x11,32,positionActual02)"
2022/02/09 16:52:45.064 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "3","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s003")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s003-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL5002.substitutions,ECMC_P=IOC_TEST:m0s003-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL5002.substitutions,1,1)
dbLoadTemplate(ecmcEL5002.substitutions,"ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "3+1","%d")
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch1-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8000")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x1,0,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x2,0,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x3,0,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x4,0,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x6,1,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x9,3,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0xF,2,1)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x11,27,2)"
2022/02/09 16:52:45.078 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x12,25,2)"
2022/02/09 16:52:45.078 OK
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 2)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch2-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8010")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x1,0,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x2,0,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x3,0,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x4,0,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x6,1,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x9,3,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0xF,2,1)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x11,27,2)"
2022/02/09 16:52:45.083 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x12,25,2)"
2022/02/09 16:52:45.083 OK
# Configure EL9505 Power supply terminal 5V
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "3+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=4, HW_DESC=EL9505"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "4")
epicsEnvSet("HW_DESC",            "EL9505")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9505")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x25213052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,4,0x2,0x25213052)"
2022/02/09 16:52:45.090 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x1,1,powerOk01)"
2022/02/09 16:52:45.095 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x2,1,overload01)"
2022/02/09 16:52:45.096 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "4","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s004")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s004-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9505.substitutions,ECMC_P=IOC_TEST:m0s004-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9505.substitutions,1,1)
dbLoadTemplate(ecmcEL9505.substitutions,"ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "4+1","%d")
# Configure EL1252 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "4+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=5, HW_DESC=EL1252"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "5")
epicsEnvSet("HW_DESC",            "EL1252")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1252")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x04e43052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,5,0x2,0x04e43052)"
2022/02/09 16:52:45.116 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1002.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:52:45.118 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:52:45.118 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xae,U8,status01)"
2022/02/09 16:52:45.119 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xaf,U8,status02)"
2022/02/09 16:52:45.119 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb0,U64,timestampLatchPositive01)"
2022/02/09 16:52:45.119 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb8,U64,timestampLatchNegative01)"
2022/02/09 16:52:45.119 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc0,U64,timestampLatchPositive02)"
2022/02/09 16:52:45.119 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc8,U64,timestampLatchNegative02)"
2022/02/09 16:52:45.119 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "5","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s005")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s005-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1252.substitutions,ECMC_P=IOC_TEST:m0s005-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1252.substitutions,1,1)
dbLoadTemplate(ecmcEL1252.substitutions,"ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "5+1","%d")
# Configure EL9410 Power supply with refresh of E-Bus.
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "5+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=6, HW_DESC=EL9410"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "6")
epicsEnvSet("HW_DESC",            "EL9410")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9410")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x24c23052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,6,0x2,0x24c23052)"
2022/02/09 16:52:45.138 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a00,0x6000,0x1,1,underVoltageEbus01)"
2022/02/09 16:52:45.138 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a01,0x6000,0x1,1,underVoltagePower01)"
2022/02/09 16:52:45.138 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "6","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s006")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s006-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9410.substitutions,ECMC_P=IOC_TEST:m0s006-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9410.substitutions,1,1)
dbLoadTemplate(ecmcEL9410.substitutions,"ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "6+1","%d")
#Configure EL7037 stepper drive terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "6+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=7, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B, CFG_MACROS='I_RUN_MA=900,I_STDBY_MA=200'"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=7, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,7,0x2,0x1b7d3052)"
2022/02/09 16:52:45.150 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(7,0x1011,0x1,1684107116,4)"
2022/02/09 16:52:45.210 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(7,0x100a,0x0,2)"
2022/02/09 16:52:45.218 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:52:45.220 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:52:45.221 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x5,1,1)"
2022/02/09 16:52:45.221 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0xA,1,1)"
2022/02/09 16:52:45.221 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x8,1,1)"
2022/02/09 16:52:45.221 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x9,0,1)"
2022/02/09 16:52:45.221 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "7","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s007")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s007-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s007-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "7+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd "I_RUN_MA=900,I_STDBY_MA=200"
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,900)
epicsEnvSet(I_STDBY_MA_LOCAL,200)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=900,I_STDBY_MA=200,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "900>1500 or 900<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (900)...")
# Result: 
# Run current setting OK (900)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>1500 or 200<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (200)...")
# Result: 
# Standby current setting OK (200)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>900", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (200<900)...")
# Result: 
# Standby current and run current setting OK (200<900)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x1,900,2)"
2022/02/09 16:52:45.237 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x2,200,2)"
2022/02/09 16:52:45.238 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x3,2400,2)"
2022/02/09 16:52:45.238 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x4,175,2)"
2022/02/09 16:52:45.238 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x6,200,2)"
2022/02/09 16:52:45.238 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0xA,330,2)"
2022/02/09 16:52:45.238 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Configure EL7037 stepper drive terminal, motor 2
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "7+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=8, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=8, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,8,0x2,0x1b7d3052)"
2022/02/09 16:52:45.240 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(8,0x1011,0x1,1684107116,4)"
2022/02/09 16:52:45.298 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(8,0x100a,0x0,2)"
2022/02/09 16:52:45.306 13360
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "13360", "0x%04x")
# Firmware version: 0x3430
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:52:45.306 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:52:45.306 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:52:45.306 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:52:45.306 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x5,1,1)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0xA,1,1)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x8,1,1)"
2022/02/09 16:52:45.307 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x9,0,1)"
2022/02/09 16:52:45.307 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "8","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s008")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s008-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s008-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "8+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd ""
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,1000)
epicsEnvSet(I_STDBY_MA_LOCAL,500)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=1000,I_STDBY_MA=500,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "1000>1500 or 1000<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (1000)...")
# Result: 
# Run current setting OK (1000)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1500 or 500<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (500)...")
# Result: 
# Standby current setting OK (500)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1000", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (500<1000)...")
# Result: 
# Standby current and run current setting OK (500<1000)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x1,1000,2)"
2022/02/09 16:52:45.311 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x2,500,2)"
2022/02/09 16:52:45.311 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x3,2400,2)"
2022/02/09 16:52:45.311 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x4,175,2)"
2022/02/09 16:52:45.311 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x6,200,2)"
2022/02/09 16:52:45.311 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0xA,330,2)"
2022/02/09 16:52:45.311 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Apply hardware configuration
ecmcConfigOrDie "Cfg.EcApplyConfig(1)"
2022/02/09 16:52:45.312 OK
# ADDITIONAL SETUP
# Set all outputs to feed switches
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput01,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput02,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput03,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput04,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput05,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput06,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput07,1)"
2022/02/09 16:52:45.312 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput08,1)"
2022/02/09 16:52:45.312 OK
# END of ADDITIONAL SETUP
##############################################################################
## AXIS 1
#
epicsEnvSet("DEV",      "IOC_TEST")
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureAxis.cmd, CONFIG=./cfg/linear_1.ax)
#==============================================================================
# configureAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
ecmcFileExist("./cfg/linear_1.ax",1)
iocshLoad ./cfg/linear_1.ax ""
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis1")
epicsEnvSet("ECMC_R",                     "Axis1-")
epicsEnvSet("ECMC_AXIS_NO",               "1")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Lower Axis (1)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "-60")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "4096")
epicsEnvSet("ECMC_ENC_BITS"               "25")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "25")                       # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "25")                       # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "-100")                     # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s3.positionActual01")         # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "ec0.s3.encoderStatus01.0")      # Error 0: SSI input error
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "ec0.s3.encoderStatus01.1")      # Error 1: SSI frame error
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "ec0.s3.encoderStatus01.2")      # Error 2: Encoder power fail
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Drive
epicsEnvSet("ECMC_DRV_TYPE"               "0")                        # Stepper: 0. DS402: 1 (DS402 = servos and advanced stepper drives)
epicsEnvSet("ECMC_DRV_SCALE_NUM"          "600.0")                    # Fastest speed in engineering units
epicsEnvSet("ECMC_DRV_SCALE_DENOM"        "32768.0")                  # I/O range for ECMC_EC_ALIAS_DRV_VELO_SET
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "ec0.s7.driveControl01.0")     # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "ec0.s7.driveStatus01.1")      # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "ec0.s7.velocitySetpoint01") # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "ec0.s7.driveControl01.2")     # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "")                         # Ethercat entry for brake output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_EC_DRV_RESET",          "ec0.s7.driveControl01.1")     # Reset
epicsEnvSet("ECMC_EC_DRV_ALARM_0",        "ec0.s7.driveStatus01.3")      # Error
epicsEnvSet("ECMC_EC_DRV_ALARM_1",        "ec0.s7.driveStatus01.7")      # Stall
epicsEnvSet("ECMC_EC_DRV_ALARM_2",        "ec0.s7.driveStatus01.14")     # Sync error
epicsEnvSet("ECMC_EC_DRV_WARNING",        "ec0.s7.driveStatus01.2")      # Warning
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Controller
epicsEnvSet("ECMC_CNTRL_KP",              "15.0")
epicsEnvSet("ECMC_CNTRL_KI",              "0.02")
epicsEnvSet("ECMC_CNTRL_KD",              "0.0")
epicsEnvSet("ECMC_CNTRL_KFF",             "1.0")
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s1.binaryInput02.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s1.binaryInput01.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s1.binaryInput03.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s1.ONE.0")              #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "-50")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "80")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "1")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.1")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",     "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "100.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd
#==============================================================================
# addAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd
#==============================================================================
# ecmc_axis-records.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd
#==============================================================================
# ecmc_axis.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(-60)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == -60...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(-60)<>0","# ECMC_ENC_SCALE_NUM value OK == -60...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == -60...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(4096)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 4096...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(4096)<>0","# ECMC_ENC_SCALE_DENOM value OK == 4096...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 4096...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(600.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_NUM value OK == 600.0...',ERROR_STR='ECMC_DRV_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(600.0)<>0","# ECMC_DRV_SCALE_NUM value OK == 600.0...", "ecmcExit Error: ECMC_DRV_SCALE_NUM == 0...")
# ECMC_DRV_SCALE_NUM value OK == 600.0...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(32768.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_DENOM value OK == 32768.0...',ERROR_STR='ECMC_DRV_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(32768.0)<>0","# ECMC_DRV_SCALE_DENOM value OK == 32768.0...", "ecmcExit Error: ECMC_DRV_SCALE_DENOM == 0...")
# ECMC_DRV_SCALE_DENOM value OK == 32768.0...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(1,1,0)"
2022/02/09 16:52:45.328 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.health")"
2022/02/09 16:52:45.328 OK
ecmcConfigOrDie "Cfg.SetAxisModRange(1, 0)"
2022/02/09 16:52:45.328 OK
ecmcConfigOrDie "Cfg.SetAxisModType(1, 0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(1,0.1)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(1,5.0,0.1)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelTwordsCam(1,5)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(1,4)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKp(1,15.0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKi(1,0.02)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKd(1,0.0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKff(1,1.0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.positionActual01,"ax1.enc.actpos")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(1,4096)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(1,-60)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncType(1,1)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncBits(1,25)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(1,25)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncOffset(1,-100)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(1,100)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(1,1)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(1,0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.reset")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.0,"ax1.enc.alarm0")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.1,"ax1.enc.alarm1")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.2,"ax1.enc.alarm2")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.warning")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchpos")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchcontrol")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchstatus")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.0,"ax1.drv.control")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.1,"ax1.drv.status")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.velocitySetpoint01,"ax1.drv.velocity")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.position")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.brake")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.2,"ax1.drv.reducetorque")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.1,"ax1.drv.reset")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.3,"ax1.drv.alarm0")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.7,"ax1.drv.alarm1")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.14,"ax1.drv.alarm2")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.2,"ax1.drv.warning")"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleDenom(1,32768.0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleNum(1,600.0)"
2022/02/09 16:52:45.329 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeOpenDelayTime(1,0)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeCloseAheadTime(1,0)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(1,-50)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(1,1)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(1,80)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(1,1)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput02.0,"ax1.mon.lowlim")"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput01.0,"ax1.mon.highlim")"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput03.0,"ax1.mon.homesensor")"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.ONE.0,"ax1.mon.extinterlock")"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(1,0.1)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(1,100)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(1,1)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(1,0.5)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(1,100)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(1,1)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(1,100.0)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(1,1)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(1,200)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(1,100)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(1,0)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(1,0)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Main.M1.fHomePosition=0.0"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(1, 0)"
2022/02/09 16:52:45.330 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(1, 0)"
2022/02/09 16:52:45.330 OK
ecmcMotorRecordCreateAxis(MCU1, "1", "6", )
2022/02/09 16:52:45.330 ecmcMotorRecord:: setIntegerParam(1 motorPowerAutoOnOff_)=2
2022/02/09 16:52:45.330 ecmcMotorRecord:: setDoubleParam(1 motorPowerOnDelay_)=6
2022/02/09 16:52:45.330 ecmcMotorRecord:: setDoubleParam(1 motorPowerOffDelay_=-1
2022/02/09 16:52:45.330 ecmcMotorRecord:: udateMotorLimitsRO(1) enabledHighAndLow=1 valid=1 fValueHigh=80 fValueLow=-50
2022/02/09 16:52:45.330 ecmcMotorRecord:: connected(1)
2022/02/09 16:52:45.330 ecmcMotorRecord:: initialPoll(1) status=0
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(4096)>0){RESULT:=abs(4096);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(-60)>0){RESULT:=abs(-60);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1, DESC=MCU1025 Lower Axis (1), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.1, DLLM=-50, DHLM=80, HOMEPROC=3,SREV=4096,UREV=60.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_NO=1,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_TYPE=1")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd
#==============================================================================
# ecmc_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_CNTRL_KP)
epicsEnvUnset(ECMC_CNTRL_KI)
epicsEnvUnset(ECMC_CNTRL_KD)
epicsEnvUnset(ECMC_CNTRL_KFF)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCHPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCH_CONTROL)
epicsEnvUnset(ECMC_EC_ENC_LATCH_STATUS)
epicsEnvUnset(ECMC_HOME_LATCH_COUNT_OFFSET)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_DRV_CONTROL)
epicsEnvUnset(ECMC_EC_DRV_STATUS)
epicsEnvUnset(ECMC_EC_DRV_VELOCITY)
epicsEnvUnset(ECMC_EC_DRV_BRAKE)
epicsEnvUnset(ECMC_EC_DRV_REDUCE_TORQUE)
epicsEnvUnset(ECMC_EC_DRV_RESET)
epicsEnvUnset(ECMC_EC_DRV_ALARM_0)
epicsEnvUnset(ECMC_EC_DRV_ALARM_1)
epicsEnvUnset(ECMC_EC_DRV_ALARM_2)
epicsEnvUnset(ECMC_EC_DRV_WARNING)
epicsEnvUnset(ECMC_DRV_SCALE_DENOM)
epicsEnvUnset(ECMC_DRV_SCALE_NUM)
epicsEnvUnset(ECMC_DRV_BRAKE_OPEN_DLY_TIME)
epicsEnvUnset(ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
##############################################################################
## AXIS 2
#
#epicsEnvSet("DEV",      "$(IOC)")
#$(SCRIPTEXEC) ($(ecmccfg_DIR)configureAxis.cmd, CONFIG=./cfg/linear_2.ax)
##############################################################################
############# Configure diagnostics:
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:52:45.348 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:52:45.348 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:52:45.348 OK
ecmcConfigOrDie "Cfg.SetDiagAxisIndex(1)"
2022/02/09 16:52:45.348 OK
ecmcConfigOrDie "Cfg.SetDiagAxisFreq(2)"
2022/02/09 16:52:45.348 OK
ecmcConfigOrDie "Cfg.SetDiagAxisEnable(0)"
2022/02/09 16:52:45.348 OK
# go active
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setAppMode.cmd)
2022/02/09 16:52:45.349 ecmcMotorRecord:: poll(1) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000016
2022/02/09 16:52:45.349 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:52:45.349 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
#==============================================================================
# setAppMode.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd
#==============================================================================
# general.cmd
ecmcFileExist("ecmcGeneral.db",1,1)
dbLoadRecords("ecmcGeneral.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2,ECMC_PROC_HOOK=")
# Examples of commands for info:
# ecmcReport <level> or asynReport <level>
# ecmcReport 3
# ecmcGrepParam <pattern>
# List all ecmc params for ethercat slave 2:
# ecmcGrepParam *s2*
#
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("ecmcEc.db",1,1)
 dbLoadRecords("ecmcEc.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,T_SMP_MS=10,TSE=-2")
ecmcConfigOrDie "Cfg.SetAppMode(1)"
2022/02/09 16:52:45.359 INFO: Locking memory
2022/02/09 16:52:45.371 Starting up EtherCAT bus: 0 second(s). Max wait time 30 second(s).
2022/02/09 16:52:45.460 ../devEcmcSup/motion/ecmcMonitor.cpp/checkLimits:501: ERROR_MON_BOTH_LIMIT_INTERLOCK (0x14c10).
2022/02/09 16:52:45.460 ../devEcmcSup/motion/ecmcAxisReal.cpp/execute:198: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 0: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 1: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 2: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 3: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 4: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 5: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 6: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 7: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 8: Not operational (0x24011).
2022/02/09 16:52:45.460 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:52:45.549 ecmcMotorRecord:: poll(1) homed=1
2022/02/09 16:52:45.549 ecmcMotorRecord:: poll(1) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=-100 time=0.000014
2022/02/09 16:52:45.549 ecmcMotorRecord:: poll(1) bError=1 drvlocal.statusBinData.onChangeData.error=0x14315
2022/02/09 16:52:45.549 ecmcMotorRecord:: sErrorMessage(1)="ERROR_AXIS_HARDWARE_STATUS_NOT_OK"
2022/02/09 16:52:45.549 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=1 old=4 ErrID=0x14315 old=0x0 Warn=0 nCmd=0 old=0 txt=E: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315)
2022/02/09 16:52:46.026 ../devEcmcSup/motion/ecmcDriveBase.cpp/readEntries:369: WARNING (axis 1): Drive hardware in warning state.
2022/02/09 16:52:46.371 Starting up EtherCAT bus: 1 second(s). Max wait time 30 second(s).
2022/02/09 16:52:46.463 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:52:46.463 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:52:46.463 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:52:46.549 ecmcMotorRecord:: poll(1) LLS=0
2022/02/09 16:52:46.549 ecmcMotorRecord:: poll(1) HLS=0
2022/02/09 16:52:46.549 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:52:46.549 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=0 old=1 ErrID=0x0 old=0x14315 Warn=0 nCmd=0 old=0 txt=NULL
2022/02/09 16:52:48.371 EtherCAT bus started!
2022/02/09 16:52:48.371 OK
# Set the IOC Prompt String One 
epicsEnvSet IOCSH_PS1 "mcag-dev-asm-02-30065 > "
#
# 
iocInit
2022/02/09 16:52:48.373 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocBuild (0). Allow callbacks: true.
Starting iocInit
2022/02/09 16:52:48.373 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtBeginning (1). Allow callbacks: true.
############################################################################
## EPICS R7.0.5-E3-7.0.5-patch
## Rev. 2021-03-19T22:08+0100
############################################################################
2022/02/09 16:52:48.375 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCallbackInit (2). Allow callbacks: true.
2022/02/09 16:52:48.379 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaLinkInit (3). Allow callbacks: true.
2022/02/09 16:52:48.379 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDrvSup (4). Allow callbacks: true.
2022/02/09 16:52:48.379 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitRecSup (5). Allow callbacks: true.
2022/02/09 16:52:48.381 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDevSup (6). Allow callbacks: true.
2022/02/09 16:52:48.384 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput01 linked to record (asyn reason 1).
2022/02/09 16:52:48.384 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput02 linked to record (asyn reason 2).
2022/02/09 16:52:48.385 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput03 linked to record (asyn reason 3).
2022/02/09 16:52:48.385 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput04 linked to record (asyn reason 4).
2022/02/09 16:52:48.385 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput05 linked to record (asyn reason 5).
2022/02/09 16:52:48.385 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput06 linked to record (asyn reason 6).
2022/02/09 16:52:48.385 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput07 linked to record (asyn reason 7).
2022/02/09 16:52:48.385 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput08 linked to record (asyn reason 8).
2022/02/09 16:52:48.386 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.reset linked to record (asyn reason 9).
2022/02/09 16:52:48.386 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveControl01 linked to record (asyn reason 10).
2022/02/09 16:52:48.386 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.velocitySetpoint01 linked to record (asyn reason 11).
2022/02/09 16:52:48.387 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderControl01 linked to record (asyn reason 12).
2022/02/09 16:52:48.387 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderValue01 linked to record (asyn reason 13).
2022/02/09 16:52:48.387 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveControl01 linked to record (asyn reason 14).
2022/02/09 16:52:48.387 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.velocitySetpoint01 linked to record (asyn reason 15).
2022/02/09 16:52:48.387 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderControl01 linked to record (asyn reason 16).
2022/02/09 16:52:48.388 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderValue01 linked to record (asyn reason 17).
2022/02/09 16:52:48.388 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus01 linked to record (asyn reason 18).
2022/02/09 16:52:48.388 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus02 linked to record (asyn reason 19).
2022/02/09 16:52:48.389 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status01 linked to record (asyn reason 20).
2022/02/09 16:52:48.389 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status02 linked to record (asyn reason 21).
2022/02/09 16:52:48.389 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveStatus01 linked to record (asyn reason 22).
2022/02/09 16:52:48.389 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderStatus01 linked to record (asyn reason 23).
2022/02/09 16:52:48.389 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveStatus01 linked to record (asyn reason 24).
2022/02/09 16:52:48.390 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderStatus01 linked to record (asyn reason 25).
2022/02/09 16:52:48.390 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.diagnostic linked to record (asyn reason 26).
2022/02/09 16:52:48.390 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.plc.expression linked to record (asyn reason 27).
2022/02/09 16:52:48.390 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.msg linked to record (asyn reason 28).
2022/02/09 16:52:48.390 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.updated linked to record (asyn reason 29).
2022/02/09 16:52:48.390 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.slavestatus linked to record (asyn reason 30).
2022/02/09 16:52:48.391 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.slavestatus linked to record (asyn reason 31).
2022/02/09 16:52:48.391 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.slavestatus linked to record (asyn reason 32).
2022/02/09 16:52:48.391 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.slavestatus linked to record (asyn reason 33).
2022/02/09 16:52:48.392 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.slavestatus linked to record (asyn reason 34).
2022/02/09 16:52:48.392 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.slavestatus linked to record (asyn reason 35).
2022/02/09 16:52:48.392 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.slavestatus linked to record (asyn reason 36).
2022/02/09 16:52:48.392 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.slavestatus linked to record (asyn reason 37).
2022/02/09 16:52:48.393 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.slavestatus linked to record (asyn reason 38).
2022/02/09 16:52:48.393 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.status linked to record (asyn reason 39).
2022/02/09 16:52:48.393 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.masterstatus linked to record (asyn reason 40).
2022/02/09 16:52:48.393 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.slavecounter linked to record (asyn reason 41).
2022/02/09 16:52:48.394 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.memmapcounter linked to record (asyn reason 42).
2022/02/09 16:52:48.394 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainfailcountertotal linked to record (asyn reason 43).
2022/02/09 16:52:48.394 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.entrycounter linked to record (asyn reason 44).
2022/02/09 16:52:48.395 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainstatus linked to record (asyn reason 45).
2022/02/09 16:52:48.395 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput01 linked to record (asyn reason 46).
2022/02/09 16:52:48.395 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput02 linked to record (asyn reason 47).
2022/02/09 16:52:48.396 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput03 linked to record (asyn reason 48).
2022/02/09 16:52:48.397 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput04 linked to record (asyn reason 49).
2022/02/09 16:52:48.397 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput05 linked to record (asyn reason 50).
2022/02/09 16:52:48.397 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput06 linked to record (asyn reason 51).
2022/02/09 16:52:48.398 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput07 linked to record (asyn reason 52).
2022/02/09 16:52:48.399 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput08 linked to record (asyn reason 53).
2022/02/09 16:52:48.399 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.powerOk01 linked to record (asyn reason 54).
2022/02/09 16:52:48.400 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.overload01 linked to record (asyn reason 55).
2022/02/09 16:52:48.400 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput01 linked to record (asyn reason 56).
2022/02/09 16:52:48.401 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput02 linked to record (asyn reason 57).
2022/02/09 16:52:48.402 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltageEbus01 linked to record (asyn reason 58).
2022/02/09 16:52:48.402 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltagePower01 linked to record (asyn reason 59).
2022/02/09 16:52:48.403 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.enable linked to record (asyn reason 60).
2022/02/09 16:52:48.404 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.firstscan linked to record (asyn reason 61).
2022/02/09 16:52:48.405 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.ok linked to record (asyn reason 62).
2022/02/09 16:52:48.406 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.control linked to record (asyn reason 63).
2022/02/09 16:52:48.406 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ONE linked to record (asyn reason 64).
2022/02/09 16:52:48.407 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ZERO linked to record (asyn reason 65).
2022/02/09 16:52:48.408 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ONE linked to record (asyn reason 66).
2022/02/09 16:52:48.408 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ZERO linked to record (asyn reason 67).
2022/02/09 16:52:48.409 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ONE linked to record (asyn reason 68).
2022/02/09 16:52:48.410 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ZERO linked to record (asyn reason 69).
2022/02/09 16:52:48.411 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ONE linked to record (asyn reason 70).
2022/02/09 16:52:48.411 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ZERO linked to record (asyn reason 71).
2022/02/09 16:52:48.412 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ONE linked to record (asyn reason 72).
2022/02/09 16:52:48.413 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ZERO linked to record (asyn reason 73).
2022/02/09 16:52:48.414 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ONE linked to record (asyn reason 74).
2022/02/09 16:52:48.414 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ZERO linked to record (asyn reason 75).
2022/02/09 16:52:48.415 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ONE linked to record (asyn reason 76).
2022/02/09 16:52:48.416 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ZERO linked to record (asyn reason 77).
2022/02/09 16:52:48.417 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ONE linked to record (asyn reason 78).
2022/02/09 16:52:48.417 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ZERO linked to record (asyn reason 79).
2022/02/09 16:52:48.418 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ONE linked to record (asyn reason 80).
2022/02/09 16:52:48.419 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ZERO linked to record (asyn reason 81).
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeFallTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeFallTS
2022/02/09 16:52:48.421 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual01 linked to record (asyn reason 82).
2022/02/09 16:52:48.423 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual02 linked to record (asyn reason 83).
2022/02/09 16:52:48.423 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive01 linked to record (asyn reason 84).
2022/02/09 16:52:48.424 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative01 linked to record (asyn reason 85).
2022/02/09 16:52:48.425 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive02 linked to record (asyn reason 86).
2022/02/09 16:52:48.426 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative02 linked to record (asyn reason 87).
2022/02/09 16:52:48.428 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.positionActual01 linked to record (asyn reason 88).
2022/02/09 16:52:48.429 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderLatchPostion01 linked to record (asyn reason 89).
2022/02/09 16:52:48.432 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.positionActual01 linked to record (asyn reason 90).
2022/02/09 16:52:48.433 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderLatchPostion01 linked to record (asyn reason 91).
2022/02/09 16:52:48.436 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.actpos linked to record (asyn reason 92).
2022/02/09 16:52:48.436 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.setpos linked to record (asyn reason 93).
2022/02/09 16:52:48.438 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.poserr linked to record (asyn reason 94).
2022/02/09 16:52:48.439 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.error linked to record (asyn reason 95).
2022/02/09 16:52:48.440 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.appmode linked to record (asyn reason 96).
2022/02/09 16:52:48.441 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.id linked to record (asyn reason 97).
2022/02/09 16:52:48.442 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.min linked to record (asyn reason 98).
2022/02/09 16:52:48.442 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.max linked to record (asyn reason 99).
2022/02/09 16:52:48.443 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.min linked to record (asyn reason 100).
2022/02/09 16:52:48.444 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.max linked to record (asyn reason 101).
2022/02/09 16:52:48.445 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.min linked to record (asyn reason 102).
2022/02/09 16:52:48.446 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.max linked to record (asyn reason 103).
2022/02/09 16:52:48.447 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.min linked to record (asyn reason 104).
2022/02/09 16:52:48.448 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.max linked to record (asyn reason 105).
2022/02/09 16:52:48.449 [devMotorAsyn.c:439  IOC_TEST:Axis1] init_record IOC_TEST:Axis1 position=-34.521484 encoderPos=-34.521484 velocity=0.000000 MSTAstatus=0x490a flagsValue=0x1f flagsWritten=0x1f pmr->mflg=0x0
2022/02/09 16:52:48.450 [devMotorAsyn.c:185  IOC_TEST:Axis1] init_controller IOC_TEST:Axis1 set encoder ratio=1.000000 status=0
2022/02/09 16:52:48.450 [devMotorAsyn.c:266  IOC_TEST:Axis1] update_soft_limits IOC_TEST:Axis1 RawHLM_RO=80.000000 RawLLM_RO=-50.000000 valid=1 DHLM_RO=80.000000 DLLM_RO=-50.000000
2022/02/09 16:52:48.450 [motorDevSup.c:327  IOC_TEST:Axis1] PositionRestoreNeeded IOC_TEST:Axis1 rstm=2 dval=0.000000 drbv=-34.521484 pmr->rdbd=0.100000 rdbd=0.100000 pmr->mres=0.014648 pmr->mflg=0x1f dval_non_zero_pos_near_zero=0 ret=0
2022/02/09 16:52:48.450 [motorRecord.cc:781  IOC_TEST:Axis1] init_re_init start neverPolled=0 stat=17 nsta=0
2022/02/09 16:52:48.450 [motorRecord.cc:719  IOC_TEST:Axis1] enforceMinRetryDeadband spdb=0.100000 rdbd=0.100000 mres=0.014648
2022/02/09 16:52:48.450 [motorRecord.cc:4373 IOC_TEST:Axis1] pmr->dhlm=80 softLimitRO=80
2022/02/09 16:52:48.450 [motorRecord.cc:4434 IOC_TEST:Axis1] pmr->dllm=-50 softLimitRO=-50
2022/02/09 16:52:48.450 [motorRecord.cc:832  IOC_TEST:Axis1] init_re_init  end dval=-34.521484 drbv=-34.521484 rdbd=0.100000 spdb=0.100000
2022/02/09 16:52:48.450 [motorRecord.cc:967  IOC_TEST:Axis1] init_record process_reason="callbackdata + soft limits" dval=-34.521484 drbv=-34.521484 rdbd=0.100000 spdb=0.100000 stat=0 msta=0x490a neverPolled=0
2022/02/09 16:52:48.450 ecmcMotorRecord:: setIntegerParam(1 motorUpdateStatus_)=0
2022/02/09 16:52:48.455 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDatabase (7). Allow callbacks: true.
2022/02/09 16:52:48.455 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterFinishDevSup (8). Allow callbacks: true.
2022/02/09 16:52:48.960 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterScanInit (9). Allow callbacks: true.
2022/02/09 16:52:48.961 ecmcMotorRecord:: setDoubleParam(1 HomPos_)=0.000000
2022/02/09 16:52:48.961 ecmcMotorRecord:: setIntegerParam(1 HomProc_)=3 motorNotHomedProblem=0
2022/02/09 16:52:48.961 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitialProcess (10). Allow callbacks: true.
2022/02/09 16:52:48.964 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (11). Allow callbacks: true.
2022/02/09 16:52:48.964 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocBuilt (12). Allow callbacks: true.
2022/02/09 16:52:48.968 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocRun (13). Allow callbacks: true.
2022/02/09 16:52:48.968 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterDatabaseRunning (14). Allow callbacks: true.
2022/02/09 16:52:48.968 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInterruptAccept (28). Allow callbacks: true.
2022/02/09 16:52:48.968 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaServerRunning (15). Allow callbacks: true.
2022/02/09 16:52:48.968 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (29). Allow callbacks: true.
iocRun: All initialization complete
2022/02/09 16:52:48.974 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocRunning (16). Allow callbacks: true.
mcag-dev-asm-02-30065 > @@@ Current time: Wed Feb  9 16:54:14 2022
@@@ Child process is shutting down, a new one will be restarted shortly
@@@ ^R or ^X restarts the child, ^Q quits the server
@@@ Restarting child "mcu1025"
@@@    (as /epics/base-7.0.5/require/3.4.1/bin/iocsh.bash)
@@@ The PID of new child "mcu1025" is: 30465
@@@ @@@ @@@ @@@ @@@
Loading environment variables from /home/anderssandstrom/sources/test_service/env.sh

Set the ESS EPICS Environment as follows:
THIS Source NAME    : setE3Env.bash
THIS Source PATH    : /epics/base-7.0.5/require/3.4.1/bin
EPICS_BASE          : /epics/base-7.0.5
EPICS_HOST_ARCH     : linux-x86_64
E3_REQUIRE_LOCATION : /epics/base-7.0.5/require/3.4.1
PATH                : /epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
LD_LIBRARY_PATH     : /epics/base-7.0.5/lib/linux-x86_64:/epics/base-7.0.5/require/3.4.1/lib/linux-x86_64

Enjoy E3!
registerChannelProviderLocal firstTime true
#
# Start at "2022-W06-Feb09-1657-15-CET"
#
# Version information:
# European Spallation Source ERIC : iocsh.bash (-PID-30465)
#
# --->--> snip -->--> 
# Please Use Version and other environment variables
# in order to report or debug this shell
#
# HOSTDISPLAY=""
# WINDOWID=""
# PWD="/home/anderssandstrom/sources/test_service"
# USER=""
# LOGNAME=""
# EPICS_HOST_ARCH="linux-x86_64"
# EPICS_BASE="/epics/base-7.0.5"
# E3_REQUIRE_NAME="require"
# E3_REQUIRE_VERSION="3.4.1"
# E3_REQUIRE_LOCATION="/epics/base-7.0.5/require/3.4.1"
# E3_REQUIRE_BIN="/epics/base-7.0.5/require/3.4.1/bin"
# E3_REQUIRE_DB="/epics/base-7.0.5/require/3.4.1/db"
# E3_REQUIRE_DBD="/epics/base-7.0.5/require/3.4.1/dbd"
# E3_REQUIRE_INC="/epics/base-7.0.5/require/3.4.1/include"
# E3_REQUIRE_LIB="/epics/base-7.0.5/require/3.4.1/lib"
# EPICS_DRIVER_PATH="/epics/base-7.0.5/require/3.4.1/siteMods:/epics/base-7.0.5/require/3.4.1/siteApps"
# EPICS_CA_AUTO_ADDR_LIST=""
# EPICS_CA_ADDR_LIST=""
# PATH="/epics/base-7.0.5/require/3.4.1/bin:/epics/base-7.0.5/bin/linux-x86_64:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin"
# --->--> snip -->--> 
#
# Set REQUIRE_IOC for its internal PVs
epicsEnvSet REQUIRE_IOC "REQMOD:mcag-dev-asm-02-30465"
#
# Enable an exit subroutine for sotfioc
dbLoadRecords "/epics/base-7.0.5/db/softIocExit.db" "IOC=REQMOD:mcag-dev-asm-02-30465"
#
# Set E3_IOCSH_TOP for the absolute path where iocsh.bash is executed.
epicsEnvSet E3_IOCSH_TOP "/home/anderssandstrom/sources/test_service"
#
# 
# Load require module, which has the version 3.4.1
# 
dlload /epics/base-7.0.5/require/3.4.1/lib/linux-x86_64/librequire.so
dbLoadDatabase /epics/base-7.0.5/require/3.4.1/dbd/require.dbd
require_registerRecordDeviceDriver
Loading module info records for require
# 
# Set E3_CMD_TOP for the absolute path where mcu1025.script exists
epicsEnvSet E3_CMD_TOP "/home/anderssandstrom/sources/test_service"
#
iocshLoad '/home/anderssandstrom/sources/test_service/mcu1025.script',''
##############################################################################
## Example config ESS crate of type MCU1025
##############################################################################
## Initiation:
epicsEnvSet("IOC" ,"IOC_TEST")
epicsEnvSet("ECMCCFG_INIT" ,"")  #Only run startup once (auto at PSI, need call at ESS), variable set to "#" in startup.cmd
epicsEnvSet("SCRIPTEXEC" ,"iocshLoad")
require ecmccfg 7.0.1
Module ecmccfg version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/lib/linux-x86_64/libecmccfg.so
Loaded ecmccfg version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/dbd/ecmccfg.dbd
Calling function ecmccfg_registerRecordDeviceDriver
Loading module info records for ecmccfg
# Epics Motor record driver that will be used:
epicsEnvShow(ECMC_MR_MODULE)
ECMC_MR_MODULE is not an environment variable.
# run module startup.cmd (only needed at ESS  PSI auto call at require)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/startup.cmd, "IOC=IOC_TEST,ECMC_VER=7.0.1"
#==============================================================================
# startup.cmd
on error halt
require ecmc        "7.0.1"
Module ecmc version 7.0.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/
Module ecmc depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/lib/linux-x86_64/libasyn.so
Loaded asyn version 4.41.0+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/asyn/4.41.0+0/dbd/asyn.dbd
Calling function asyn_registerRecordDeviceDriver
Loading module info records for asyn
Module ecmc depends on exprtk 1.2.1+0
Module exprtk version 1.2.1+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/exprtk/1.2.1+0/lib/linux-x86_64/libexprtk.so
Loaded exprtk version 1.2.1+0
exprtk has no dbd file
Loading module info records for exprtk
Module ecmc depends on motor 7.0.6+0
Module motor version 7.0.6+0 found in /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/
Module motor depends on asyn 4.41.0+0
Module asyn version 4.41.0+0 already loaded
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/lib/linux-x86_64/libmotor.so
Loaded motor version 7.0.6+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/motor/7.0.6+0/dbd/motor.dbd
Calling function motor_registerRecordDeviceDriver
Loading module info records for motor
Loading library /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/lib/linux-x86_64/libecmc.so
Loaded ecmc version 7.0.1+0
Loading dbd file /epics/base-7.0.5/require/3.4.1/siteMods/ecmc/7.0.1+0/dbd/ecmc.dbd
Calling function ecmc_registerRecordDeviceDriver
Loading module info records for ecmc
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'ecmcMotorRecord'='EthercatMC'", "require  EthercatMC 3.0.2 # Using EthercatMC motor record support.","# Using ecmcMotorRecord motor record support.")
# Using ecmcMotorRecord motor record support.
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_CONFIG_ROOT",     "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/")
epicsEnvSet("ECMC_CONFIG_DB",       "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/db")
epicsEnvSet("SCRIPTEXEC",           "iocshLoad")
epicsEnvSet("SM_PREFIX",            "IOC_TEST:")    # colon added since IOC is _not_ PREFIX
epicsEnvSet("ECMC_PROC_HOOK",       "")
epicsEnvSet(ECMC_MODE, FULL)
ecmcEpicsEnvSetCalcTernary(ECMC_SUPPORT_MOTION, "'FULL'=='FULL'","","# MODE == DAQ, DISABLING MOTION.")
epicsEnvShow(ECMC_SUPPORT_MOTION)
ECMC_SUPPORT_MOTION=
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAll.cmd"
#==============================================================================
# initAll.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/init.cmd
#==============================================================================
# init.cmd
epicsEnvSet("ECMC_ASYN_TIMEOUT",      1)                   # Asyn timeout
epicsEnvSet("ECMC_ASYN_ADDR",         0)                   # Asyn Address
epicsEnvSet("ECMC_MOTOR_PORT",        "NOT SET")
epicsEnvSet("ECMC_ASYN_PORT",         "NOT SET")
epicsEnvSet("ECMC_PREFIX",            "NOT SET")
epicsEnvSet("ECMC_GEN_EC_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_GEN_AX_RECORDS",    "NOT SET")
epicsEnvSet("ECMC_EC_AXIS_HEALTH",    "NOT SET")
epicsEnvSet("ECMC_PLC_SAMPLE_RATE_MS", "NOT SET")
epicsEnvSet("ECMC_TSE",               -2)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/initAxis.cmd"
#==============================================================================
# initAxis.cmd
epicsEnvSet("ECMC_MOTOR_NAME",            "NOT SET")
epicsEnvSet("ECMC_R",                     "NOT SET")
epicsEnvSet("ECMC_AXIS_NO",               "NOT SET")
epicsEnvSet("ECMC_DESC",                  "NOT SET")
epicsEnvSet("ECMC_EGU",                   "NOT SET")       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "NOT SET")       # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "NOT SET")       # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "NOT SET")       # Entry for axis health output (example: ec0.s1.BO_1.0)
epicsEnvSet("ECMC_ENC_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_ENC_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_ENC_BITS",              "NOT SET")
epicsEnvSet("ECMC_ENC_TYPE",              "NOT SET")       # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "NOT SET")       # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_ENC_ABS_BITS",          "NOT SET")       # Absolute bit count (for absolute encoders) always least significant part
epicsEnvSet("ECMC_ENC_ABS_OFFSET",        "NOT SET")       # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_LATCHPOS",       "")              # Ethercat entry for latch position (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_CONTROL",  "")              # Ethercat entry for latch control (only valid for home seq 11,12)
epicsEnvSet("ECMC_EC_ENC_LATCH_STATUS",   "")              # Ethercat entry for latch status (only valid for home seq 11,12)
epicsEnvSet("ECMC_DRV_SCALE_NUM",         "NOT SET")
epicsEnvSet("ECMC_DRV_SCALE_DENOM",       "NOT SET")
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "NOT SET")       # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "NOT SET")       # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "NOT SET")       # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "NOT SET")       # Ethercat entry for brake output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "NOT SET")       # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "NOT SET")  # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_VELO",                  "NOT SET")
epicsEnvSet("ECMC_JOG_VEL",               "NOT SET")
epicsEnvSet("ECMC_JAR",                   "NOT SET")       # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "NOT SET")
epicsEnvSet("ECMC_EMERG_DECEL",           "NOT SET")       # Emergency deceleration
epicsEnvSet("ECMC_HOME_PROC",              "NOT SET")
epicsEnvSet("ECMC_HOME_POS",               "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_TO",            "NOT SET")
epicsEnvSet("ECMC_HOME_VEL_FRM",           "NOT SET")
epicsEnvSet("ECMC_HOME_ACC",               "NOT SET")
epicsEnvSet("ECMC_HOME_DEC",               "NOT SET")
epicsEnvSet("ECMC_HOME_LATCH_COUNT_OFFSET","0")
epicsEnvSet("ECMC_CNTRL_KP",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KI",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KD",              "NOT SET")
epicsEnvSet("ECMC_CNTRL_KFF",             "NOT SET")
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "NOT SET")       #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "NOT SET")       #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "NOT SET")       #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "NOT SET")       #  Ethercat entry for external interlock input
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "NOT SET")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "NOT SET")
epicsEnvSet("ECMC_DXLM_ENABLE",           "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "NOT SET")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",    "NOT SET")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX",          "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "NOT SET")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "NOT SET")
epicsEnvSet("ECMC_EGU",               "mm")
epicsEnvSet("ECMC_PREC",              3)
epicsEnvSet("ECMC_AXISFIELDINIT",     "")                  # Extra field init to motor record
epicsEnvSet("ECMC_AXISCONFIG",        "")                  # Extra parameters to driver
############################################################
############# ASYN Configuration:
epicsEnvSet("ECMC_MOTOR_PORT"     "MCU1")
epicsEnvSet("ECMC_ASYN_PORT"      "MC_CPU1")
epicsEnvSet("ECMC_PREFIX"         "IOC_TEST:")
ecmcAsynPortDriverConfigure(MC_CPU1,1000,0,0,100)
ecmcAsynPortDriverConfigure: portName = MC_CPU1, paramTableSize = 1000, disableAutoConnect = 0, priority = 0, defaultSampleRateMS = 100.000000
asynOctetSetOutputEos(MC_CPU1, -1, ";\n")
asynOctetSetInputEos(MC_CPU1, -1, ";\n")
asynSetTraceMask(MC_CPU1, -1, 0x41)
asynSetTraceIOMask(MC_CPU1, -1, 6)
asynSetTraceInfoMask(MC_CPU1, -1, 1)
ecmcMotorRecordCreateController(MCU1, MC_CPU1, "64", 200, 1000, "")
############################################################
############# Misc settings:
# Disable function call trace printouts
ecmcConfigOrDie "Cfg.SetEnableFuncCallDiag(0)"
2022/02/09 16:57:15.468 
ECMC Initializes.............
2022/02/09 16:57:15.468 ESS Open Source EtherCAT Motion Control Epics Module2022/02/09 16:57:15.468 
Mode: Configuration
2022/02/09 16:57:15.468 OK
# Disable on change printouts from objects (enable for easy logging)
ecmcConfigOrDie "Cfg.SetTraceMaskBit(15,0)"
2022/02/09 16:57:15.468 OK
# Choose to generate EPICS-records for EtherCAT-entries
# (For records use ECMC_GEN_EC_RECORDS="-records" otherwise ECMC_GEN_EC_RECORDS="")
epicsEnvSet("ECMC_GEN_EC_RECORDS",          "-records")
# Choose to generate EPICS-records for ax-entries (PosAct, SetPos,..)
# (For records use ECMC_GEN_AX_RECORDS="-records" otherwise ECMC_GEN_AX_RECORDS="")
epicsEnvSet("ECMC_GEN_AX_RECORDS",          "-records")
# suffix for pva enabled scripts, templates and substitutions
ecmcEpicsEnvSetCalcTernary(ECMC_PVA, "0", "Pva","")
# Set EtherCAT frequency (defaults to 1000)
ecmcConfigOrDie "Cfg.SetSampleRate(1000)"
2022/02/09 16:57:15.469 OK
epicsEnvSet("ECMC_EC_SAMPLE_RATE" ,   1000)
ecmcEpicsEnvSetCalc("ECMC_EC_SAMPLE_RATE_MS" ,1000/1000)
# Update records in 10ms (100Hz) for FULL MODE and in EC_RATE for DAQ mode
ecmcEpicsEnvSetCalcTernary(ECMC_SAMPLE_RATE_MS, "'FULL'=='DAQ'","1","10")
epicsEnvSet("ECMC_P_SCRIPT",        "mXsXXX")
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd",1)
 iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addMaster.cmd", "MASTER_ID=0"
#===============================================================================
# addMaster.cfg
epicsEnvSet("ECMC_EC_MASTER_ID"          "0")
# Claim master
ecmcConfigOrDie "Cfg.EcSetMaster(0)"
2022/02/09 16:57:15.472 OK
epicsEnvSet("ECMC_EC_MASTER_ID" ,0)
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
epicsEnvSet("ECMC_TMP_DIR",         "/tmp/IOC_TEST/EcMaster_0/")
system "mkdir -p /tmp/IOC_TEST/EcMaster_0/"
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setDiagnostics.cmd
#==============================================================================
# setDiagnostics.cmd
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:57:15.488 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:57:15.488 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:57:15.488 OK
epicsEnvSet("ECMCCFG_INIT" ,"#")
##############################################################################
## Configure hardware:
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcMCU1025.cmd
############################################################
############# MCU1025:
#Configure EK1100 coupler terminal
epicsEnvSet(ECMC_EC_SLAVE_NUM,0)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=0, HW_DESC=EK1100"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "0")
epicsEnvSet("HW_DESC",            "EK1100")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEK1100.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EK1100")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x044c2c52")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,0,0x2,0x044c2c52)"
2022/02/09 16:57:15.496 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddSlave(0,0,0x2,0x044c2c52)"
2022/02/09 16:57:15.498 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "0","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s000")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s000-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEK1100.substitutions,ECMC_P=IOC_TEST:m0s000-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEK1100.substitutions,1,1)
dbLoadTemplate(ecmcEK1100.substitutions,"ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s000-,ECMC_G=IOC_TEST:m0s000,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=0,HWTYPE=EK1100,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "0+1","%d")
#Configure EL1018 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "0+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=1, HW_DESC=EL1018"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "1")
epicsEnvSet("HW_DESC",            "EL1018")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1018.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1018")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x03fa3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,1,0x2,0x03fa3052)"
2022/02/09 16:57:15.518 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a02,0x6020,0x1,B1,binaryInput03)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a03,0x6030,0x1,B1,binaryInput04)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a04,0x6040,0x1,B1,binaryInput05)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a05,0x6050,0x1,B1,binaryInput06)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a06,0x6060,0x1,B1,binaryInput07)"
2022/02/09 16:57:15.521 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(1,0x2,0x03fa3052,2,0,0x1a07,0x6070,0x1,B1,binaryInput08)"
2022/02/09 16:57:15.521 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "1","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s001")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s001-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1018.substitutions,ECMC_P=IOC_TEST:m0s001-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1018.substitutions,1,1)
dbLoadTemplate(ecmcEL1018.substitutions,"ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s001-,ECMC_G=IOC_TEST:m0s001,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=1,HWTYPE=EL1018,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "1+1","%d")
#Configure EL2808 digital output terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "1+1")
epicsEnvShow("ECMC_EC_SLAVE_NUM")
ECMC_EC_SLAVE_NUM=2
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=2, HW_DESC=EL2808"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "2")
epicsEnvSet("HW_DESC",            "EL2808")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL2808.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL2808")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x0af83052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,2,0x2,0x0af83052)"
2022/02/09 16:57:15.532 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX2008.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1600,0x7000,0x1,B1,binaryOutput01)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1601,0x7010,0x1,B1,binaryOutput02)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1602,0x7020,0x1,B1,binaryOutput03)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1603,0x7030,0x1,B1,binaryOutput04)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1604,0x7040,0x1,B1,binaryOutput05)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1605,0x7050,0x1,B1,binaryOutput06)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1606,0x7060,0x1,B1,binaryOutput07)"
2022/02/09 16:57:15.535 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(2,0x2,0x0af83052,1,0,0x1607,0x7070,0x1,B1,binaryOutput08)"
2022/02/09 16:57:15.535 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "2","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s002")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s002-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL2808.substitutions,ECMC_P=IOC_TEST:m0s002-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL2808.substitutions,1,1)
dbLoadTemplate(ecmcEL2808.substitutions,"ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s002-,ECMC_G=IOC_TEST:m0s002,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=2,HWTYPE=EL2808,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "2+1","%d")
# Save the slave number for later
epicsEnvSet("ECMC_EC_SLAVE_NUM_DIG_OUT", "2")
#Configure EL5002 2-channel SSI encoder terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "2+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=3, HW_DESC=EL5002"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "3")
epicsEnvSet("HW_DESC",            "EL5002")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL5002")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x138a3052")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,3,0x2,0x138a3052)"
2022/02/09 16:57:15.552 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(3,0x1011,0x1,1684107116,4)"
2022/02/09 16:57:15.577 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(3,0x100a,0x0,2)"
2022/02/09 16:57:15.585 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x1,16,encoderStatus01)"
2022/02/09 16:57:15.585 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a00,0x6000,0x11,32,positionActual01)"
2022/02/09 16:57:15.585 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x1,16,encoderStatus02)"
2022/02/09 16:57:15.585 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(3,0x2,0x138a3052,2,3,0x1a01,0x6010,0x11,32,positionActual02)"
2022/02/09 16:57:15.585 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "3","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s003")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s003-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL5002.substitutions,ECMC_P=IOC_TEST:m0s003-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL5002.substitutions,1,1)
dbLoadTemplate(ecmcEL5002.substitutions,"ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s003-,ECMC_G=IOC_TEST:m0s003,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=3,HWTYPE=EL5002,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "3+1","%d")
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch1-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch1-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8000")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x1,0,1)"
2022/02/09 16:57:15.601 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x2,0,1)"
2022/02/09 16:57:15.601 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x3,0,1)"
2022/02/09 16:57:15.601 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x4,0,1)"
2022/02/09 16:57:15.602 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x6,1,1)"
2022/02/09 16:57:15.602 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x9,3,1)"
2022/02/09 16:57:15.602 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0xF,2,1)"
2022/02/09 16:57:15.603 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x11,27,2)"
2022/02/09 16:57:15.603 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8000,0x12,25,2)"
2022/02/09 16:57:15.603 OK
#Configure Baumer encoder for EL5002 2-channel SSI encoder terminal (Channel 2)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySlaveConfig.cmd "CONFIG=-Encoder-ch2-Baumer-BMMH30D1G24C1213P55"
#===============================================================================
# applySlaveConfig.cmd
# Arguments: CONFIG _or_ LOCAL_CONFIG
epicsEnvSet("ECMC_CONFIG_FN", "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-ch2-Baumer-BMMH30D1G24C1213P55.cmd
epicsEnvSet("ECMC_EC_SDO_INDEX"               "0x8010")     # CH1=0x8000. CH2=0x8010
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL5002-Encoder-Baumer-BMMH30D1G24C1213P55.cmd
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x1,0,1)"
2022/02/09 16:57:15.607 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x2,0,1)"
2022/02/09 16:57:15.607 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x3,0,1)"
2022/02/09 16:57:15.607 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x4,0,1)"
2022/02/09 16:57:15.608 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x6,1,1)"
2022/02/09 16:57:15.608 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x9,3,1)"
2022/02/09 16:57:15.608 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0xF,2,1)"
2022/02/09 16:57:15.608 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x11,27,2)"
2022/02/09 16:57:15.608 OK
ecmcConfigOrDie "Cfg.EcAddSdo(3,0x8010,0x12,25,2)"
2022/02/09 16:57:15.608 OK
# Configure EL9505 Power supply terminal 5V
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "3+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=4, HW_DESC=EL9505"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "4")
epicsEnvSet("HW_DESC",            "EL9505")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9505.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9505")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x25213052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,4,0x2,0x25213052)"
2022/02/09 16:57:15.611 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x1,1,powerOk01)"
2022/02/09 16:57:15.611 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(4,0x2,0x25213052,2,0,0x1a00,0x6000,0x2,1,overload01)"
2022/02/09 16:57:15.611 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "4","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s004")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s004-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9505.substitutions,ECMC_P=IOC_TEST:m0s004-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9505.substitutions,1,1)
dbLoadTemplate(ecmcEL9505.substitutions,"ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s004-,ECMC_G=IOC_TEST:m0s004,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=4,HWTYPE=EL9505,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "4+1","%d")
# Configure EL1252 digital input terminal
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "4+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=5, HW_DESC=EL1252"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "5")
epicsEnvSet("HW_DESC",            "EL1252")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL1252.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL1252")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x04e43052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,5,0x2,0x04e43052)"
2022/02/09 16:57:15.621 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX1002.cmd
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a00,0x6000,0x1,B1,binaryInput01)"
2022/02/09 16:57:15.624 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,0,0x1a01,0x6010,0x1,B1,binaryInput02)"
2022/02/09 16:57:15.624 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xae,U8,status01)"
2022/02/09 16:57:15.625 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xaf,U8,status02)"
2022/02/09 16:57:15.625 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb0,U64,timestampLatchPositive01)"
2022/02/09 16:57:15.625 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xb8,U64,timestampLatchNegative01)"
2022/02/09 16:57:15.625 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc0,U64,timestampLatchPositive02)"
2022/02/09 16:57:15.625 OK
ecmcConfigOrDie "Cfg.EcAddEntryDT(5,0x2,0x04e43052,2,1,0x1a13,0x1d09,0xc8,U64,timestampLatchNegative02)"
2022/02/09 16:57:15.625 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "5","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s005")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s005-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL1252.substitutions,ECMC_P=IOC_TEST:m0s005-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL1252.substitutions,1,1)
dbLoadTemplate(ecmcEL1252.substitutions,"ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s005-,ECMC_G=IOC_TEST:m0s005,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=5,HWTYPE=EL1252,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "5+1","%d")
# Configure EL9410 Power supply with refresh of E-Bus.
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "5+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd, "SLAVE_ID=6, HW_DESC=EL9410"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "6")
epicsEnvSet("HW_DESC",            "EL9410")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL9410.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL9410")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x24c23052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,6,0x2,0x24c23052)"
2022/02/09 16:57:15.641 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "0>0", "","#- ")
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a00,0x6000,0x1,1,underVoltageEbus01)"
2022/02/09 16:57:15.642 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(6,0x2,0x24c23052,2,0,0x1a01,0x6000,0x1,1,underVoltagePower01)"
2022/02/09 16:57:15.642 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "6","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s006")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s006-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL9410.substitutions,ECMC_P=IOC_TEST:m0s006-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL9410.substitutions,1,1)
dbLoadTemplate(ecmcEL9410.substitutions,"ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s006-,ECMC_G=IOC_TEST:m0s006,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=6,HWTYPE=EL9410,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "6+1","%d")
#Configure EL7037 stepper drive terminal, motor 1
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "6+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=7, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B, CFG_MACROS='I_RUN_MA=900,I_STDBY_MA=200'"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=7, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "7")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,7,0x2,0x1b7d3052)"
2022/02/09 16:57:15.654 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(7,0x1011,0x1,1684107116,4)"
2022/02/09 16:57:15.713 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(7,0x100a,0x0,2)"
2022/02/09 16:57:15.721 12848
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "12848", "0x%04x")
# Firmware version: 0x3230
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(7,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:57:15.723 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x5,1,1)"
2022/02/09 16:57:15.724 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0xA,1,1)"
2022/02/09 16:57:15.724 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x8,1,1)"
2022/02/09 16:57:15.724 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8012,0x9,0,1)"
2022/02/09 16:57:15.724 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "7","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s007")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s007-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s007-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s007-,ECMC_G=IOC_TEST:m0s007,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=7,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "7+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd "I_RUN_MA=900,I_STDBY_MA=200"
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,900)
epicsEnvSet(I_STDBY_MA_LOCAL,200)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=900,I_STDBY_MA=200,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "900>1500 or 900<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (900)...")
# Result: 
# Run current setting OK (900)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>1500 or 200<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (200)...")
# Result: 
# Standby current setting OK (200)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "200>900", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (200<900)...")
# Result: 
# Standby current and run current setting OK (200<900)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x1,900,2)"
2022/02/09 16:57:15.740 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x2,200,2)"
2022/02/09 16:57:15.740 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x3,2400,2)"
2022/02/09 16:57:15.740 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x4,175,2)"
2022/02/09 16:57:15.740 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0x6,200,2)"
2022/02/09 16:57:15.740 OK
ecmcConfigOrDie "Cfg.EcAddSdo(7,0x8010,0xA,330,2)"
2022/02/09 16:57:15.740 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Configure EL7037 stepper drive terminal, motor 2
ecmcEpicsEnvSetCalc(ECMC_EC_SLAVE_NUM, "7+1")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureSlave.cmd, "SLAVE_ID=8, HW_DESC=EL7037, CONFIG=-Motor-Nanotec-ST4118L1804-B"
#==============================================================================
# configureSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addSlave.cmd "SLAVE_ID=8, HW_DESC=EL7037, NELM=1"
#==============================================================================
# addSlave.cmd
epicsEnvSet("ECMC_EC_SLAVE_NUM",  "8")
epicsEnvSet("HW_DESC",            "EL7037")
epicsEnvSet("P_SCRIPT",           "mXsXXX")
# add ${HW_DESC} to the bus at position ${SLAVE_ID}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037.cmd" "NELM=1"
epicsEnvSet("ECMC_EC_HWTYPE"             "EL7037")
epicsEnvSet("ECMC_EC_VENDOR_ID"          "0x2")
epicsEnvSet("ECMC_EC_PRODUCT_ID"         "0x1b7d3052")
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/slaveVerify.cmd "RESET=true"
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_VERIFY, "0==0", "","#- ")
ecmcConfigOrDie "Cfg.EcSlaveVerify(0,8,0x2,0x1b7d3052)"
2022/02/09 16:57:15.743 OK
ecmcEpicsEnvSetCalcTernary(ECMC_SLAVE_RESET, "true>0", "","#- ")
ecmcConfigOrDie "Cfg.EcWriteSdo(8,0x1011,0x1,1684107116,4)"
2022/02/09 16:57:15.801 OK
epicsEnvSet(ECMC_EC_SLAVE_FW, "0x0000")
ecmcConfig "EcReadSdo(8,0x100a,0x0,2)"
2022/02/09 16:57:15.809 13360
ecmcEpicsEnvSetCalc("ECMC_EC_SLAVE_FW", "13360", "0x%04x")
# Firmware version: 0x3430
epicsEnvUnset(ECMC_SLAVE_VERIFY)
epicsEnvUnset(ECMC_COMMENT)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEX70XX.cmd
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x01,16,encoderControl01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1600,0x7000,0x11,16,encoderValue01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1602,0x7010,0x1,16,driveControl01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,1,2,0x1604,0x7010,0x21,16,1,velocitySetpoint01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x0,16,encoderStatus01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x11,16,positionActual01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a00,0x6000,0x12,16,encoderLatchPostion01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddEntryComplete(8,0x2,0x1b7d3052,2,3,0x1a03,0x6010,0x1,16,driveStatus01)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x5,1,1)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0xA,1,1)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x8,1,1)"
2022/02/09 16:57:15.809 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8012,0x9,0,1)"
2022/02/09 16:57:15.809 OK
# deduce what the prefix should be
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd",1)
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcmXsXXX.cmd" "MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037"
#==============================================================================
# ecmcmXsXXX.cmd
ecmcEpicsEnvSetCalc("sid", "8","%03d")
ecmcEpicsEnvSetCalc("mid", "0","%01d")
epicsEnvSet("ECMC_G",            "IOC_TEST:m0s008")
epicsEnvSet("ECMC_P",            "IOC_TEST:m0s008-")
epicsEnvUnset(sid)
epicsEnvUnset(mid)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SUBS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applySubstitutions.cmd" "SUBST_FILE=ecmcEL7037.substitutions,ECMC_P=IOC_TEST:m0s008-"
#==============================================================================
# applySubstitutions.cmd
ecmcFileExist(ecmcEL7037.substitutions,1,1)
dbLoadTemplate(ecmcEL7037.substitutions,"ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,NELM=1")
epicsEnvUnset(DEFAULT_SUBS)
ecmcEpicsEnvSetCalcTernary(DEFAULT_SLAVE_PVS, "True", "","#- ")
iocshLoad "/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/applyTemplate.cmd" "TEMPLATE_FILE=ecmcEcSlave.template,ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008"
#==============================================================================
# applyTemplate.cmd
ecmcFileExist(ecmcEcSlave.template,1,1)
dbLoadRecords("ecmcEcSlave.template", "ECMC_P=IOC_TEST:m0s008-,ECMC_G=IOC_TEST:m0s008,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,SLAVE_POS=8,HWTYPE=EL7037,T_SMP_MS=10,TSE=-2,")
epicsEnvUnset(DEFAULT_SLAVE_PVS)
# increment SLAVE_ID
ecmcEpicsEnvSetCalc("SLAVE_ID", "8+1","%d")
# apply config ${CONFIG} for ${HW_DESC}
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmcEL7037-Motor-Nanotec-ST4118L1804-B.cmd ""
epicsEnvSet(I_MAX_MA_LOCAL,"1500")
epicsEnvSet(I_RUN_MA_LOCAL,1000)
epicsEnvSet(I_STDBY_MA_LOCAL,500)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/chkValidCurrentSetOrDie.cmd "I_RUN_MA=1000,I_STDBY_MA=500,I_MAX_MA=1500"
#==============================================================================
# chkValidCurrentSetOrDie.cmd
# Ensure running current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "1000>1500 or 1000<=0", "ecmcExit Error: Run current setpoint to high or negative...","# Run current setting OK (1000)...")
# Result: 
# Run current setting OK (1000)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below max current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1500 or 500<0", "ecmcExit Error: Standby current setpoint to high or negative...","# Standby current setting OK (500)...")
# Result: 
# Standby current setting OK (500)...
epicsEnvUnset(ECMC_EXE_CMD)
# Ensure standby current is below run current otherwise exit
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "500>1000", "ecmcExit Error: Standby current higher than run current...","# Standby current and run current setting OK (500<1000)...")
# Result: 
# Standby current and run current setting OK (500<1000)...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x1,1000,2)"
2022/02/09 16:57:15.813 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x2,500,2)"
2022/02/09 16:57:15.813 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x3,2400,2)"
2022/02/09 16:57:15.813 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x4,175,2)"
2022/02/09 16:57:15.813 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0x6,200,2)"
2022/02/09 16:57:15.813 OK
ecmcConfigOrDie "Cfg.EcAddSdo(8,0x8010,0xA,330,2)"
2022/02/09 16:57:15.813 OK
epicsEnvUnset("I_RUN_MA_LOCAL")
epicsEnvUnset("I_STDBY_MA_LOCAL")
epicsEnvUnset("I_MAX_MA_LOCAL")
#Apply hardware configuration
ecmcConfigOrDie "Cfg.EcApplyConfig(1)"
2022/02/09 16:57:15.814 OK
# ADDITIONAL SETUP
# Set all outputs to feed switches
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput01,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput02,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput03,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput04,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput05,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput06,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput07,1)"
2022/02/09 16:57:15.814 OK
ecmcConfigOrDie "Cfg.WriteEcEntryIDString(2,binaryOutput08,1)"
2022/02/09 16:57:15.814 OK
# END of ADDITIONAL SETUP
##############################################################################
## AXIS 1
#
epicsEnvSet("DEV",      "IOC_TEST")
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/configureAxis.cmd, CONFIG=./cfg/linear_1.ax)
#==============================================================================
# configureAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
ecmcFileExist("./cfg/linear_1.ax",1)
iocshLoad ./cfg/linear_1.ax ""
#General
epicsEnvSet("ECMC_MOTOR_NAME",            "Axis1")
epicsEnvSet("ECMC_R",                     "Axis1-")
epicsEnvSet("ECMC_AXIS_NO",               "1")
epicsEnvSet("ECMC_DESC",                  "MCU1025 Lower Axis (1)")
epicsEnvSet("ECMC_EGU",                   "mm")                       # Motor Record Unit
epicsEnvSet("ECMC_PREC",                  "3")                        # Motor Record Precision
epicsEnvSet("ECMC_AXISCONFIG",            "")                         # Extra parameters to driver
epicsEnvSet("ECMC_EC_AXIS_HEALTH",        "")                         # Entry for axis health output (example: ec0.s1.binaryOutput01.0)
epicsEnvSet("ECMC_MOD_RANGE" ,            "0")                        # Modulo range (traj setpoints and encoder values will be in range 0..ECMC_MOD_RANGE)
epicsEnvSet("ECMC_MOD_TYPE",              "0")                        # For positioning and MOD_RANGE>0: 0 = Normal, 1 = Always Fwd, 2 = Always Bwd, 3 = Closest Distance
#Encoder
epicsEnvSet("ECMC_ENC_SCALE_NUM"          "-60")
epicsEnvSet("ECMC_ENC_SCALE_DENOM"        "4096")
epicsEnvSet("ECMC_ENC_BITS"               "25")
epicsEnvSet("ECMC_ENC_TYPE"               "1")                        # Type: 0=Incremental, 1=Absolute
epicsEnvSet("ECMC_ENC_BITS"               "25")                       # Total bit count of encoder raw data
epicsEnvSet("ECMC_ENC_ABS_BITS",          "25")                       # Absolute bit count (for absolute encoders) always least significant part of ECMC_ENC_BITS
epicsEnvSet("ECMC_ENC_ABS_OFFSET"         "-100")                     # Encoder offset in eng units (for absolute encoders)
epicsEnvSet("ECMC_EC_ENC_ACTPOS",         "ec0.s3.positionActual01")         # Ethercat entry for actual position input (encoder)
epicsEnvSet("ECMC_EC_ENC_RESET",          "")                         # Reset   (if no encoder reset bit then leave empty)
epicsEnvSet("ECMC_EC_ENC_ALARM_0",        "ec0.s3.encoderStatus01.0")      # Error 0: SSI input error
epicsEnvSet("ECMC_EC_ENC_ALARM_1",        "ec0.s3.encoderStatus01.1")      # Error 1: SSI frame error
epicsEnvSet("ECMC_EC_ENC_ALARM_2",        "ec0.s3.encoderStatus01.2")      # Error 2: Encoder power fail
epicsEnvSet("ECMC_EC_ENC_WARNING",        "")                         # Warning (if no encoder warning bit then leave empty)
#Drive
epicsEnvSet("ECMC_DRV_TYPE"               "0")                        # Stepper: 0. DS402: 1 (DS402 = servos and advanced stepper drives)
epicsEnvSet("ECMC_DRV_SCALE_NUM"          "600.0")                    # Fastest speed in engineering units
epicsEnvSet("ECMC_DRV_SCALE_DENOM"        "32768.0")                  # I/O range for ECMC_EC_ALIAS_DRV_VELO_SET
epicsEnvSet("ECMC_EC_DRV_CONTROL",        "ec0.s7.driveControl01.0")     # Ethercat entry for control word or bit output
epicsEnvSet("ECMC_EC_DRV_STATUS",         "ec0.s7.driveStatus01.1")      # Ethercat entry for status word or bit input
epicsEnvSet("ECMC_EC_DRV_VELOCITY",       "ec0.s7.velocitySetpoint01") # Ethercat entry for velocity setpoint output
epicsEnvSet("ECMC_EC_DRV_REDUCE_TORQUE",  "ec0.s7.driveControl01.2")     # Ethercat entry for reduce torque output
epicsEnvSet("ECMC_EC_DRV_BRAKE",          "")                         # Ethercat entry for brake output
epicsEnvSet("ECMC_DRV_BRAKE_OPEN_DLY_TIME",    "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME", "0")                   # Brake timing parameter in cycles (default 1kHz)
epicsEnvSet("ECMC_EC_DRV_RESET",          "ec0.s7.driveControl01.1")     # Reset
epicsEnvSet("ECMC_EC_DRV_ALARM_0",        "ec0.s7.driveStatus01.3")      # Error
epicsEnvSet("ECMC_EC_DRV_ALARM_1",        "ec0.s7.driveStatus01.7")      # Stall
epicsEnvSet("ECMC_EC_DRV_ALARM_2",        "ec0.s7.driveStatus01.14")     # Sync error
epicsEnvSet("ECMC_EC_DRV_WARNING",        "ec0.s7.driveStatus01.2")      # Warning
#Trajectory
epicsEnvSet("ECMC_VELO",                  "5.0")
epicsEnvSet("ECMC_JOG_VEL",               "5")
epicsEnvSet("ECMC_JAR",                   "0.0")                      # JAR defaults to VELO/ACCL
epicsEnvSet("ECMC_ACCL",                  "0.1")
epicsEnvSet("ECMC_EMERG_DECEL",           "0.1")             # Emergency deceleration
#Homing
epicsEnvSet("ECMC_HOME_PROC",             "3")
epicsEnvSet("ECMC_HOME_POS",              "0.0")
epicsEnvSet("ECMC_HOME_VEL_TO",           "5")
epicsEnvSet("ECMC_HOME_VEL_FRM",          "4")
epicsEnvSet("ECMC_HOME_ACC",              "21")
epicsEnvSet("ECMC_HOME_DEC",              "100")
epicsEnvSet("ECMC_HOME_POS_MOVE_ENA",     "0")                        # Enable move to position after successfull homing 
epicsEnvSet("ECMC_HOME_POS_MOVE_TARG_POS","0")                        # Target position to go to after successfull homing
#Controller
epicsEnvSet("ECMC_CNTRL_KP",              "15.0")
epicsEnvSet("ECMC_CNTRL_KI",              "0.02")
epicsEnvSet("ECMC_CNTRL_KD",              "0.0")
epicsEnvSet("ECMC_CNTRL_KFF",             "1.0")
#Monitoring
# Switches
epicsEnvSet("ECMC_EC_MON_LOWLIM",         "ec0.s1.binaryInput02.0")           #  Ethercat entry for low limit switch input
epicsEnvSet("ECMC_EC_MON_HIGHLIM",        "ec0.s1.binaryInput01.0")           #  Ethercat entry for high limit switch inpuit
epicsEnvSet("ECMC_EC_MON_HOME_SWITCH",    "ec0.s1.binaryInput03.0")           #  Ethercat entry for home switch input
epicsEnvSet("ECMC_EC_MON_EXT_INTERLOCK",  "ec0.s1.ONE.0")              #  Ethercat entry for external interlock input
# Softlimits (disable with 0,0)
epicsEnvSet("ECMC_SOFT_LOW_LIM",          "-50")
epicsEnvSet("ECMC_SOFT_HIGH_LIM",         "80")
epicsEnvSet("ECMC_DXLM_ENABLE",           "1")
# Position lag
epicsEnvSet("ECMC_MON_LAG_MON_TOL",       "0.5")
epicsEnvSet("ECMC_MON_LAG_MON_TIME",      "100")
epicsEnvSet("ECMC_MON_LAG_MON_ENA",       "1")
# At target
epicsEnvSet("ECMC_MON_AT_TARGET_TOL",     "0.1")
epicsEnvSet("ECMC_MON_AT_TARGET_TIME",     "100")
epicsEnvSet("ECMC_MON_AT_TARGET_ENA",     "1")
# Velocity
epicsEnvSet("ECMC_MON_VELO_MAX",          "100.0")
epicsEnvSet("ECMC_MON_VELO_MAX_TRAJ_TIME","100")
epicsEnvSet("ECMC_MON_VELO_MAX_DRV_TIME", "200")
epicsEnvSet("ECMC_MON_VELO_MAX_ENA",      "1")
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/addAxis.cmd
#==============================================================================
# addAxis.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD, "'FULL'='DAQ'","ecmcExit Error: ECMC started in DAQ mode. Motion not supported..","#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis-records.cmd
#==============================================================================
# ecmc_axis-records.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis.cmd
#==============================================================================
# ecmc_axis.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(-60)<>0',SUCCESS_STR='ECMC_ENC_SCALE_NUM value OK == -60...',ERROR_STR='ECMC_ENC_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(-60)<>0","# ECMC_ENC_SCALE_NUM value OK == -60...", "ecmcExit Error: ECMC_ENC_SCALE_NUM == 0...")
# ECMC_ENC_SCALE_NUM value OK == -60...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(4096)<>0',SUCCESS_STR='ECMC_ENC_SCALE_DENOM value OK == 4096...',ERROR_STR='ECMC_ENC_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(4096)<>0","# ECMC_ENC_SCALE_DENOM value OK == 4096...", "ecmcExit Error: ECMC_ENC_SCALE_DENOM == 0...")
# ECMC_ENC_SCALE_DENOM value OK == 4096...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(600.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_NUM value OK == 600.0...',ERROR_STR='ECMC_DRV_SCALE_NUM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(600.0)<>0","# ECMC_DRV_SCALE_NUM value OK == 600.0...", "ecmcExit Error: ECMC_DRV_SCALE_NUM == 0...")
# ECMC_DRV_SCALE_NUM value OK == 600.0...
epicsEnvUnset(ECMC_EXE_CMD)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/verifyOrDie.cmd "EXPR_STR='abs(32768.0)<>0',SUCCESS_STR='ECMC_DRV_SCALE_DENOM value OK == 32768.0...',ERROR_STR='ECMC_DRV_SCALE_DENOM == 0...'"
#==============================================================================
# verifyOrDie.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"abs(32768.0)<>0","# ECMC_DRV_SCALE_DENOM value OK == 32768.0...", "ecmcExit Error: ECMC_DRV_SCALE_DENOM == 0...")
# ECMC_DRV_SCALE_DENOM value OK == 32768.0...
epicsEnvUnset(ECMC_EXE_CMD)
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/issueWarning.cmd "EXPR_STR='-1>0',WARNING_STR='WARNING: ECMC_MRES setting is deprecated and will not be used. (MRES will be calulated instead: ECMC_ENC_SCALE_NUM/ECMC_ENC_SCALE_DENOM).. '"
#==============================================================================
# issueWarning.cmd
ecmcEpicsEnvSetCalcTernary(ECMC_EXE_CMD,"-1>0","", "#-")
epicsEnvUnset(ECMC_EXE_CMD)
ecmcConfigOrDie "Cfg.CreateAxis(1,1,0)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.health")"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisModRange(1, 0)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisModType(1, 0)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisEmergDeceleration(1,0.1)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisVelAccDecTime(1,5.0,0.1)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelTwordsCam(1,5)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisHomeVelOffCam(1,4)"
2022/02/09 16:57:15.829 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKp(1,15.0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKi(1,0.02)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKd(1,0.0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisCntrlKff(1,1.0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.positionActual01,"ax1.enc.actpos")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleDenom(1,4096)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncScaleNum(1,-60)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncType(1,1)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncBits(1,25)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncAbsBits(1,25)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncOffset(1,-100)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncVelFilterSize(1,100)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterSize(1,1)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEncPosFilterEnable(1,0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.reset")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.0,"ax1.enc.alarm0")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.1,"ax1.enc.alarm1")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s3.encoderStatus01.2,"ax1.enc.alarm2")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.warning")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchpos")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchcontrol")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.enc.latchstatus")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.0,"ax1.drv.control")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.1,"ax1.drv.status")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.velocitySetpoint01,"ax1.drv.velocity")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.position")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(,"ax1.drv.brake")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.2,"ax1.drv.reducetorque")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveControl01.1,"ax1.drv.reset")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.3,"ax1.drv.alarm0")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.7,"ax1.drv.alarm1")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.14,"ax1.drv.alarm2")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s7.driveStatus01.2,"ax1.drv.warning")"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleDenom(1,32768.0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisDrvScaleNum(1,600.0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeOpenDelayTime(1,0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisDrvBrakeCloseAheadTime(1,0)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosBwd(1,-50)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitBwd(1,1)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisSoftLimitPosFwd(1,80)"
2022/02/09 16:57:15.830 OK
ecmcConfigOrDie "Cfg.SetAxisEnableSoftLimitFwd(1,1)"
2022/02/09 16:57:15.831 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput02.0,"ax1.mon.lowlim")"
2022/02/09 16:57:15.831 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput01.0,"ax1.mon.highlim")"
2022/02/09 16:57:15.831 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.binaryInput03.0,"ax1.mon.homesensor")"
2022/02/09 16:57:15.831 OK
ecmcConfigOrDie "Cfg.LinkEcEntryToObject(ec0.s1.ONE.0,"ax1.mon.extinterlock")"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTol(1,0.1)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonAtTargetTime(1,100)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableAtTargetMon(1,1)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTol(1,0.5)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonPosLagTime(1,100)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableLagMon(1,1)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVel(1,100.0)"
2022/02/09 16:57:15.847 OK
ecmcConfigOrDie "Cfg.SetAxisMonEnableMaxVel(1,1)"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelDriveILDelay(1,200)"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Cfg.SetAxisMonMaxVelTrajILDelay(1,100)"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Cfg.SetAxisMonHomeSwitchPolarity(1,0)"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Cfg.SetAxisHomeLatchCountOffset(1,0)"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Main.M1.fHomePosition=0.0"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveEnable(1, 0)"
2022/02/09 16:57:15.848 OK
ecmcConfigOrDie "Cfg.SetAxisHomePostMoveTargetPosition(1, 0)"
2022/02/09 16:57:15.848 OK
ecmcMotorRecordCreateAxis(MCU1, "1", "6", )
2022/02/09 16:57:15.848 ecmcMotorRecord:: setIntegerParam(1 motorPowerAutoOnOff_)=2
2022/02/09 16:57:15.848 ecmcMotorRecord:: setDoubleParam(1 motorPowerOnDelay_)=6
2022/02/09 16:57:15.848 ecmcMotorRecord:: setDoubleParam(1 motorPowerOffDelay_=-1
2022/02/09 16:57:15.848 ecmcMotorRecord:: udateMotorLimitsRO(1) enabledHighAndLow=1 valid=1 fValueHigh=80 fValueLow=-50
2022/02/09 16:57:15.848 ecmcMotorRecord:: connected(1)
2022/02/09 16:57:15.848 ecmcMotorRecord:: initialPoll(1) status=0
ecmcEpicsEnvSetCalc("ECMC_TEMP_SREV","if(abs(4096)>0){RESULT:=abs(4096);} else {RESULT:=1.0};","%d")
ecmcEpicsEnvSetCalc("ECMC_TEMP_UREV","if(abs(-60)>0){RESULT:=abs(-60);} else {RESULT:=1.0};","%lf")
ecmcFileExist(ecmcMotorRecord.template,1,1)
dbLoadRecords(ecmcMotorRecord.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1, DESC=MCU1025 Lower Axis (1), EGU=mm, PREC=3, VELO=5.0, JVEL=5, JAR=0.0, ACCL=0.1, RDBD=0.1, DLLM=-50, DHLM=80, HOMEPROC=3,SREV=4096,UREV=60.000000, ")
epicsEnvSet("ECMC_AXISFIELDINIT",  "")
ecmcFileExist(ecmcMotorRecordhome.template,1,1)
dbLoadRecords(ecmcMotorRecordhome.template, "PREFIX=IOC_TEST:, MOTOR_NAME=Axis1, MOTOR_PORT=MCU1, AXIS_NO=1,HOMEPROC=3, HOMEPOS=0.0, HVELTO=5, HVELFRM=4, HOMEACC=21, HOMEDEC=100")
epicsEnvUnset(ECMC_TEMP_SREV)
epicsEnvUnset(ECMC_TEMP_UREV)
ecmcFileExist("ecmcAxis.db",1,1)
dbLoadRecords("ecmcAxis.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_NO=1,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2")
ecmcFileExist("ecmcAxisType.db",1,1)
dbLoadRecords("ecmcAxisType.db","P=IOC_TEST:,AXIS_NAME=Axis1,AXIS_TYPE=1")
ecmcFileExist(/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd,1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/ecmc_axis_unset.cmd
#==============================================================================
# ecmc_axis_unset.cmd
epicsEnvUnset(ECMC_AXISCONFIG)
epicsEnvUnset(ECMC_AXISFIELDINIT)
epicsEnvUnset(ECMC_PREC)
epicsEnvUnset(ECMC_EGU)
epicsEnvUnset(ECMC_DESC)
epicsEnvUnset(ECMC_R)
epicsEnvUnset(ECMC_MOTOR_NAME)
epicsEnvUnset(ECMC_EC_AXIS_HEALTH)
epicsEnvUnset(ECMC_MOD_RANGE)
epicsEnvUnset(ECMC_MOD_TYPE)
epicsEnvUnset(ECMC_EMERG_DECEL)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_ACCL)
epicsEnvUnset(ECMC_HOME_VEL_TO)
epicsEnvUnset(ECMC_HOME_VEL_FRM)
epicsEnvUnset(ECMC_CNTRL_KP)
epicsEnvUnset(ECMC_CNTRL_KI)
epicsEnvUnset(ECMC_CNTRL_KD)
epicsEnvUnset(ECMC_CNTRL_KFF)
epicsEnvUnset(ECMC_EC_ENC_ACTPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCHPOS)
epicsEnvUnset(ECMC_EC_ENC_LATCH_CONTROL)
epicsEnvUnset(ECMC_EC_ENC_LATCH_STATUS)
epicsEnvUnset(ECMC_HOME_LATCH_COUNT_OFFSET)
epicsEnvUnset(ECMC_ENC_SCALE_DENOM)
epicsEnvUnset(ECMC_ENC_SCALE_NUM)
epicsEnvUnset(ECMC_ENC_TYPE)
epicsEnvUnset(ECMC_ENC_BITS)
epicsEnvUnset(ECMC_ENC_ABS_BITS)
epicsEnvUnset(ECMC_ENC_ABS_OFFSET)
epicsEnvUnset(ECMC_ENC_VEL_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_SIZE)
epicsEnvUnset(ECMC_ENC_POS_FILTER_ENABLE)
epicsEnvUnset(ECMC_EC_ENC_RESET)
epicsEnvUnset(ECMC_EC_ENC_ALARM_0)
epicsEnvUnset(ECMC_EC_ENC_ALARM_1)
epicsEnvUnset(ECMC_EC_ENC_ALARM_2)
epicsEnvUnset(ECMC_EC_ENC_WARNING)
epicsEnvUnset(ECMC_EC_DRV_CONTROL)
epicsEnvUnset(ECMC_EC_DRV_STATUS)
epicsEnvUnset(ECMC_EC_DRV_VELOCITY)
epicsEnvUnset(ECMC_EC_DRV_BRAKE)
epicsEnvUnset(ECMC_EC_DRV_REDUCE_TORQUE)
epicsEnvUnset(ECMC_EC_DRV_RESET)
epicsEnvUnset(ECMC_EC_DRV_ALARM_0)
epicsEnvUnset(ECMC_EC_DRV_ALARM_1)
epicsEnvUnset(ECMC_EC_DRV_ALARM_2)
epicsEnvUnset(ECMC_EC_DRV_WARNING)
epicsEnvUnset(ECMC_DRV_SCALE_DENOM)
epicsEnvUnset(ECMC_DRV_SCALE_NUM)
epicsEnvUnset(ECMC_DRV_BRAKE_OPEN_DLY_TIME)
epicsEnvUnset(ECMC_DRV_BRAKE_CLOSE_AHEAD_TIME)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_DXLM_ENABLE)
epicsEnvUnset(ECMC_EC_MON_LOWLIM)
epicsEnvUnset(ECMC_EC_MON_HIGHLIM)
epicsEnvUnset(ECMC_EC_MON_HOME_SWITCH)
epicsEnvUnset(ECMC_EC_MON_EXT_INTERLOCK)
epicsEnvUnset(ECMC_MON_AT_TARGET_TOL)
epicsEnvUnset(ECMC_MON_AT_TARGET_TIME)
epicsEnvUnset(ECMC_MON_AT_TARGET_ENA)
epicsEnvUnset(ECMC_MON_LAG_MON_TOL)
epicsEnvUnset(ECMC_MON_LAG_MON_TIME)
epicsEnvUnset(ECMC_MON_LAG_MON_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX)
epicsEnvUnset(ECMC_MON_VELO_MAX_ENA)
epicsEnvUnset(ECMC_MON_VELO_MAX_DRV_TIME)
epicsEnvUnset(ECMC_MON_VELO_MAX_TRAJ_TIME)
epicsEnvUnset(ECMC_JOG_VEL)
epicsEnvUnset(ECMC_JAR)
epicsEnvUnset(ECMC_HOME_PROC)
epicsEnvUnset(ECMC_HOME_POS)
epicsEnvUnset(ECMC_HOME_ACC)
epicsEnvUnset(ECMC_HOME_DEC)
epicsEnvUnset(ECMC_DRV_TYPE)
epicsEnvUnset(ECMC_VELO)
epicsEnvUnset(ECMC_SOFT_LOW_LIM)
epicsEnvUnset(ECMC_SOFT_HIGH_LIM)
epicsEnvUnset(ECMC_HOME_POS_MOVE_ENA)
epicsEnvUnset(ECMC_HOME_POS_MOVE_TARG_POS)
epicsEnvSet("ECMC_PREFIX"      "IOC_TEST:")
2022/02/09 16:57:15.868 ecmcMotorRecord:: poll(1) mvnNRdy=1 bBusy=0 bExecute=0 bEnabled=0 atTarget=0 wf=0 ENC=0 fPos=0 fActPosition=0 time=0.000013
2022/02/09 16:57:15.868 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:57:15.868 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=4 old=-1 ErrID=0x0 old=0x0 Warn=0 nCmd=0 old=0 txt=NULL
##############################################################################
## AXIS 2
#
#epicsEnvSet("DEV",      "$(IOC)")
#$(SCRIPTEXEC) ($(ecmccfg_DIR)configureAxis.cmd, CONFIG=./cfg/linear_2.ax)
##############################################################################
############# Configure diagnostics:
ecmcConfigOrDie "Cfg.EcSetDiagnostics(1)"
2022/02/09 16:57:15.868 OK
ecmcConfigOrDie "Cfg.EcEnablePrintouts(0)"
2022/02/09 16:57:15.868 OK
ecmcConfigOrDie "Cfg.EcSetDomainFailedCyclesLimit(100)"
2022/02/09 16:57:15.868 OK
ecmcConfigOrDie "Cfg.SetDiagAxisIndex(1)"
2022/02/09 16:57:15.868 OK
ecmcConfigOrDie "Cfg.SetDiagAxisFreq(2)"
2022/02/09 16:57:15.868 OK
ecmcConfigOrDie "Cfg.SetDiagAxisEnable(0)"
2022/02/09 16:57:15.868 OK
# go active
iocshLoad (/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/setAppMode.cmd)
#==============================================================================
# setAppMode.cmd
ecmcFileExist("/epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd",1)
iocshLoad /epics/base-7.0.5/require/3.4.1/siteMods/ecmccfg/7.0.1+0/general.cmd
#==============================================================================
# general.cmd
ecmcFileExist("ecmcGeneral.db",1,1)
dbLoadRecords("ecmcGeneral.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,T_SMP_MS=10,TSE=-2,ECMC_PROC_HOOK=")
# Examples of commands for info:
# ecmcReport <level> or asynReport <level>
# ecmcReport 3
# ecmcGrepParam <pattern>
# List all ecmc params for ethercat slave 2:
# ecmcGrepParam *s2*
#
ecmcEpicsEnvSetCalcTernary(ECMC_MASTER_CMD, "0>=0", "","#- ")
 ecmcFileExist("ecmcEc.db",1,1)
 dbLoadRecords("ecmcEc.db","P=IOC_TEST:,PORT=MC_CPU1,ADDR=0,TIMEOUT=1,MASTER_ID=0,T_SMP_MS=10,TSE=-2")
ecmcConfigOrDie "Cfg.SetAppMode(1)"
2022/02/09 16:57:15.878 INFO: Locking memory
2022/02/09 16:57:15.891 Starting up EtherCAT bus: 0 second(s). Max wait time 30 second(s).
2022/02/09 16:57:15.979 ../devEcmcSup/motion/ecmcMonitor.cpp/checkLimits:501: ERROR_MON_BOTH_LIMIT_INTERLOCK (0x14c10).
2022/02/09 16:57:15.979 ../devEcmcSup/motion/ecmcAxisReal.cpp/execute:198: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 0: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 1: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 2: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 3: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 4: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 5: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 6: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 7: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:374: ERROR: Slave 8: Not operational (0x24011).
2022/02/09 16:57:15.979 ../devEcmcSup/ethercat/ecmcEcSlave.cpp/checkConfigState:379: ERROR_EC_SLAVE_NOT_OPERATIONAL (0x24011).
2022/02/09 16:57:16.068 ecmcMotorRecord:: poll(1) homed=1
2022/02/09 16:57:16.068 ecmcMotorRecord:: poll(1) mvnNRdy=0 bBusy=0 bExecute=0 bEnabled=0 atTarget=1 wf=0 ENC=0 fPos=0 fActPosition=-100 time=0.000026
2022/02/09 16:57:16.068 ecmcMotorRecord:: poll(1) bError=1 drvlocal.statusBinData.onChangeData.error=0x14315
2022/02/09 16:57:16.068 ecmcMotorRecord:: sErrorMessage(1)="ERROR_AXIS_HARDWARE_STATUS_NOT_OK"
2022/02/09 16:57:16.068 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=1 old=4 ErrID=0x14315 old=0x0 Warn=0 nCmd=0 old=0 txt=E: ERROR_AXIS_HARDWARE_STATUS_NOT_OK (0x14315)
2022/02/09 16:57:16.584 ../devEcmcSup/motion/ecmcDriveBase.cpp/readEntries:369: WARNING (axis 1): Drive hardware in warning state.
2022/02/09 16:57:16.891 Starting up EtherCAT bus: 1 second(s). Max wait time 30 second(s).
2022/02/09 16:57:16.982 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:57:16.982 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:57:16.982 ../devEcmcSup/main/ecmcError.cpp/errorReset:103: NO_ERROR (0x0).
2022/02/09 16:57:17.068 ecmcMotorRecord:: poll(1) LLS=0
2022/02/09 16:57:17.068 ecmcMotorRecord:: poll(1) HLS=0
2022/02/09 16:57:17.068 ecmcMotorRecord:: poll(1) bError=0 drvlocal.statusBinData.onChangeData.error=0x0
2022/02/09 16:57:17.068 ecmcMotorRecord:: poll(1) callParamCallbacksUpdateError Error=0 old=1 ErrID=0x0 old=0x14315 Warn=0 nCmd=0 old=0 txt=NULL
2022/02/09 16:57:18.891 EtherCAT bus started!
2022/02/09 16:57:18.891 OK
# Set the IOC Prompt String One 
epicsEnvSet IOCSH_PS1 "mcag-dev-asm-02-30465 > "
#
# 
iocInit
2022/02/09 16:57:18.892 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocBuild (0). Allow callbacks: true.
Starting iocInit
2022/02/09 16:57:18.892 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtBeginning (1). Allow callbacks: true.
############################################################################
## EPICS R7.0.5-E3-7.0.5-patch
## Rev. 2021-03-19T22:08+0100
############################################################################
2022/02/09 16:57:18.894 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCallbackInit (2). Allow callbacks: true.
2022/02/09 16:57:18.896 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaLinkInit (3). Allow callbacks: true.
2022/02/09 16:57:18.896 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDrvSup (4). Allow callbacks: true.
2022/02/09 16:57:18.896 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitRecSup (5). Allow callbacks: true.
2022/02/09 16:57:18.896 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDevSup (6). Allow callbacks: true.
2022/02/09 16:57:18.897 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput01 linked to record (asyn reason 1).
2022/02/09 16:57:18.897 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput02 linked to record (asyn reason 2).
2022/02/09 16:57:18.897 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput03 linked to record (asyn reason 3).
2022/02/09 16:57:18.897 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput04 linked to record (asyn reason 4).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput05 linked to record (asyn reason 5).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput06 linked to record (asyn reason 6).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput07 linked to record (asyn reason 7).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.binaryOutput08 linked to record (asyn reason 8).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.reset linked to record (asyn reason 9).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveControl01 linked to record (asyn reason 10).
2022/02/09 16:57:18.898 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.velocitySetpoint01 linked to record (asyn reason 11).
2022/02/09 16:57:18.899 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderControl01 linked to record (asyn reason 12).
2022/02/09 16:57:18.899 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderValue01 linked to record (asyn reason 13).
2022/02/09 16:57:18.899 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveControl01 linked to record (asyn reason 14).
2022/02/09 16:57:18.899 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.velocitySetpoint01 linked to record (asyn reason 15).
2022/02/09 16:57:18.899 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderControl01 linked to record (asyn reason 16).
2022/02/09 16:57:18.899 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderValue01 linked to record (asyn reason 17).
2022/02/09 16:57:18.900 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus01 linked to record (asyn reason 18).
2022/02/09 16:57:18.900 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.encoderStatus02 linked to record (asyn reason 19).
2022/02/09 16:57:18.900 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status01 linked to record (asyn reason 20).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.status02 linked to record (asyn reason 21).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.driveStatus01 linked to record (asyn reason 22).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderStatus01 linked to record (asyn reason 23).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.driveStatus01 linked to record (asyn reason 24).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderStatus01 linked to record (asyn reason 25).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.diagnostic linked to record (asyn reason 26).
2022/02/09 16:57:18.901 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.plc.expression linked to record (asyn reason 27).
2022/02/09 16:57:18.902 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.msg linked to record (asyn reason 28).
2022/02/09 16:57:18.902 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.updated linked to record (asyn reason 29).
2022/02/09 16:57:18.902 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.slavestatus linked to record (asyn reason 30).
2022/02/09 16:57:18.902 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.slavestatus linked to record (asyn reason 31).
2022/02/09 16:57:18.902 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.slavestatus linked to record (asyn reason 32).
2022/02/09 16:57:18.903 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.slavestatus linked to record (asyn reason 33).
2022/02/09 16:57:18.903 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.slavestatus linked to record (asyn reason 34).
2022/02/09 16:57:18.903 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.slavestatus linked to record (asyn reason 35).
2022/02/09 16:57:18.903 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.slavestatus linked to record (asyn reason 36).
2022/02/09 16:57:18.903 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.slavestatus linked to record (asyn reason 37).
2022/02/09 16:57:18.903 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.slavestatus linked to record (asyn reason 38).
2022/02/09 16:57:18.904 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.status linked to record (asyn reason 39).
2022/02/09 16:57:18.904 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.masterstatus linked to record (asyn reason 40).
2022/02/09 16:57:18.904 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.slavecounter linked to record (asyn reason 41).
2022/02/09 16:57:18.905 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.memmapcounter linked to record (asyn reason 42).
2022/02/09 16:57:18.905 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainfailcountertotal linked to record (asyn reason 43).
2022/02/09 16:57:18.905 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.entrycounter linked to record (asyn reason 44).
2022/02/09 16:57:18.905 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.domainstatus linked to record (asyn reason 45).
2022/02/09 16:57:18.906 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput01 linked to record (asyn reason 46).
2022/02/09 16:57:18.907 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput02 linked to record (asyn reason 47).
2022/02/09 16:57:18.907 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput03 linked to record (asyn reason 48).
2022/02/09 16:57:18.908 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput04 linked to record (asyn reason 49).
2022/02/09 16:57:18.908 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput05 linked to record (asyn reason 50).
2022/02/09 16:57:18.909 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput06 linked to record (asyn reason 51).
2022/02/09 16:57:18.910 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput07 linked to record (asyn reason 52).
2022/02/09 16:57:18.910 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.binaryInput08 linked to record (asyn reason 53).
2022/02/09 16:57:18.911 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.powerOk01 linked to record (asyn reason 54).
2022/02/09 16:57:18.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.overload01 linked to record (asyn reason 55).
2022/02/09 16:57:18.912 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput01 linked to record (asyn reason 56).
2022/02/09 16:57:18.913 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.binaryInput02 linked to record (asyn reason 57).
2022/02/09 16:57:18.914 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltageEbus01 linked to record (asyn reason 58).
2022/02/09 16:57:18.915 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.underVoltagePower01 linked to record (asyn reason 59).
2022/02/09 16:57:18.915 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.enable linked to record (asyn reason 60).
2022/02/09 16:57:18.916 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.firstscan linked to record (asyn reason 61).
2022/02/09 16:57:18.917 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.ok linked to record (asyn reason 62).
2022/02/09 16:57:18.918 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.control linked to record (asyn reason 63).
2022/02/09 16:57:18.919 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ONE linked to record (asyn reason 64).
2022/02/09 16:57:18.920 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s0.ZERO linked to record (asyn reason 65).
2022/02/09 16:57:18.921 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ONE linked to record (asyn reason 66).
2022/02/09 16:57:18.921 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s1.ZERO linked to record (asyn reason 67).
2022/02/09 16:57:18.922 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ONE linked to record (asyn reason 68).
2022/02/09 16:57:18.923 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s2.ZERO linked to record (asyn reason 69).
2022/02/09 16:57:18.924 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ONE linked to record (asyn reason 70).
2022/02/09 16:57:18.925 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.ZERO linked to record (asyn reason 71).
2022/02/09 16:57:18.925 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ONE linked to record (asyn reason 72).
2022/02/09 16:57:18.926 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s4.ZERO linked to record (asyn reason 73).
2022/02/09 16:57:18.926 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ONE linked to record (asyn reason 74).
2022/02/09 16:57:18.927 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.ZERO linked to record (asyn reason 75).
2022/02/09 16:57:18.928 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ONE linked to record (asyn reason 76).
2022/02/09 16:57:18.929 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s6.ZERO linked to record (asyn reason 77).
2022/02/09 16:57:18.930 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ONE linked to record (asyn reason 78).
2022/02/09 16:57:18.930 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.ZERO linked to record (asyn reason 79).
2022/02/09 16:57:18.931 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ONE linked to record (asyn reason 80).
2022/02/09 16:57:18.932 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.ZERO linked to record (asyn reason 81).
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI01-TimeFallTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeRiseTS
ECATtimestamp aSubRecord: IOC_TEST:m0s005-BI02-TimeFallTS
2022/02/09 16:57:18.933 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual01 linked to record (asyn reason 82).
2022/02/09 16:57:18.934 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s3.positionActual02 linked to record (asyn reason 83).
2022/02/09 16:57:18.935 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive01 linked to record (asyn reason 84).
2022/02/09 16:57:18.935 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative01 linked to record (asyn reason 85).
2022/02/09 16:57:18.936 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchPositive02 linked to record (asyn reason 86).
2022/02/09 16:57:18.937 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s5.timestampLatchNegative02 linked to record (asyn reason 87).
2022/02/09 16:57:18.939 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.positionActual01 linked to record (asyn reason 88).
2022/02/09 16:57:18.940 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s7.encoderLatchPostion01 linked to record (asyn reason 89).
2022/02/09 16:57:18.943 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.positionActual01 linked to record (asyn reason 90).
2022/02/09 16:57:18.944 ecmcAsynPortDriver:drvUserCreate: Parameter ec0.s8.encoderLatchPostion01 linked to record (asyn reason 91).
2022/02/09 16:57:18.946 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.actpos linked to record (asyn reason 92).
2022/02/09 16:57:18.947 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.setpos linked to record (asyn reason 93).
2022/02/09 16:57:18.948 ecmcAsynPortDriver:drvUserCreate: Parameter ax1.poserr linked to record (asyn reason 94).
2022/02/09 16:57:18.949 ecmcAsynPortDriver:drvUserCreate: Parameter plcs.ax1.plc.error linked to record (asyn reason 95).
2022/02/09 16:57:18.950 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.appmode linked to record (asyn reason 96).
2022/02/09 16:57:18.951 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.error.id linked to record (asyn reason 97).
2022/02/09 16:57:18.952 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.min linked to record (asyn reason 98).
2022/02/09 16:57:18.952 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.latency.max linked to record (asyn reason 99).
2022/02/09 16:57:18.953 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.min linked to record (asyn reason 100).
2022/02/09 16:57:18.954 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.period.max linked to record (asyn reason 101).
2022/02/09 16:57:18.955 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.min linked to record (asyn reason 102).
2022/02/09 16:57:18.956 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.execute.max linked to record (asyn reason 103).
2022/02/09 16:57:18.957 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.min linked to record (asyn reason 104).
2022/02/09 16:57:18.958 ecmcAsynPortDriver:drvUserCreate: Parameter ecmc.thread.send.max linked to record (asyn reason 105).
2022/02/09 16:57:18.958 [devMotorAsyn.c:439  IOC_TEST:Axis1] init_record IOC_TEST:Axis1 position=-34.492188 encoderPos=-34.492188 velocity=0.000000 MSTAstatus=0x490a flagsValue=0x1f flagsWritten=0x1f pmr->mflg=0x0
2022/02/09 16:57:18.958 [devMotorAsyn.c:185  IOC_TEST:Axis1] init_controller IOC_TEST:Axis1 set encoder ratio=1.000000 status=0
2022/02/09 16:57:18.958 [devMotorAsyn.c:266  IOC_TEST:Axis1] update_soft_limits IOC_TEST:Axis1 RawHLM_RO=80.000000 RawLLM_RO=-50.000000 valid=1 DHLM_RO=80.000000 DLLM_RO=-50.000000
2022/02/09 16:57:18.958 [motorDevSup.c:327  IOC_TEST:Axis1] PositionRestoreNeeded IOC_TEST:Axis1 rstm=2 dval=0.000000 drbv=-34.492188 pmr->rdbd=0.100000 rdbd=0.100000 pmr->mres=0.014648 pmr->mflg=0x1f dval_non_zero_pos_near_zero=0 ret=0
2022/02/09 16:57:18.958 [motorRecord.cc:781  IOC_TEST:Axis1] init_re_init start neverPolled=0 stat=17 nsta=0
2022/02/09 16:57:18.958 [motorRecord.cc:719  IOC_TEST:Axis1] enforceMinRetryDeadband spdb=0.100000 rdbd=0.100000 mres=0.014648
2022/02/09 16:57:18.958 [motorRecord.cc:4373 IOC_TEST:Axis1] pmr->dhlm=80 softLimitRO=80
2022/02/09 16:57:18.958 [motorRecord.cc:4434 IOC_TEST:Axis1] pmr->dllm=-50 softLimitRO=-50
2022/02/09 16:57:18.958 [motorRecord.cc:832  IOC_TEST:Axis1] init_re_init  end dval=-34.492188 drbv=-34.492188 rdbd=0.100000 spdb=0.100000
2022/02/09 16:57:18.958 [motorRecord.cc:967  IOC_TEST:Axis1] init_record process_reason="callbackdata + soft limits" dval=-34.492188 drbv=-34.492188 rdbd=0.100000 spdb=0.100000 stat=0 msta=0x490a neverPolled=0
2022/02/09 16:57:18.958 ecmcMotorRecord:: setIntegerParam(1 motorUpdateStatus_)=0
2022/02/09 16:57:18.998 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitDatabase (7). Allow callbacks: true.
2022/02/09 16:57:18.998 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterFinishDevSup (8). Allow callbacks: true.
2022/02/09 16:57:19.512 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterScanInit (9). Allow callbacks: true.
2022/02/09 16:57:19.512 ecmcMotorRecord:: setDoubleParam(1 HomPos_)=0.000000
2022/02/09 16:57:19.513 ecmcMotorRecord:: setIntegerParam(1 HomProc_)=3 motorNotHomedProblem=0
2022/02/09 16:57:19.513 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInitialProcess (10). Allow callbacks: true.
2022/02/09 16:57:19.516 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (11). Allow callbacks: true.
2022/02/09 16:57:19.516 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocBuilt (12). Allow callbacks: true.
2022/02/09 16:57:19.520 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAtIocRun (13). Allow callbacks: true.
2022/02/09 16:57:19.521 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterDatabaseRunning (14). Allow callbacks: true.
2022/02/09 16:57:19.521 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterInterruptAccept (28). Allow callbacks: true.
2022/02/09 16:57:19.521 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterCaServerRunning (15). Allow callbacks: true.
2022/02/09 16:57:19.521 ecmcAsynPortDriver:getEpicsState: EPICS state: Unknown state (29). Allow callbacks: true.
iocRun: All initialization complete
2022/02/09 16:57:19.527 ecmcAsynPortDriver:getEpicsState: EPICS state: initHookAfterIocRunning (16). Allow callbacks: true.
mcag-dev-asm-02-30465 > 